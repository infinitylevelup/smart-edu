════════════════════════════════════════════════════════════════════════════════
🤖 AI ASSISTANT REPORT - SMART EDU SYSTEM
════════════════════════════════════════════════════════════════════════════════
Generated: 2025-12-08 21:41:13
Project: smart-edu
Input file: project_file_list_01.md
Total entries: 9
Valid files: 8
Not found: 1
════════════════════════════════════════════════════════════════════════════════

❌❌❌ FILES NOT FOUND ❌❌❌
▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼

📛 FILE: teacher-classroom.js
📍 PATH: public/assets/js/teacher-classroom.js
📝 Original line #8: public/assets/js/teacher-classroom.js
🚫 STATUS: FILE NOT FOUND
────────────────────────────────────────────────────────────

▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

✅✅✅ VALID FILES ✅✅✅
▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼

──────────────────────────────────────────────────────────────────────
📄 FILE 1: TeacherExamController.php
📍 PATH: app/Http/Controllers/Teacher/TeacherExamController.php
📝 Original line #1: app/Http/Controllers/Teacher/TeacherExamController.php
📏 SIZE: 8.67 KB
🕒 MODIFIED: 2025-12-08 09:22:50
──────────────────────────────────────────────────────────────────────

<?php

namespace App\Http\Controllers\Teacher;

use App\Http\Controllers\Controller;
use App\Models\Section;
use App\Models\Grade;
use App\Models\Branch;
use App\Models\Field;
use App\Models\Subfield;
use App\Models\SubjectType;
use App\Models\Subject;
use App\Models\Exam;
use App\Models\Classroom;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Str;

class TeacherExamController extends Controller
{
    // ==========================================================
    // Exams CRUD (اگر قبلاً داشتی، منطق قبلی‌ات رو نگه دار
    // اینجا فقط اسکلت امن گذاشتم تا route ها خطا ندهند)
    // ==========================================================
    public function index()
    {
        $teacherId = Auth::id();

        $exams = Exam::query()
            ->where('teacher_id', $teacherId)
            ->latest()
            ->paginate(10);

        return view('dashboard.teacher.exams.index', compact('exams'));
    }

    public function create(Request $request)
    {
        // اگر کلاس انتخابی از صفحه کلاس‌ها یا ... اومده
        $selectedClassroomId = $request->get('classroom_id');

        return view('dashboard.teacher.exams.create', compact('selectedClassroomId'));
    }

    public function store(Request $request)
    {
        $teacherId = Auth::id();

        $data = $request->validate([
            'title'            => 'required|string|max:255',
            'description'      => 'nullable|string',
            'duration'         => 'required|integer|min:15|max:300',
            'exam_type'        => 'required|string',

            'classroom_id'     => 'nullable|uuid|exists:classrooms,id',

            'section_id'       => 'required|uuid|exists:sections,id',
            'grade_id'         => 'required|uuid|exists:grades,id',
            'branch_id'        => 'required|uuid|exists:branches,id',
            'field_id'         => 'required|uuid|exists:fields,id',
            'subfield_id'      => 'nullable|uuid|exists:subfields,id',
            'subject_type_id'  => 'nullable|uuid|exists:subject_types,id',
            'subjects'         => 'required|string', // JSON of UUIDs
            'is_active'        => 'nullable|boolean',
        ]);

        // مالکیت کلاس (اگر آزمون کلاسی است)
        if (!empty($data['classroom_id'])) {
            $class = Classroom::findOrFail($data['classroom_id']);
            abort_unless($class->teacher_id === $teacherId, 403);
        }

        $exam = Exam::create([
            'id'              => (string) Str::uuid(),
            'teacher_id'      => $teacherId,
            'classroom_id'    => $data['classroom_id'] ?? null,
            'title'           => $data['title'],
            'description'     => $data['description'] ?? null,
            'duration'        => $data['duration'],
            'exam_type'       => $data['exam_type'],
            'section_id'      => $data['section_id'],
            'grade_id'        => $data['grade_id'],
            'branch_id'       => $data['branch_id'],
            'field_id'        => $data['field_id'],
            'subfield_id'     => $data['subfield_id'] ?? null,
            'subject_type_id' => $data['subject_type_id'] ?? null,
            'subjects'        => $data['subjects'],
            'is_active'       => (bool)($data['is_active'] ?? true),
        ]);

        return redirect()
            ->route('teacher.exams.show', $exam->id)
            ->with('success', 'آزمون با موفقیت ایجاد شد.');
    }

    public function show(Exam $exam)
    {
        abort_unless($exam->teacher_id === Auth::id(), 403);
        return view('dashboard.teacher.exams.show', compact('exam'));
    }

    public function edit(Exam $exam)
    {
        abort_unless($exam->teacher_id === Auth::id(), 403);
        return view('dashboard.teacher.exams.edit', compact('exam'));
    }

    public function update(Request $request, Exam $exam)
    {
        abort_unless($exam->teacher_id === Auth::id(), 403);

        $data = $request->validate([
            'title'       => 'required|string|max:255',
            'description' => 'nullable|string',
            'duration'    => 'required|integer|min:15|max:300',
            'is_active'   => 'nullable|boolean',
        ]);

        $exam->update([
            'title'       => $data['title'],
            'description' => $data['description'] ?? null,
            'duration'    => $data['duration'],
            'is_active'   => (bool)($data['is_active'] ?? true),
        ]);

        return back()->with('success', 'آزمون بروزرسانی شد.');
    }

    public function destroy(Exam $exam)
    {
        abort_unless($exam->teacher_id === Auth::id(), 403);
        $exam->delete();
        return back()->with('success', 'آزمون حذف شد.');
    }

    // ==========================================================
    // ✅ AJAX Taxonomy Endpoints
    // ==========================================================

    // 1) Sections
    public function sections()
    {
        $sections = Section::where('is_active', 1)
            ->orderBy('sort_order')
            ->get(['id','name_fa','slug']);

        return response()->json(['sections' => $sections]);
    }

    // 2) Grades (filter by section_id)
    public function grades(Request $request)
    {
        $q = Grade::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        if ($request->filled('section_id')) {
            $q->where('section_id', $request->section_id);
        }

        $grades = $q->get(['id','name_fa','slug','section_id']);

        return response()->json(['grades' => $grades]);
    }

    // 3) Branches (filter by section_id AND/OR grade_id)
    public function branches(Request $request)
    {
        $q = Branch::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        if ($request->filled('section_id')) {
            $q->where('section_id', $request->section_id);
        }

        // اگر در DB شاخه‌ها به پایه هم وصل باشند، این فیلتر را فعال می‌کند
        if ($request->filled('grade_id') && Schema::hasColumn('branches', 'grade_id')) {
            $q->where('grade_id', $request->grade_id);
        }

        $branches = $q->get(['id','name_fa','slug','section_id']);

        return response()->json(['branches' => $branches]);
    }

    // 4) Fields (filter by branch_id)
    public function fields(Request $request)
    {
        $q = Field::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        if ($request->filled('branch_id')) {
            $q->where('branch_id', $request->branch_id);
        }

        $fields = $q->get(['id','name_fa','slug','branch_id']);

        return response()->json(['fields' => $fields]);
    }

    // 5) Subfields (filter by field_id)
    public function subfields(Request $request)
    {
        $q = Subfield::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        if ($request->filled('field_id')) {
            $q->where('field_id', $request->field_id);
        }

        $subfields = $q->get(['id','name_fa','slug','field_id']);

        return response()->json(['subfields' => $subfields]);
    }

    // 6) Subject Types (optionally filter by section/grade/branch/field/subfield if columns exist on DB)
    public function subjectTypes(Request $request)
    {
        $q = SubjectType::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        // اگر subject_types جدولِ ربطی ندارد، اینها بی‌اثرند
        foreach (['section_id','grade_id','branch_id','field_id','subfield_id'] as $col) {
            if ($request->filled($col) && \Schema::hasColumn('subject_types', $col)) {
                $q->where($col, $request->$col);
            }
        }

        $subjectTypes = $q->get(['id','name_fa','slug','coefficient','weight_percent','default_question_count']);

        return response()->json(['subjectTypes' => $subjectTypes]);
    }

    // 7) Subjects (filter by grade/branch/field/subfield/subject_type)
    public function subjects(Request $request)
    {
        $q = Subject::query()
            ->where('is_active', 1)
            ->orderBy('sort_order');

        foreach (['section_id','grade_id','branch_id','field_id','subfield_id','subject_type_id'] as $col) {
            if ($request->filled($col)) {
                $q->where($col, $request->$col);
            }
        }

        $subjects = $q->get(['id','title_fa','slug','grade_id','branch_id','field_id','subfield_id','subject_type_id']);

        return response()->json(['subjects' => $subjects]);
    }
}


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 2: TeacherClassController.php
📍 PATH: app/Http/Controllers/Teacher/TeacherClassController.php
📝 Original line #2: app/Http/Controllers/Teacher/TeacherClassController.php
📏 SIZE: 6.99 KB
🕒 MODIFIED: 2025-12-07 05:36:55
──────────────────────────────────────────────────────────────────────

<?php

namespace App\Http\Controllers\Teacher;
use App\Models\User;
use App\Http\Controllers\Controller;
use App\Models\Classroom;
use Illuminate\Http\Request;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\Auth;
class TeacherClassController extends Controller
{
    public function index(Request $request)
    {
        $teacherId = Auth::id();

        $q = $request->q;
        $grade = $request->grade;
        $status = $request->status;
        $sort = $request->sort ?? 'latest';

        $classes = Classroom::query()
            ->where('teacher_id', $teacherId)
            ->when($q, function($query) use ($q){
                $query->where(function($qq) use ($q){
                    $qq->where('title', 'like', "%$q%")
                       ->orWhere('subject', 'like', "%$q%")
                       ->orWhere('join_code', 'like', "%$q%");
                });
            })
            ->when($grade && $grade !== 'all', fn($query)=>$query->where('grade', $grade))
            ->when($status && $status !== 'all', function($query) use ($status){
                $query->where('is_active', $status === 'active');
            })
            ->withCount('students')
            ->withCount('exams')
            ->when($sort === 'oldest', fn($query)=>$query->oldest())
            ->when($sort === 'students', fn($query)=>$query->orderByDesc('students_count'))
            ->when($sort === 'title_asc', fn($query)=>$query->orderBy('title'))
            ->when($sort === 'title_desc', fn($query)=>$query->orderByDesc('title'))
            ->when($sort === 'latest', fn($query)=>$query->latest())
            ->paginate(9)
            ->withQueryString();
 // اگر درخواست AJAX است
    if ($request->ajax() || $request->filled('ajax')) {
        return response()->json([
            'success' => true,
            'classrooms' => $classes->map(function($class) {
                return [
                    'id' => $class->id,
                    'title' => $class->title,
                    'subject' => $class->subject,
                    'grade' => $class->grade,
                    'students_count' => $class->students_count,
                    'exams_count' => $class->exams_count,
                    'is_active' => $class->is_active
                ];
            })
        ]);
    }
// کد قبلی شما برای نمایش view...
        return view('dashboard.teacher.classes.index', compact('classes'));
    }

    public function create()
    {
        return view('dashboard.teacher.classes.create');
    }

public function store(Request $request)
{
    $teacherId = Auth::id();

    $data = $request->validate([
        'title'       => 'required|string|max:255',
        'section_id'  => 'required|uuid|exists:sections,id',
        'grade_id'    => 'required|uuid|exists:grades,id',
        'branch_id'   => 'required|uuid|exists:branches,id',
        'field_id'    => 'required|uuid|exists:fields,id',
        'subfield_id' => 'required|uuid|exists:subfields,id',
        'subject_id'  => 'required|uuid|exists:subjects,id',
        'is_active'   => 'nullable|boolean',
        'metadata'    => 'nullable|string',
    ]);

    $classroom = Classroom::create([
        'id'          => (string) Str::uuid(),
        'teacher_id'  => $teacherId,
        'title'       => $data['title'],
        'section_id'  => $data['section_id'],
        'grade_id'    => $data['grade_id'],
        'branch_id'   => $data['branch_id'],
        'field_id'    => $data['field_id'],
        'subfield_id' => $data['subfield_id'],
        'subject_id'  => $data['subject_id'],
        'is_active'   => (bool)($data['is_active'] ?? true),
        'metadata'    => $data['metadata'] ?? null,
    ]);

    if ($request->ajax()) {
        return response()->json([
            'success' => true,
            'classroom' => [
                'id' => $classroom->id,
                'title' => $classroom->title,
            ]
        ]);
    }

    return redirect()
        ->route('teacher.classes.index')
        ->with('success', 'کلاس با موفقیت ایجاد شد.');
}

    // 🔥 تابع تولید کد عضویت
    private function generateJoinCode()
    {
        do {
            $code = strtoupper(substr(md5(uniqid()), 0, 8));
        } while (Classroom::where('join_code', $code)->exists());

        return $code;
    }

    public function show(Classroom $class)
    {
        $this->authorizeTeacher($class);

        $class->load('students');

        return view('dashboard.teacher.classes.show', compact('class'));
    }

    public function edit(Classroom $class)
    {
        $this->authorizeTeacher($class);

        return view('dashboard.teacher.classes.edit', compact('class'));
    }

    public function update(Request $request, Classroom $class)
    {
        $this->authorizeTeacher($class);

        $data = $request->validate([
            'title' => ['required','string','max:255'],
            'subject' => ['nullable','string','max:255'],
            'grade' => ['nullable','string','max:50'],
            'description' => ['nullable','string'],
            'is_active' => ['nullable','boolean'],
        ]);

        $data['is_active'] = $request->boolean('is_active', true);

        $class->update($data);

        return redirect()->route('teacher.classes.index')
            ->with('success', 'کلاس آپدیت شد.');
    }
    // حذف کلاس
    public function destroy(Classroom $class)
    {
        $this->authorizeTeacher($class);

        $class->delete();

        return back()->with('success', 'کلاس حذف شد.');
    }
    // نمایش دانش‌آموزان کلاس
    public function students(Classroom $class)
    {
        $this->authorizeTeacher($class);
        $class->load('students');

        return view('dashboard.teacher.classes.students', compact('class'));
    }
    // بررسی اینکه معلم مالک کلاس است
    public function addStudent(Request $request, Classroom $class)
    {
        $this->authorizeTeacher($class);

        $request->validate([
            'student' => ['required','string']
        ]);

        $key = $request->student;

        $student = User::query()
            ->where('email', $key)
            ->orWhere('username', $key)
            ->orWhere('phone', $key)
            ->first();

        if(!$student){
            return back()->with('error', 'دانش‌آموز پیدا نشد.');
        }

        $class->students()->syncWithoutDetaching([$student->id]);

        return back()->with('success', 'دانش‌آموز به کلاس اضافه شد.');
    }
    // حذف دانش‌آموز از کلاس
    public function removeStudent(Classroom $class, User $student)
    {
        $this->authorizeTeacher($class);

        $class->students()->detach($student->id);

        return back()->with('success', 'دانش‌آموز از کلاس حذف شد.');
    }
    // بررسی اینکه معلم مالک کلاس است
    private function authorizeTeacher(Classroom $class)
    {
        abort_unless($class->teacher_id ===Auth::id(), 403);
    }
}


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 3: create.blade.php
📍 PATH: resources/views/dashboard/teacher/exams/create.blade.php
📝 Original line #3: resources/views/dashboard/teacher/exams/create.blade.php
📏 SIZE: 32.66 KB
🕒 MODIFIED: 2025-12-06 22:23:19
──────────────────────────────────────────────────────────────────────

@extends('layouts.app')
@section('title', 'ساخت آزمون جدید - فنی و حرفه‌ای')

@push('styles')
    <link rel="stylesheet" href="{{ asset('assets/css/exam-wizard.css') }}">
@endpush

@section('content')
    <div class="create-exam-container">

        {{-- ========== HEADER ========== --}}
        <div class="page-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>
                        <span
                            style="background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 100%);
                        -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            ساخت آزمون جدید - فنی و حرفه‌ای
                        </span> 🔧
                    </h1>
                    <p class="header-subtitle">
                        آزمون خود را برای هنرجویان فنی و حرفه‌ای به صورت مرحله‌ای ایجاد کنید.
                    </p>
                </div>
                <a href="{{ route('teacher.exams.index') }}" class="btn-back">
                    <i class="fas fa-arrow-right"></i>
                    بازگشت به لیست آزمون‌ها
                </a>
            </div>
        </div>

        {{-- ========== PROGRESS BAR ========== --}}
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 14%;"></div>
            </div>
            <div class="progress-steps">
                @php
                    $steps = [
                        1 => 'نوع آزمون',
                        2 => 'پایه تحصیلی',
                        3 => 'شاخه تحصیلی',
                        4 => 'زمینه فنی',
                        5 => 'زیررشته',
                        6 => 'دسته درسی',
                        7 => 'انتخاب درس',
                        8 => 'جزئیات',
                    ];
                @endphp
                @foreach ($steps as $num => $name)
                    <div class="step-item @if ($num == 1) active @endif" data-step="{{ $num }}">
                        <div class="step-number">{{ $num }}</div>
                        <div class="step-name">{{ $name }}</div>
                    </div>
                @endforeach
            </div>
        </div>

        {{-- ========== FORM CONTAINER ========== --}}
        <div class="form-container">
            <form method="POST" action="{{ route('teacher.exams.store') }}" id="examForm"
                onsubmit="return validateFinalStep()">
                @csrf

                {{-- Hidden Inputs (UUID expected by controller) --}}
                <input type="hidden" name="exam_type" id="examType" value="">
                <input type="hidden" name="classroom_id" id="classroomId" value="{{ $selectedClassroomId ?? '' }}">

                <input type="hidden" name="section_id" id="sectionId" value="">
                <input type="hidden" name="grade_id" id="gradeId" value="">
                <input type="hidden" name="branch_id" id="branchId" value="">
                <input type="hidden" name="field_id" id="fieldId" value="">
                <input type="hidden" name="subfield_id" id="subfieldId" value="">
                <input type="hidden" name="subject_type_id" id="subjectTypeId" value="">
                <input type="hidden" name="subjects" id="subjectsInput" value="">

                {{-- ===== STEP 1: EXAM TYPE ===== --}}
                <div class="form-section active" id="step1">
                    <div class="section-header">
                        <div class="section-icon">🎯</div>
                        <h2 class="section-title">نوع آزمون را انتخاب کنید</h2>
                        <p class="section-description">
                            بر اساس نیاز آموزشی خود، یکی از گزینه‌های زیر را انتخاب نمایید.
                        </p>
                    </div>

                    <div class="exam-type-grid">
                        <div class="type-card" data-type="public" onclick="selectExamType('public')">
                            <div class="type-icon">🌐</div>
                            <div class="type-title">آزمون عمومی</div>
                            <p class="type-description">برای تمام دانش‌آموزان قابل دسترسی است. نیازی به عضویت در کلاس ندارد.
                            </p>
                            <div class="type-badge">عمومی</div>
                        </div>

                        <div class="type-card" data-type="class_single" onclick="selectExamType('class_single')">
                            <div class="type-icon">📚</div>
                            <div class="type-title">کلاسی تک درس</div>
                            <p class="type-description">برای یک کلاس خاص و فقط یک درس مشخص.</p>
                            <div class="type-badge">تخصصی</div>
                        </div>

                        <div class="type-card" data-type="class_comprehensive"
                            onclick="selectExamType('class_comprehensive')">
                            <div class="type-icon">🎓</div>
                            <div class="type-title">کلاسی جامع</div>
                            <p class="type-description">برای یک کلاس شامل تمام دروس پایه.</p>
                            <div class="type-badge">جامع</div>
                        </div>
                    </div>

                    {{-- انتخاب کلاس --}}
                    <div id="classroomSelectionSection" style="display: none; margin-top: 30px;">
                        <div class="section-header" style="margin-bottom: 20px;">
                            <h3 class="section-title">انتخاب کلاس</h3>
                            <p class="section-description">
                                لطفاً کلاس مورد نظر را انتخاب کنید یا یک کلاس جدید ایجاد نمایید.
                            </p>
                        </div>

                        <div id="existingClassroomsContainer" class="selection-grid"
                            style="grid-template-columns: repeat(2, 1fr);">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                در حال بارگذاری کلاس‌ها...
                            </div>
                        </div>

                        <div id="createNewClassContainer" style="margin-top: 25px; text-align: center;">
                            <div class="type-card" onclick="createNewClassroom()"
                                style="max-width: 400px; margin: 0 auto; cursor: pointer;
                            background: linear-gradient(135deg, rgba(0, 206, 209, 0.1), rgba(70, 130, 180, 0.1));">
                                <div class="type-icon">➕</div>
                                <div class="type-title">ایجاد کلاس جدید</div>
                                <p class="type-description">هنوز کلاسی ندارید؟ یک کلاس جدید ایجاد کنید.</p>
                            </div>
                        </div>
                    </div>
                </div>

                {{-- ===== STEP 2: GRADE (dynamic) ===== --}}
                <div class="form-section" id="step2">
                    <div class="section-header">
                        <div class="section-icon">📊</div>
                        <h2 class="section-title">پایه تحصیلی را انتخاب کنید</h2>
                        <p class="section-description">پایه مورد نظر برای آزمون خود را انتخاب نمایید.</p>
                    </div>
                    <div class="selection-grid" id="gradesGrid" style="grid-template-columns: repeat(3, 1fr);">
                        {{-- ajax --}}
                    </div>
                </div>

                {{-- ===== STEP 3: BRANCH (dynamic) ===== --}}
                <div class="form-section" id="step3">
                    <div class="section-header">
                        <div class="section-icon">🎓</div>
                        <h2 class="section-title">شاخه تحصیلی را انتخاب کنید</h2>
                    </div>
                    <div class="selection-grid" id="branchesGrid" style="grid-template-columns: repeat(2, 1fr);"></div>
                </div>

                {{-- ===== STEP 4: FIELD (dynamic) ===== --}}
                <div class="form-section" id="step4">
                    <div class="section-header">
                        <div class="section-icon">🏭</div>
                        <h2 class="section-title">زمینه فنی را انتخاب کنید</h2>
                    </div>
                    <div class="selection-grid" id="fieldsGrid" style="grid-template-columns: repeat(2, 1fr);"></div>
                </div>

                {{-- ===== STEP 5: SUBFIELD (dynamic) ===== --}}
                <div class="form-section" id="step5">
                    <div class="section-header">
                        <div class="section-icon">🔬</div>
                        <h2 class="section-title">زیررشته را انتخاب کنید</h2>
                    </div>
                    <div class="selection-grid" id="subfieldGrid" style="grid-template-columns: repeat(2, 1fr);"></div>
                </div>

                {{-- ===== STEP 6: SUBJECT TYPE (dynamic) ===== --}}
                <div class="form-section" id="step6">
                    <div class="section-header">
                        <div class="section-icon">📚</div>
                        <h2 class="section-title">دسته درسی را انتخاب کنید</h2>
                    </div>
                    <div class="selection-grid" id="subjectTypesGrid" style="grid-template-columns: repeat(3, 1fr);">
                    </div>

                    <div class="coefficient-settings" id="coefficientSettings"></div>
                </div>

                {{-- ===== STEP 7: SUBJECTS ===== --}}
                <div class="form-section" id="step7">
                    <div class="section-header">
                        <div class="section-icon">📖</div>
                        <h2 class="section-title">درس‌های آزمون را انتخاب کنید</h2>
                    </div>

                    <div class="subject-selection">
                        <div id="subjectsContainer">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                در حال بارگذاری دروس...
                            </div>
                        </div>
                    </div>
                </div>

                {{-- ===== STEP 8: DETAILS ===== --}}
                <div class="form-section" id="step8">
                    <div class="section-header">
                        <div class="section-icon">📋</div>
                        <h2 class="section-title">جزئیات آزمون را تکمیل کنید</h2>
                    </div>

                    <div class="preview-section">
                        <div class="preview-title">
                            <i class="fas fa-eye"></i>
                            پیش‌نمایش آزمون
                        </div>
                        <div class="preview-grid">
                            <div class="preview-item">
                                <div class="preview-label">نوع آزمون</div>
                                <div class="preview-value" id="previewExamType">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">پایه تحصیلی</div>
                                <div class="preview-value" id="previewGrade">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">شاخه تحصیلی</div>
                                <div class="preview-value" id="previewBranch">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">زمینه فنی</div>
                                <div class="preview-value" id="previewField">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">زیررشته</div>
                                <div class="preview-value" id="previewSubfield">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">دسته درسی</div>
                                <div class="preview-value" id="previewSubjectType">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">تعداد دروس</div>
                                <div class="preview-value" id="previewSubjectsCount">--</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-label">کل سوالات</div>
                                <div class="preview-value" id="previewTotalQuestions">--</div>
                            </div>
                        </div>
                    </div>

                    <div class="details-form">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-heading"></i>عنوان آزمون</label>
                            <input type="text" name="title" class="form-input" id="examTitle"
                                placeholder="مثال: آزمون کارگاه برق صنعتی - پایه یازدهم" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-clock"></i>مدت زمان آزمون (دقیقه)</label>
                            <input type="number" name="duration" class="form-input" value="90" min="15"
                                max="300" step="5" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-align-left"></i>توضیحات آزمون</label>
                            <textarea name="description" class="form-textarea" rows="4" placeholder="هدف آزمون، منابع مطالعاتی، نکات ..."></textarea>
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_active" id="activeCheck"
                                    value="1" checked>
                                <label class="form-check-label" for="activeCheck">آزمون بلافاصله فعال شود</label>
                            </div>
                        </div>
                    </div>
                </div>

                {{-- NAV BUTTONS --}}
                <div class="nav-buttons">
                    <button type="button" class="btn-nav btn-prev" onclick="prevStep()" style="display:none;">
                        <i class="fas fa-arrow-right"></i> مرحله قبل
                    </button>
                    <button type="button" class="btn-nav btn-next" onclick="nextStep()">
                        مرحله بعد <i class="fas fa-arrow-left"></i>
                    </button>
                    <button type="submit" class="btn-nav btn-submit" style="display:none;">
                        <i class="fas fa-check"></i> ایجاد آزمون
                    </button>
                </div>

            </form>
        </div>
    </div>
@endsection

@push('scripts')
    {{-- SweetAlert2 --}}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    {{-- ✅ createNewClassroom حفظ شده --}}
    <script>
        async function createNewClassroom() {

            const endpoints = {
                sections: "/dashboard/teacher/exams/data/sections",
                grades: "/dashboard/teacher/exams/data/grades",
                branches: "/dashboard/teacher/exams/data/branches",
                fields: "/dashboard/teacher/exams/data/fields",
                subfields: "/dashboard/teacher/exams/data/subfields",
                subjects: "/dashboard/teacher/exams/data/subjects",
            };

            const getJSON = async (url) => {
                const res = await fetch(url, {
                    headers: {
                        "Accept": "application/json",
                        "X-Requested-With": "XMLHttpRequest"
                    }
                });
                if (!res.ok) throw new Error("network");
                return res.json();
            };

            const opt = (items, placeholder = "-- انتخاب کنید --", labelKey = "name_fa") => {
                let html = `<option value="">${placeholder}</option>`;
                items.forEach(i => {
                    html +=
                        `<option value="${i.id}" data-name="${i[labelKey] || i.title_fa || ''}">${i[labelKey] || i.title_fa}</option>`;
                });
                return html;
            };

            // قدم اول: لود مقطع
            let sections = [];
            try {
                const s = await getJSON(endpoints.sections);
                sections = s.sections || [];
            } catch (e) {
                Swal.fire("خطا", "دریافت مقاطع ممکن نیست", "error");
                return;
            }

            Swal.fire({
                title: 'ایجاد کلاس جدید',
                html: `
        <div style="text-align:right">

            <label class="mb-2 fw-bold d-block">🎓 مقطع</label>
            <select id="cc_section" class="swal2-input">${opt(sections, "مقطع را انتخاب کنید")}</select>

            <label class="mb-2 fw-bold d-block mt-3">📊 پایه</label>
            <select id="cc_grade" class="swal2-input" disabled>
                <option value="">ابتدا مقطع را انتخاب کنید</option>
            </select>

            <label class="mb-2 fw-bold d-block mt-3">🧩 شاخه / رشته</label>
            <select id="cc_branch" class="swal2-input" disabled>
                <option value="">ابتدا پایه را انتخاب کنید</option>
            </select>

            <label class="mb-2 fw-bold d-block mt-3">🏭 زمینه آموزشی</label>
            <select id="cc_field" class="swal2-input" disabled>
                <option value="">ابتدا شاخه را انتخاب کنید</option>
            </select>

            <label class="mb-2 fw-bold d-block mt-3">🔬 زیررشته</label>
            <select id="cc_subfield" class="swal2-input" disabled>
                <option value="">ابتدا زمینه را انتخاب کنید</option>
            </select>

            <label class="mb-2 fw-bold d-block mt-3">📖 درس</label>
            <select id="cc_subject" class="swal2-input" disabled>
                <option value="">ابتدا زیررشته را انتخاب کنید</option>
            </select>

            <label class="mb-2 fw-bold d-block mt-3">🏷️ نام کلاس</label>
            <input type="text" id="cc_title" class="swal2-input" placeholder="مثال: کلاس یازدهم شبکه - پایگاه داده">

        </div>
        `,
                showCancelButton: true,
                confirmButtonText: "ایجاد کلاس",
                cancelButtonText: "انصراف",
                reverseButtons: true,
                width: 650,
                didOpen: () => {

                    const elSection = document.getElementById("cc_section");
                    const elGrade = document.getElementById("cc_grade");
                    const elBranch = document.getElementById("cc_branch");
                    const elField = document.getElementById("cc_field");
                    const elSubfield = document.getElementById("cc_subfield");
                    const elSubject = document.getElementById("cc_subject");

                    // ====== مقطع → پایه‌ها ======
                    elSection.addEventListener("change", async () => {
                        const sectionId = elSection.value;

                        elGrade.innerHTML = `<option>در حال بارگذاری...</option>`;
                        elGrade.disabled = true;

                        elBranch.innerHTML =
                            `<option value="">ابتدا پایه را انتخاب کنید</option>`;
                        elBranch.disabled = true;

                        elField.innerHTML =
                            `<option value="">ابتدا شاخه را انتخاب کنید</option>`;
                        elField.disabled = true;

                        elSubfield.innerHTML =
                            `<option value="">ابتدا زمینه را انتخاب کنید</option>`;
                        elSubfield.disabled = true;

                        elSubject.innerHTML =
                            `<option value="">ابتدا زیررشته را انتخاب کنید</option>`;
                        elSubject.disabled = true;

                        if (!sectionId) {
                            elGrade.innerHTML =
                                `<option value="">ابتدا مقطع را انتخاب کنید</option>`;
                            return;
                        }

                        const g = await getJSON(`${endpoints.grades}?section_id=${sectionId}`);
                        elGrade.innerHTML = opt(g.grades || [], "پایه را انتخاب کنید");
                        elGrade.disabled = false;
                    });

                    // ====== پایه → شاخه‌ها ======
                    elGrade.addEventListener("change", async () => {
                        const sectionId = elSection.value;

                        elBranch.innerHTML = `<option>در حال بارگذاری...</option>`;
                        elBranch.disabled = true;

                        elField.innerHTML =
                            `<option value="">ابتدا شاخه را انتخاب کنید</option>`;
                        elField.disabled = true;

                        elSubfield.innerHTML =
                            `<option value="">ابتدا زمینه را انتخاب کنید</option>`;
                        elSubfield.disabled = true;

                        elSubject.innerHTML =
                            `<option value="">ابتدا زیررشته را انتخاب کنید</option>`;
                        elSubject.disabled = true;

                        if (!sectionId) return;

                        const b = await getJSON(
                        `${endpoints.branches}?section_id=${sectionId}`);
                        elBranch.innerHTML = opt(b.branches || [], "شاخه/رشته را انتخاب کنید");
                        elBranch.disabled = false;
                    });

                    // ====== شاخه → زمینه‌ها ======
                    elBranch.addEventListener("change", async () => {
                        const branchId = elBranch.value;

                        elField.innerHTML = `<option>در حال بارگذاری...</option>`;
                        elField.disabled = true;

                        elSubfield.innerHTML =
                            `<option value="">ابتدا زمینه را انتخاب کنید</option>`;
                        elSubfield.disabled = true;

                        elSubject.innerHTML =
                            `<option value="">ابتدا زیررشته را انتخاب کنید</option>`;
                        elSubject.disabled = true;

                        if (!branchId) {
                            elField.innerHTML =
                                `<option value="">ابتدا شاخه را انتخاب کنید</option>`;
                            return;
                        }

                        const f = await getJSON(`${endpoints.fields}?branch_id=${branchId}`);
                        elField.innerHTML = opt(f.fields || [], "زمینه را انتخاب کنید");
                        elField.disabled = false;
                    });

                    // ====== زمینه → زیررشته ======
                    elField.addEventListener("change", async () => {
                        const fieldId = elField.value;

                        elSubfield.innerHTML = `<option>در حال بارگذاری...</option>`;
                        elSubfield.disabled = true;

                        elSubject.innerHTML =
                            `<option value="">ابتدا زیررشته را انتخاب کنید</option>`;
                        elSubject.disabled = true;

                        if (!fieldId) {
                            elSubfield.innerHTML =
                                `<option value="">ابتدا زمینه را انتخاب کنید</option>`;
                            return;
                        }

                        const sf = await getJSON(`${endpoints.subfields}?field_id=${fieldId}`);
                        elSubfield.innerHTML = opt(sf.subfields || [],
                        "زیررشته را انتخاب کنید");
                        elSubfield.disabled = false;
                    });

                    // ====== زیررشته → دروس ======
                    elSubfield.addEventListener("change", async () => {
                        const gradeId = elGrade.value;
                        const branchId = elBranch.value;
                        const fieldId = elField.value;
                        const subfieldId = elSubfield.value;

                        elSubject.innerHTML = `<option>در حال بارگذاری...</option>`;
                        elSubject.disabled = true;

                        if (!subfieldId) {
                            elSubject.innerHTML =
                                `<option value="">ابتدا زیررشته را انتخاب کنید</option>`;
                            return;
                        }

                        const params = new URLSearchParams();
                        if (gradeId) params.append("grade_id", gradeId);
                        if (branchId) params.append("branch_id", branchId);
                        if (fieldId) params.append("field_id", fieldId);
                        if (subfieldId) params.append("subfield_id", subfieldId);

                        const sub = await getJSON(`${endpoints.subjects}?${params.toString()}`);
                        elSubject.innerHTML = opt(sub.subjects || [], "درس را انتخاب کنید",
                            "title_fa");
                        elSubject.disabled = false;
                    });

                },
                preConfirm: () => {
                    const sectionId = document.getElementById("cc_section").value;
                    const gradeId = document.getElementById("cc_grade").value;
                    const branchId = document.getElementById("cc_branch").value;
                    const fieldId = document.getElementById("cc_field").value;
                    const subfieldId = document.getElementById("cc_subfield").value;
                    const subjectId = document.getElementById("cc_subject").value;
                    const title = document.getElementById("cc_title").value.trim();

                    if (!sectionId || !gradeId || !branchId || !fieldId || !subfieldId || !subjectId) {
                        Swal.showValidationMessage("لطفاً همه موارد آموزشی را انتخاب کنید.");
                        return false;
                    }
                    if (!title) {
                        Swal.showValidationMessage("نام کلاس الزامی است.");
                        return false;
                    }

                    const getName = (selectId) => {
                        const el = document.getElementById(selectId);
                        return el.options[el.selectedIndex]?.dataset?.name || el.options[el
                            .selectedIndex]?.text || "";
                    };

                    return {
                        section_id: sectionId,
                        grade_id: gradeId,
                        branch_id: branchId,
                        field_id: fieldId,
                        subfield_id: subfieldId,
                        subject_id: subjectId,

                        section_name: getName("cc_section"),
                        grade_name: getName("cc_grade"),
                        branch_name: getName("cc_branch"),
                        field_name: getName("cc_field"),
                        subfield_name: getName("cc_subfield"),
                        subject_name: getName("cc_subject"),

                        title
                    };
                }
            }).then(async (result) => {
                if (!result.isConfirmed) return;

                const data = result.value;

                Swal.fire({
                    title: "در حال ایجاد کلاس...",
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                try {
                    const fd = new FormData();
                    fd.append("title", data.title);
                    fd.append("section_id", data.section_id);
                    fd.append("grade_id", data.grade_id);
                    fd.append("branch_id", data.branch_id);
                    fd.append("field_id", data.field_id);
                    fd.append("subfield_id", data.subfield_id);
                    fd.append("subject_id", data.subject_id);
                    fd.append("is_active", 1);

                    // metadata برای نمایش خوانا
                    fd.append("metadata", JSON.stringify({
                        section_name: data.section_name,
                        grade_name: data.grade_name,
                        branch_name: data.branch_name,
                        field_name: data.field_name,
                        subfield_name: data.subfield_name,
                        subject_name: data.subject_name
                    }));

                    const res = await fetch("{{ route('teacher.classes.store') }}", {
                        method: "POST",
                        headers: {
                            "X-CSRF-TOKEN": "{{ csrf_token() }}",
                            "X-Requested-With": "XMLHttpRequest",
                            "Accept": "application/json"
                        },
                        body: fd
                    });

                    const responseData = await res.json();
                    Swal.close();

                    if (responseData.success) {
                        Swal.fire("✅ موفقیت", "کلاس ایجاد شد", "success").then(() => {
                            loadExistingClassrooms();

                            if (responseData.classroom) {
                                setTimeout(() => {
                                    selectClassroom({
                                            target: document.querySelector(
                                                `[data-classroom-id="${responseData.classroom.id}"]`
                                                )
                                        },
                                        responseData.classroom.id,
                                        responseData.classroom.title
                                    );
                                }, 300);
                            }
                        });
                    } else {
                        Swal.fire("❌ خطا", responseData.message || "خطا در ایجاد کلاس", "error");
                    }

                } catch (e) {
                    console.error(e);
                    Swal.close();
                    Swal.fire("❌ خطای شبکه", "ارتباط با سرور مشکل دارد.", "error");
                }
            });
        }
    </script>


    {{-- ✅ exam wizard main js --}}
    <script src="{{ asset('assets/js/exam-wizard.js') }}"></script>
@endpush


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 4: create.blade.php
📍 PATH: resources/views/dashboard/teacher/classes/create.blade.php
📝 Original line #4: resources/views/dashboard/teacher/classes/create.blade.php
📏 SIZE: 17.15 KB
🕒 MODIFIED: 2025-12-02 08:22:52
──────────────────────────────────────────────────────────────────────

@extends('layouts.app')
@section('title', 'ساخت کلاس جدید')

@push('styles')
    <style>
        .form-shell {
            background: radial-gradient(900px circle at 100% -30%, rgba(13, 110, 253, .12), transparent 55%), linear-gradient(180deg, #fff, #f8fafc);
            border-radius: 1.5rem;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(18, 38, 63, .08)
        }

        .form-card {
            border: 0;
            border-radius: 1.25rem;
            background: #fff;
            box-shadow: 0 8px 24px rgba(18, 38, 63, .06)
        }

        .input-soft {
            border: 0;
            box-shadow: 0 6px 18px rgba(18, 38, 63, .06);
            border-radius: .9rem;
            padding: .7rem .9rem
        }

        .input-soft:focus {
            box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .15)
        }

        .chip {
            background: rgba(13, 110, 253, .1);
            color: #0d6efd;
            font-weight: 800;
            border-radius: 999px;
            padding: .25rem .65rem;
            font-size: .8rem
        }

        .wizard {
            display: flex;
            gap: .5rem;
            flex-wrap: wrap
        }

        .wiz-step {
            flex: 1 1 140px;
            background: #f8fafc;
            border-radius: 1rem;
            padding: .7rem .9rem;
            display: flex;
            align-items: center;
            gap: .6rem;
            font-weight: 800;
            font-size: .9rem;
            color: #334155
        }

        .wiz-step.active {
            background: rgba(13, 110, 253, .12);
            color: #0d6efd
        }

        .wiz-step .num {
            width: 28px;
            height: 28px;
            border-radius: .7rem;
            display: grid;
            place-items: center;
            background: #fff;
            border: 1px solid #e2e8f0
        }

        .btn-wizard {
            border-radius: 1rem;
            padding: .7rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: .5rem
        }

        .preview-card {
            border: 1px dashed #e2e8f0;
            border-radius: 1.25rem;
            background: linear-gradient(180deg, #fff, #f8fafc)
        }

        .meta-pill {
            background: #f8fafc;
            border: 1px solid #eef2f7;
            border-radius: 999px;
            padding: .25rem .6rem;
            display: inline-flex;
            align-items: center;
            gap: .35rem;
            font-weight: 700;
            font-size: .85rem;
            color: #475569
        }

        .floating {
            position: sticky;
            top: 90px
        }
    </style>
@endpush

@section('content')
    <div class="container-fluid">

        {{-- Header --}}
        <div class="form-shell mb-4 fade-up">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 text-end">
                <div>
                    <h1 class="h4 fw-bold mb-1"><i class="bi bi-plus-circle me-1 text-primary"></i> ساخت کلاس جدید</h1>
                    <p class="text-muted mb-0">برای شروع آموزش، یک کلاس بساز و دانش‌آموزها را اضافه کن.</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{{ route('teacher.classes.index') }}"
                        class="btn btn-outline-secondary d-inline-flex align-items-center gap-2 shadow-sm">
                        <i class="bi bi-arrow-right"></i> بازگشت
                    </a>
                </div>
            </div>
        </div>

        {{-- Errors --}}
        @if ($errors->any())
            <div class="alert alert-danger fade-up">
                <div class="fw-semibold mb-2"><i class="bi bi-exclamation-triangle-fill me-1"></i> لطفاً خطاهای زیر را بررسی
                    کن:</div>
                <ul class="mb-0">
                    @foreach ($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <div class="row g-3">

            {{-- Form column --}}
            <div class="col-lg-8">
                <div class="form-card p-3 p-md-4 fade-up">

                    {{-- Wizard Steps --}}
                    <div class="wizard mb-3" id="wizard">
                        <div class="wiz-step active" data-step="1">
                            <div class="num">1</div> اطلاعات پایه
                        </div>
                        <div class="wiz-step" data-step="2">
                            <div class="num">2</div> جزئیات و تنظیمات
                        </div>
                        <div class="wiz-step" data-step="3">
                            <div class="num">3</div> مرور نهایی
                        </div>
                    </div>

                    <form action="{{ route('teacher.classes.store') }}" method="POST" class="row g-3" novalidate>
                        @csrf

                        {{-- Step 1 --}}
                        <div class="col-12 step" data-step="1">
                            <label class="form-label fw-semibold">نام کلاس <span class="text-danger">*</span></label>
                            <input type="text" name="title" class="form-control input-soft" required
                                value="{{ old('title') }}" placeholder="مثلاً: ریاضی نهم - کلاس A">
                        </div>

                        <div class="col-md-6 step" data-step="1">
                            <label class="form-label fw-semibold">درس</label>
                            <input type="text" name="subject" class="form-control input-soft"
                                value="{{ old('subject') }}" placeholder="مثلاً ریاضی، علوم، زبان...">
                        </div>

                        <div class="col-md-6 step" data-step="1">
                            <label class="form-label fw-semibold">پایه</label>
                            <select name="grade" class="form-select input-soft">
                                @php $grade = old('grade',''); @endphp
                                <option value="" {{ $grade === '' ? 'selected' : '' }}>انتخاب پایه</option>
                                <option value="7" {{ $grade === '7' ? 'selected' : '' }}>هفتم</option>
                                <option value="8" {{ $grade === '8' ? 'selected' : '' }}>هشتم</option>
                                <option value="9" {{ $grade === '9' ? 'selected' : '' }}>نهم</option>
                                <option value="10" {{ $grade === '10' ? 'selected' : '' }}>دهم</option>
                                <option value="11" {{ $grade === '11' ? 'selected' : '' }}>یازدهم</option>
                                <option value="12" {{ $grade === '12' ? 'selected' : '' }}>دوازدهم</option>
                            </select>
                        </div>

                        {{-- Step 2 --}}
                        <div class="col-12 step" data-step="2" style="display:none">
                            <label class="form-label fw-semibold">توضیحات کلاس</label>
                            <textarea name="description" rows="4" class="form-control input-soft"
                                placeholder="توضیح کوتاه دربارهٔ اهداف، منابع، زمان‌بندی و...">{{ old('description') }}</textarea>
                        </div>

                        <div class="col-md-6 step" data-step="2" style="display:none">
                            <label class="form-label fw-semibold">وضعیت کلاس</label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="activeSwitch" name="is_active"
                                    value="1" {{ old('is_active', 1) ? 'checked' : '' }}>
                                <label class="form-check-label" for="activeSwitch">کلاس فعال باشد</label>
                            </div>
                            <div class="hint mt-2 text-muted small">کلاس غیرفعال برای آرشیو یا کلاس‌های تمام‌شده مناسب است.
                            </div>
                        </div>

                        <div class="col-md-6 step" data-step="2" style="display:none">
                            <label class="form-label fw-semibold">کد ورود دانش‌آموز</label>
                            <div class="input-group">
                                <input type="text" class="form-control input-soft" id="joinCode"
                                    value="{{ old('join_code') }}" placeholder="خودکار ساخته می‌شود" disabled>
                                <button type="button" class="btn btn-outline-primary btn-wizard" id="genCodeBtn"><i
                                        class="bi bi-shuffle"></i> ساخت کد</button>
                            </div>
                            <div class="text-muted small mt-1">بعد از ساخت کلاس این کد را به دانش‌آموزان بده.</div>
                        </div>

                        {{-- Step 3 Review --}}
                        <div class="col-12 step" data-step="3" style="display:none">
                            <div class="preview-card p-3">
                                <div class="fw-bold mb-2"><i class="bi bi-eye me-1"></i> مرور نهایی</div>
                                <div class="small text-muted">قبل از ذخیره یکبار چک کن.</div>
                                <div class="border rounded-3 p-3 bg-white mt-2" id="reviewBox"></div>
                            </div>
                        </div>

                        {{-- Nav buttons --}}
                        <div class="col-12 d-flex flex-wrap gap-2 mt-2">
                            <button type="button" class="btn btn-outline-secondary btn-wizard" id="prevBtn" disabled>
                                <i class="bi bi-arrow-right"></i> قبلی
                            </button>
                            <button type="button" class="btn btn-primary btn-wizard shadow-sm" id="nextBtn">
                                بعدی <i class="bi bi-arrow-left"></i>
                            </button>
                            <button type="submit" class="btn btn-success btn-wizard shadow-sm" id="submitBtn"
                                style="display:none">
                                <i class="bi bi-check2-circle"></i> ساخت کلاس
                            </button>
                        </div>

                    </form>
                </div>
            </div>

            {{-- Right column (live preview + tips) --}}
            <div class="col-lg-4">
                <div class="floating fade-up">

                    <div class="preview-card p-3 mb-3">
                        <div class="fw-bold mb-2"><i class="bi bi-eye me-1"></i> پیش‌نمایش زنده</div>
                        <div class="border rounded-3 p-3 bg-white" id="livePreview">
                            <div class="fw-semibold fs-6" id="pvTitle">نام کلاس</div>
                            <div class="text-muted small mt-2" id="pvSubject">درس: —</div>
                            <div class="text-muted small mt-1" id="pvGrade">پایه: —</div>
                            <div class="d-flex flex-wrap gap-2 mt-2">
                                <span class="meta-pill" id="pvActive"><i class="bi bi-broadcast"></i> فعال</span>
                                <span class="meta-pill" id="pvCode"><i class="bi bi-key"></i> کد: —</span>
                            </div>
                            <div class="text-muted small mt-3" id="pvDesc"></div>
                        </div>
                    </div>

                    <div class="form-card p-3">
                        <div class="fw-bold mb-2"><i class="bi bi-lightbulb me-1 text-warning"></i> نکته‌ها</div>
                        <ul class="small text-muted mb-0 ps-3">
                            <li>نام کلاس واضح و قابل تشخیص انتخاب کن.</li>
                            <li>کد ورود را بعد از ساخت در گروه کلاس ارسال کن.</li>
                            <li>می‌توانی کلاس را بعداً آرشیو کنی.</li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </div>

    @push('scripts')
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Wizard
                const steps = [...document.querySelectorAll('.step')];
                const wizSteps = [...document.querySelectorAll('.wiz-step')];
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                let current = 1;

                function setStep(n) {
                    current = n;
                    steps.forEach(s => s.style.display = (Number(s.dataset.step) === n) ? '' : 'none');
                    wizSteps.forEach(w => w.classList.toggle('active', Number(w.dataset.step) === n));
                    prevBtn.disabled = n === 1;
                    nextBtn.style.display = n < 3 ? '' : 'none';
                    submitBtn.style.display = n === 3 ? '' : 'none';
                    if (n === 3) fillReview();
                }

                prevBtn.addEventListener('click', () => setStep(Math.max(1, current - 1)));
                nextBtn.addEventListener('click', () => setStep(Math.min(3, current + 1)));

                // Live preview elements
                const title = document.querySelector('input[name="title"]');
                const subject = document.querySelector('input[name="subject"]');
                const grade = document.querySelector('select[name="grade"]');
                const desc = document.querySelector('textarea[name="description"]');
                const active = document.getElementById('activeSwitch');

                const pvTitle = document.getElementById('pvTitle');
                const pvSubject = document.getElementById('pvSubject');
                const pvGrade = document.getElementById('pvGrade');
                const pvDesc = document.getElementById('pvDesc');
                const pvActive = document.getElementById('pvActive');
                const pvCode = document.getElementById('pvCode');

                const joinCode = document.getElementById('joinCode');
                const genCodeBtn = document.getElementById('genCodeBtn');

                function genCode() {
                    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                    let c = '';
                    for (let i = 0; i < 6; i++) c += chars[Math.floor(Math.random() * chars.length)];
                    joinCode.value = c;
                    if (pvCode) pvCode.innerHTML = `<i class="bi bi-key"></i> کد: ${c}`;
                }

                genCodeBtn?.addEventListener('click', genCode);

                function fillReview() {
                    const t = title?.value?.trim() || '—';
                    const s = subject?.value?.trim() || '—';
                    const g = grade?.value || '—';
                    const d = desc?.value?.trim() || '—';
                    const a = active?.checked ? 'فعال' : 'آرشیو';
                    const c = joinCode?.value || 'خودکار';

                    const reviewBox = document.getElementById('reviewBox');
                    if (reviewBox) {
                        reviewBox.innerHTML = `
          <div class="fw-semibold mb-1">نام کلاس:</div><div>${t}</div>
          <div class="mt-2 fw-semibold mb-1">درس:</div><div>${s}</div>
          <div class="mt-2 text-muted small">پایه: ${g} • وضعیت: ${a}</div>
          <div class="mt-2 fw-semibold mb-1">کد ورود:</div><div>${c}</div>
          <div class="mt-2 fw-semibold mb-1">توضیحات:</div><div>${d}</div>
        `;
                    }
                }

                // preview listeners
                title?.addEventListener('input', () => {
                    pvTitle.textContent = title.value || 'نام کلاس';
                });
                subject?.addEventListener('input', () => {
                    pvSubject.textContent = 'درس: ' + (subject.value || '—');
                });
                grade?.addEventListener('change', () => {
                    pvGrade.textContent = 'پایه: ' + (grade.value || '—');
                });
                desc?.addEventListener('input', () => {
                    pvDesc.textContent = desc.value || '';
                });
                active?.addEventListener('change', () => {
                    pvActive.innerHTML = active.checked ?
                        '<i class="bi bi-broadcast"></i> فعال' :
                        '<i class="bi bi-archive"></i> آرشیو';
                });

                // init
                setStep(1);
                genCode();
            });
        </script>
    @endpush
@endsection


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 5: edit.blade.php
📍 PATH: resources/views/dashboard/teacher/exams/edit.blade.php
📝 Original line #5: resources/views/dashboard/teacher/exams/edit.blade.php
📏 SIZE: 17.73 KB
🕒 MODIFIED: 2025-12-02 08:22:52
──────────────────────────────────────────────────────────────────────

@extends('layouts.app')
@section('title', 'ویرایش آزمون')

@push('styles')
    <style>
        .form-card {
            border: 0;
            border-radius: 1.25rem;
            background: #fff;
            box-shadow: 0 8px 24px rgba(18, 38, 63, .06)
        }

        .step-pill {
            border-radius: 999px;
            padding: .35rem .8rem;
            font-weight: 700;
            font-size: .85rem;
            background: #f8fafc;
            color: #334155;
            display: inline-flex;
            align-items: center;
            gap: .4rem
        }

        .step-pill .dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #16a34a;
            box-shadow: 0 0 0 4px rgba(22, 163, 74, .12)
        }

        .input-soft {
            border: 0;
            box-shadow: 0 6px 18px rgba(18, 38, 63, .06);
            border-radius: .9rem;
            padding: .7rem .9rem
        }

        .input-soft:focus {
            box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .15)
        }

        .hint {
            font-size: .85rem;
            color: #6c757d
        }

        .preview-card {
            border: 1px dashed #e2e8f0;
            border-radius: 1.25rem;
            background: linear-gradient(180deg, #fff, #f8fafc)
        }

        .preview-badge {
            background: rgba(16, 185, 129, .12);
            color: #059669;
            font-weight: 800
        }

        .btn-wizard {
            border-radius: 1rem;
            padding: .7rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: .5rem
        }

        .floating-help {
            position: sticky;
            top: 90px
        }

        .danger-zone {
            border: 1px solid rgba(220, 53, 69, .2);
            background: rgba(220, 53, 69, .04);
            border-radius: 1rem
        }
    </style>
@endpush

@section('content')
    <div class="container-fluid">

        {{-- Header --}}
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2 fade-up">
            <div>
                <h4 class="fw-bold mb-1"><i class="bi bi-pencil-square me-1 text-warning"></i> ویرایش آزمون</h4>
                <div class="text-muted small">
                    تغییرات را اعمال کن و ذخیره بزن. وضعیت انتشار و تاریخ را هم می‌توانی آپدیت کنی.
                </div>
            </div>
            <div class="d-flex gap-2">
                <a href="{{ route('teacher.exams.questions.index', $exam) }}"
                    class="btn btn-outline-primary d-inline-flex align-items-center gap-2 shadow-sm">
                    <i class="bi bi-question-circle"></i>
                    مدیریت سوال‌ها
                </a>
                <a href="{{ route('teacher.exams.index') }}"
                    class="btn btn-outline-secondary d-inline-flex align-items-center gap-2 shadow-sm">
                    <i class="bi bi-arrow-right"></i>
                    بازگشت
                </a>
            </div>
        </div>

        {{-- Validation errors --}}
        @if ($errors->any())
            <div class="alert alert-danger fade-up">
                <div class="fw-semibold mb-2"><i class="bi bi-exclamation-triangle-fill me-1"></i> لطفاً خطاهای زیر را بررسی
                    کن:</div>
                <ul class="mb-0">
                    @foreach ($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        @if (session('success'))
            <div class="alert alert-success fade-up">
                <i class="bi bi-check-circle-fill me-1"></i>
                {{ session('success') }}
            </div>
        @endif

        <div class="row g-3">

            {{-- Form column --}}
            <div class="col-lg-8">
                <div class="form-card p-3 p-md-4 fade-up">

                    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
                        <div class="step-pill"><span class="dot"></span> ویرایش اطلاعات آزمون</div>
                        <div class="hint">* فیلدهای ستاره‌دار ضروری‌اند.</div>
                    </div>

                    <form action="{{ route('teacher.exams.update', $exam) }}" method="POST" class="row g-3" novalidate>
                        @csrf
                        @method('PUT')

                        {{-- Title --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold">عنوان آزمون <span class="text-danger">*</span></label>
                            <input type="text" name="title" class="form-control input-soft"
                                placeholder="مثلاً: آزمون فصل ۱ ریاضی" value="{{ old('title', $exam->title) }}" required>
                        </div>
                        {{-- ✅ NEW: Scope + Classroom --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold d-block">نوع آزمون <span
                                    class="text-danger">*</span></label>

                            @php $scopeVal = old('scope', $exam->scope ?? 'classroom'); @endphp

                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="scope" id="editScopeClassroom"
                                    value="classroom" {{ $scopeVal === 'classroom' ? 'checked' : '' }}>
                                <label class="form-check-label" for="editScopeClassroom">کلاسی</label>
                            </div>

                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="scope" id="editScopeFree"
                                    value="free" {{ $scopeVal === 'free' ? 'checked' : '' }}>
                                <label class="form-check-label" for="editScopeFree">آزاد</label>
                            </div>

                            <div class="hint mt-1">اگر آزمون آزاد باشد، به هیچ کلاسی وصل نیست.</div>
                        </div>

                        <div class="col-md-6" id="editClassroomBox">
                            <label class="form-label fw-semibold">کلاس مربوطه <span class="text-danger">*</span></label>
                            <select name="classroom_id" class="form-select input-soft">
                                <option value="">انتخاب کلاس...</option>
                                @foreach ($classrooms as $c)
                                    <option value="{{ $c->id }}"
                                        {{ old('classroom_id', $exam->classroom_id) == $c->id ? 'selected' : '' }}>
                                        {{ $c->title ?? $c->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>

                        {{-- Subject & Level --}}
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">درس / موضوع <span class="text-danger">*</span></label>
                            <select name="subject" class="form-select input-soft" required>
                                <option value="" disabled>انتخاب درس</option>
                                @foreach ($subjects ?? [] as $s)
                                    <option value="{{ $s }}"
                                        {{ old('subject', $exam->subject) === $s ? 'selected' : '' }}>{{ $s }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">سطح آزمون <span class="text-danger">*</span></label>
                            <select name="level" class="form-select input-soft" required>
                                @php $lvl = old('level', $exam->level); @endphp
                                <option value="taghviyati" {{ $lvl === 'taghviyati' ? 'selected' : '' }}>تقویتی</option>
                                <option value="konkur" {{ $lvl === 'konkur' ? 'selected' : '' }}>کنکور</option>
                                <option value="olympiad" {{ $lvl === 'olympiad' ? 'selected' : '' }}>المپیاد</option>
                            </select>
                        </div>

                        {{-- Duration & Start time --}}
                        <div class="col-md-4">
                            <label class="form-label fw-semibold">مدت آزمون (دقیقه) <span
                                    class="text-danger">*</span></label>
                            <input type="number" min="1" name="duration" class="form-control input-soft"
                                value="{{ old('duration', $exam->duration) }}" required>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label fw-semibold">تاریخ و زمان شروع <span
                                    class="text-danger">*</span></label>
                            <input type="datetime-local" name="start_at" class="form-control input-soft"
                                value="{{ old('start_at', optional($exam->start_at)->format('Y-m-d\TH:i')) }}" required>
                            <div class="hint mt-1">تاریخ/زمان را برای هماهنگی برگزاری تنظیم کن.</div>
                        </div>

                        {{-- Description --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold">توضیحات</label>
                            <textarea name="description" rows="4" class="form-control input-soft"
                                placeholder="توضیحات کوتاه درباره هدف آزمون...">{{ old('description', $exam->description) }}</textarea>
                        </div>

                        {{-- Publish toggle --}}
                        <div class="col-12">
                            @php $pub = old('is_published', $exam->is_published); @endphp
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="publishSwitch"
                                    name="is_published" value="1" {{ $pub ? 'checked' : '' }}>
                                <label class="form-check-label fw-semibold" for="publishSwitch">آزمون منتشر باشد</label>
                            </div>
                            <div class="hint mt-1">در صورت انتشار، آزمون برای دانش‌آموزها قابل مشاهده می‌شود.</div>
                        </div>

                        {{-- Actions --}}
                        <div class="col-12 d-flex flex-wrap gap-2 mt-2">
                            <button type="submit" class="btn btn-primary btn-wizard shadow-sm">
                                <i class="bi bi-save2"></i>
                                ذخیره تغییرات
                            </button>
                            <a href="{{ route('teacher.exams.questions.index', $exam) }}"
                                class="btn btn-outline-primary btn-wizard shadow-sm">
                                <i class="bi bi-question-circle"></i>
                                رفتن به سوال‌ها
                            </a>
                        </div>

                    </form>

                    {{-- Danger zone (optional delete here too) --}}
                    <div class="danger-zone p-3 mt-4">
                        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                            <div>
                                <div class="fw-bold text-danger"><i class="bi bi-trash3 me-1"></i> حذف آزمون</div>
                                <div class="small text-muted">این عملیات غیرقابل بازگشت است.</div>
                            </div>
                            <form action="{{ route('teacher.exams.destroy', $exam) }}" method="POST">
                                @csrf @method('DELETE')
                                <button class="btn btn-outline-danger btn-wizard"
                                    onclick="return confirm('آیا از حذف آزمون مطمئن هستید؟')">
                                    حذف قطعی
                                </button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>

            {{-- Preview / tips column --}}
            <div class="col-lg-4">
                <div class="floating-help fade-up">

                    <div class="preview-card p-3 mb-3">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="fw-bold"><i class="bi bi-eye me-1"></i> پیش‌نمایش سریع</div>
                            <span class="badge preview-badge">Live</span>
                        </div>
                        <div class="small text-muted mb-2">با تغییر فرم، این کارت آپدیت می‌شود.</div>

                        <div class="border rounded-3 p-3 bg-white" id="livePreview">
                            <div class="fw-semibold" id="pvTitle">{{ $exam->title }}</div>
                            <div class="text-muted small mt-1" id="pvMeta">{{ $exam->level }} • {{ $exam->subject }}
                                • {{ $exam->duration }} دقیقه</div>
                            <div class="text-muted small mt-2" id="pvStart">شروع:
                                {{ optional($exam->start_at)->format('Y/m/d H:i') }}</div>
                            <div class="mt-2">
                                @if ($exam->is_published)
                                    <span class="badge bg-success"><i class="bi bi-broadcast-pin me-1"></i> منتشر
                                        شده</span>
                                @else
                                    <span class="badge bg-secondary"><i class="bi bi-pencil-square me-1"></i>
                                        پیش‌نویس</span>
                                @endif
                            </div>
                        </div>
                    </div>

                    <div class="form-card p-3">
                        <div class="fw-bold mb-2"><i class="bi bi-lightbulb me-1 text-warning"></i> پیشنهادهای بهبود</div>
                        <ul class="small text-muted mb-0 ps-3">
                            <li>قبل از انتشار، حداقل ۵ سؤال اضافه کن.</li>
                            <li>اگر زمان برگزاری تغییر کرد، اطلاعیه بفرست.</li>
                            <li>می‌توانی بعداً مدت و سطح را اصلاح کنی.</li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </div>

    @push('scripts')
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const title = document.querySelector('input[name="title"]');
                const subject = document.querySelector('select[name="subject"]');
                const level = document.querySelector('select[name="level"]');
                const duration = document.querySelector('input[name="duration"]');
                const startAt = document.querySelector('input[name="start_at"]');

                const pvTitle = document.getElementById('pvTitle');
                const pvMeta = document.getElementById('pvMeta');
                const pvStart = document.getElementById('pvStart');

                function updatePreview() {
                    if (pvTitle) pvTitle.textContent = title?.value?.trim() || 'عنوان آزمون';
                    const s = subject?.value || 'درس';
                    const l = level?.value || 'سطح';
                    const d = duration?.value || '—';
                    if (pvMeta) pvMeta.textContent = `${l} • ${s} • ${d} دقیقه`;
                    if (pvStart) pvStart.textContent = startAt?.value ? `شروع: ${startAt.value.replace('T',' ')}` :
                        'زمان شروع';
                }

                [title, subject, level, duration, startAt].forEach(el => el?.addEventListener('input', updatePreview));
                updatePreview();
            });
            // ✅ NEW: toggle classroom box in edit
            const editScopeFree = document.getElementById('editScopeFree');
            const editScopeClassroom = document.getElementById('editScopeClassroom');
            const editClassroomBox = document.getElementById('editClassroomBox');
            const editClassroomSelect = editClassroomBox?.querySelector('select[name="classroom_id"]');

            function toggleEditClassroom() {
                const isFree = editScopeFree?.checked;
                if (editClassroomBox) editClassroomBox.style.display = isFree ? 'none' : 'block';
                if (editClassroomSelect) editClassroomSelect.required = !isFree;
            }

            editScopeFree?.addEventListener('change', toggleEditClassroom);
            editScopeClassroom?.addEventListener('change', toggleEditClassroom);
            toggleEditClassroom();
        </script>
    @endpush
@endsection


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 6: edit.blade.php
📍 PATH: resources/views/dashboard/admin/taxonomies/edit.blade.php
📝 Original line #6: resources/views/dashboard/admin/taxonomies/edit.blade.php
📏 SIZE: 993 B
🕒 MODIFIED: 2025-12-07 08:14:00
──────────────────────────────────────────────────────────────────────

@extends('layouts.app')

@php
    $title = $title ?? 'آیتم';
    $routeName = $routeName ?? 'admin.sections';
    $item = $item ?? null;
@endphp

@section('title', 'ویرایش ' . $title)

@section('content')
    <div class="container py-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold">ویرایش {{ $title }}</h3>
            <a href="{{ route($routeName . '.index') }}" class="btn btn-outline-secondary btn-sm">
                بازگشت به لیست
            </a>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                @include('dashboard.admin.taxonomies._form', [
                    'mode' => 'edit',
                    'title' => $title,
                    'routeName' => $routeName,
                    'item' => $item,
                    'formFields' => $formFields ?? null,
                ])
            </div>
        </div>

    </div>
@endsection


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 7: exam-wizard.js
📍 PATH: public/assets/js/exam-wizard.js
📝 Original line #7: public/assets/js/exam-wizard.js
📏 SIZE: 25.77 KB
🕒 MODIFIED: 2025-12-06 22:14:07
──────────────────────────────────────────────────────────────────────

/* ===========================================================
 * exam-wizard.js (UUID + AJAX Real Data)
 * سازگار با routes/teacher.php و TeacherExamController
 * =========================================================== */

let currentStep = 1;

const endpoint = {
  sections: "/dashboard/teacher/exams/data/sections",
  grades: "/dashboard/teacher/exams/data/grades",
  branches: "/dashboard/teacher/exams/data/branches",
  fields: "/dashboard/teacher/exams/data/fields",
  subfields: "/dashboard/teacher/exams/data/subfields",
  subjectTypes: "/dashboard/teacher/exams/data/subject-types",
  subjects: "/dashboard/teacher/exams/data/subjects",
  classMeta: (id) => `/dashboard/teacher/classes/${id}/meta`,
  classesAjax: "/dashboard/teacher/classes?ajax=1"
};

// UI Names (preview)
const examTypeNames = {
  public: "آزمون عمومی",
  class_single: "کلاسی تک درس",
  class_comprehensive: "کلاسی جامع"
};

const subjectTypeFallbackNames = {
  base_competency: "شایستگی پایه",
  non_technical_competency: "شایستگی غیرفنی",
  technical_competency: "شایستگی فنی",
  general: "دروس عمومی",
  all: "همه دروس",
  specialized_competency: "شایستگی‌های تخصصی"
};

// state
let formData = {
  examType: "",
  classroomId: null,
  classroomName: "",

  sectionId: "",
  sectionName: "",

  gradeId: "",
  gradeName: "",

  branchId: "",
  branchName: "",

  fieldId: "",
  fieldName: "",

  subfieldId: "",
  subfieldName: "",

  subjectTypeId: "",
  subjectTypeSlug: "",
  subjectTypeName: "",

  selectedSubjects: [], // UUID[]
  totalQuestions: 0
};

/* ===================== helpers ===================== */

const qs = (sel) => document.querySelector(sel);
const qsa = (sel) => Array.from(document.querySelectorAll(sel));

const csrf = () =>
  document.querySelector('meta[name="csrf-token"]')?.content || "";

function setHidden(id, val) {
  const el = qs(id);
  if (el) el.value = val ?? "";
}

function showToast(message, icon = "error") {
  if (typeof Swal === "undefined") {
    alert(message);
    return;
  }
  Swal.fire({
    toast: true,
    position: "top-start",
    icon,
    title: message,
    showConfirmButton: false,
    timer: 2500,
    timerProgressBar: true
  });
}

async function getJSON(url) {
  const res = await fetch(url, {
    headers: {
      Accept: "application/json",
      "X-Requested-With": "XMLHttpRequest"
    }
  });
  if (!res.ok) throw new Error("Network error");
  return res.json();
}

/* ===================== init ===================== */

document.addEventListener("DOMContentLoaded", () => {
  updateProgress();
  updateNavigationButtons();
  loadFromLocalStorage();

  // اگر از قبل examType انتخاب شده بود و کلاسی بود کلاس‌ها رو لود کن
  if (formData.examType && formData.examType !== "public") {
    showClassroomSection(true);
    loadExistingClassrooms();
  }
});

/* ===================== step 1 exam type ===================== */

window.selectExamType = function (type) {
  qsa(".type-card").forEach((c) => c.classList.remove("selected"));
  qs(`.type-card[data-type="${type}"]`)?.classList.add("selected");

  formData.examType = type;
  setHidden("#examType", type);

  if (type === "public") {
    showClassroomSection(false);
    formData.classroomId = null;
    formData.classroomName = "";
    setHidden("#classroomId", "");
    enableNext(true);
  } else {
    showClassroomSection(true);
    loadExistingClassrooms();
    enableNext(false);
  }

  updatePreview();
  saveToLocalStorage();
};

function showClassroomSection(show) {
  const sec = qs("#classroomSelectionSection");
  if (!sec) return;
  sec.style.display = show ? "block" : "none";
}

function enableNext(enable) {
  const btn = qs(".btn-next");
  if (!btn) return;
  btn.disabled = !enable;
  btn.classList.toggle("disabled", !enable);
}

/* -------- load classrooms (UUID) -------- */

window.loadExistingClassrooms = async function () {
  const container = qs("#existingClassroomsContainer");
  if (!container) return;

  container.innerHTML = `
    <div class="loading-spinner" style="grid-column: 1 / -1; text-align:center; padding:20px;">
      <i class="fas fa-spinner fa-spin"></i>
      در حال بارگذاری کلاس‌ها...
    </div>
  `;

  try {
    const data = await getJSON(endpoint.classesAjax);

    container.innerHTML = "";

    const classes = data.classrooms || [];
    if (classes.length === 0) {
      container.innerHTML = `
        <div style="grid-column: 1 / -1; text-align:center; padding:20px; color:#777;">
          کلاسی یافت نشد. لطفاً کلاس جدید بسازید.
        </div>
      `;
      return;
    }

    classes.forEach((classroom) => {
      const card = document.createElement("div");
      card.className = "selection-card";
      card.dataset.classroomId = classroom.id;
      card.innerHTML = `
        <div class="selection-icon">🏫</div>
        <div class="selection-name">${classroom.title}</div>
        <p class="selection-description">
          <small>${classroom.grade || "بدون پایه"} - ${classroom.subject || "بدون موضوع"}</small>
          <br><strong>${classroom.students_count || 0} هنرجو</strong>
        </p>
      `;
      card.onclick = (e) =>
        selectClassroom(e, classroom.id, classroom.title);
      container.appendChild(card);
    });

    // اگر قبلاً انتخاب داشته
    if (formData.classroomId) {
      container
        .querySelector(
          `[data-classroom-id="${formData.classroomId}"]`
        )
        ?.classList.add("selected");
      enableNext(true);
    }
  } catch (err) {
    console.error(err);
    container.innerHTML = `
      <div style="grid-column: 1 / -1; text-align:center; padding:20px; color:#e67;">
        خطا در دریافت کلاس‌ها
        <br>
        <button type="button" onclick="loadExistingClassrooms()" class="btn-nav" style="padding:10px 20px; margin-top:15px;">تلاش مجدد</button>
      </div>
    `;
  }
};

/* -------- select classroom + auto-fill meta -------- */

window.selectClassroom = async function (e, classroomId, classroomName) {
  qsa("#existingClassroomsContainer .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.classroomId = classroomId;
  formData.classroomName = classroomName;
  setHidden("#classroomId", classroomId);

  // meta
  try {
    const metaData = await getJSON(endpoint.classMeta(classroomId));
    const meta = metaData.classroom || {};

    if (meta.section_id) {
      formData.sectionId = meta.section_id;
      setHidden("#sectionId", meta.section_id);
    }

    if (meta.grade_id) {
      formData.gradeId = meta.grade_id;
      setHidden("#gradeId", meta.grade_id);
    }

    if (meta.branch_id) {
      formData.branchId = meta.branch_id;
      setHidden("#branchId", meta.branch_id);
    }

    if (meta.field_id) {
      formData.fieldId = meta.field_id;
      setHidden("#fieldId", meta.field_id);
    }

    if (meta.subfield_id) {
      formData.subfieldId = meta.subfield_id;
      setHidden("#subfieldId", meta.subfield_id);
    }

    // اگر جامع کلاسی بود subjectType=all
    if (formData.examType === "class_comprehensive") {
      formData.subjectTypeSlug = "all";
      formData.subjectTypeName = subjectTypeFallbackNames.all;
      formData.subjectTypeId = "";
      setHidden("#subjectTypeId", "");
      calculateCoefficients("all");
    }
  } catch (err) {
    console.error("class meta error", err);
  }

  enableNext(true);
  updatePreview();
  saveToLocalStorage();
  nextStep();
};

/* ===================== step 2 sections/grades ===================== */

async function loadSectionsIfNeeded() {
  // اگر در بلید step0/step2 ندارید می‌تونید حذفش کنید
  // فعلا فقط اگر hidden وجود داشت ست می‌کنیم
  try {
    const data = await getJSON(endpoint.sections);
    // اینجا UI نداره، فقط نگه میداریم برای فیلتر grade/branch
    formData.sectionsList = data.sections || [];
  } catch (e) {}
}

/* -------- load grades -------- */
async function loadGrades() {
  const container = qs("#gradesGrid");
  if (!container) return;

  container.innerHTML = `<div class="loading-spinner" style="grid-column:1/-1;text-align:center;">در حال بارگذاری...</div>`;

  const params = new URLSearchParams();
  if (formData.sectionId) params.append("section_id", formData.sectionId);

  const data = await getJSON(`${endpoint.grades}?${params.toString()}`);

  container.innerHTML = "";
  (data.grades || []).forEach((g) => {
    const card = document.createElement("div");
    card.className = "selection-card";
    card.innerHTML = `
      <div class="selection-icon">📘</div>
      <div class="selection-name">${g.name_fa}</div>
      <p class="selection-description">${g.slug || ""}</p>
    `;
    card.onclick = (e) => selectGrade(e, g.id, g.name_fa);
    container.appendChild(card);
  });

  // restore
  if (formData.gradeId) {
    container.querySelectorAll(".selection-card").forEach((c) => {
      if (c.textContent.includes(formData.gradeName)) c.classList.add("selected");
    });
  }
}

window.selectGrade = function (e, gradeId, gradeName) {
  qsa("#gradesGrid .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.gradeId = gradeId;
  formData.gradeName = gradeName;
  setHidden("#gradeId", gradeId);

  updatePreview();
  saveToLocalStorage();
};

/* ===================== step 3 branches ===================== */

async function loadBranches() {
  const container = qs("#branchesGrid");
  if (!container) return;

  container.innerHTML = `<div class="loading-spinner" style="grid-column:1/-1;text-align:center;">در حال بارگذاری...</div>`;

  const params = new URLSearchParams();
  if (formData.sectionId) params.append("section_id", formData.sectionId);

  const data = await getJSON(`${endpoint.branches}?${params.toString()}`);

  container.innerHTML = "";
  (data.branches || []).forEach((b) => {
    const card = document.createElement("div");
    card.className = "selection-card";
    card.innerHTML = `
      <div class="selection-icon">🎓</div>
      <div class="selection-name">${b.name_fa}</div>
      <p class="selection-description">${b.slug || ""}</p>
    `;
    card.onclick = (e) => selectBranch(e, b.id, b.name_fa);
    container.appendChild(card);
  });
}

window.selectBranch = function (e, branchId, branchName) {
  qsa("#branchesGrid .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.branchId = branchId;
  formData.branchName = branchName;
  setHidden("#branchId", branchId);

  // با تغییر branch فیلدها و زیررشته‌ها ریست
  formData.fieldId = "";
  formData.fieldName = "";
  setHidden("#fieldId", "");
  formData.subfieldId = "";
  formData.subfieldName = "";
  setHidden("#subfieldId", "");

  updatePreview();
  saveToLocalStorage();
};

/* ===================== step 4 fields ===================== */

async function loadFields() {
  const container = qs("#fieldsGrid");
  if (!container) return;

  container.innerHTML = `<div class="loading-spinner" style="grid-column:1/-1;text-align:center;">در حال بارگذاری...</div>`;

  const params = new URLSearchParams();
  if (formData.branchId) params.append("branch_id", formData.branchId);

  const data = await getJSON(`${endpoint.fields}?${params.toString()}`);

  container.innerHTML = "";
  (data.fields || []).forEach((f) => {
    const card = document.createElement("div");
    card.className = "selection-card";
    card.innerHTML = `
      <div class="selection-icon">🏭</div>
      <div class="selection-name">${f.name_fa}</div>
      <p class="selection-description">${f.slug || ""}</p>
    `;
    card.onclick = (e) => selectField(e, f.id, f.name_fa);
    container.appendChild(card);
  });
}

window.selectField = function (e, fieldId, fieldName) {
  qsa("#fieldsGrid .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.fieldId = fieldId;
  formData.fieldName = fieldName;
  setHidden("#fieldId", fieldId);

  // ریست زیررشته
  formData.subfieldId = "";
  formData.subfieldName = "";
  setHidden("#subfieldId", "");

  updatePreview();
  saveToLocalStorage();
};

/* ===================== step 5 subfields ===================== */

async function loadSubfields() {
  const container = qs("#subfieldGrid");
  if (!container) return;

  container.innerHTML = `<div class="loading-spinner" style="grid-column:1/-1;text-align:center;">در حال بارگذاری...</div>`;

  const params = new URLSearchParams();
  if (formData.fieldId) params.append("field_id", formData.fieldId);

  const data = await getJSON(`${endpoint.subfields}?${params.toString()}`);

  container.innerHTML = "";
  (data.subfields || []).forEach((s) => {
    const card = document.createElement("div");
    card.className = "selection-card";
    card.innerHTML = `
      <div class="selection-icon">🔬</div>
      <div class="selection-name">${s.name_fa}</div>
      <p class="selection-description">${s.slug || ""}</p>
    `;
    card.onclick = (e) => selectSubfield(e, s.id, s.name_fa);
    container.appendChild(card);
  });
}

window.selectSubfield = function (e, subfieldId, subfieldName) {
  qsa("#subfieldGrid .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.subfieldId = subfieldId;
  formData.subfieldName = subfieldName;
  setHidden("#subfieldId", subfieldId);

  updatePreview();
  saveToLocalStorage();
};

/* ===================== step 6 subject types ===================== */

async function loadSubjectTypes() {
  const container = qs("#subjectTypesGrid");
  if (!container) return;

  container.innerHTML = `<div class="loading-spinner" style="grid-column:1/-1;text-align:center;">در حال بارگذاری...</div>`;

  const data = await getJSON(endpoint.subjectTypes);

  container.innerHTML = "";
  (data.subject_types || []).forEach((st) => {
    const card = document.createElement("div");
    card.className = "selection-card";
    card.dataset.slug = st.slug;
    card.innerHTML = `
      <div class="selection-icon">📚</div>
      <div class="selection-name">${st.name_fa}</div>
      <p class="selection-description">${st.slug || ""}</p>
    `;
    card.onclick = (e) =>
      selectSubjectType(e, st.id, st.slug, st.name_fa);
    container.appendChild(card);
  });

  // restore
  if (formData.subjectTypeId) {
    container.querySelectorAll(".selection-card").forEach((c) => {
      if (c.textContent.includes(formData.subjectTypeName)) c.classList.add("selected");
    });
  }
}

window.selectSubjectType = function (e, id, slug, name) {
  qsa("#subjectTypesGrid .selection-card").forEach((c) =>
    c.classList.remove("selected")
  );
  e?.target?.closest(".selection-card")?.classList.add("selected");

  formData.subjectTypeId = id;
  formData.subjectTypeSlug = slug;
  formData.subjectTypeName = name;

  setHidden("#subjectTypeId", id);

  calculateCoefficients(slug);
  updatePreview();
  saveToLocalStorage();
};

/* ---------- coefficient section (simple, your previous UI can stay) ---------- */
function calculateCoefficients(slug) {
  // اینجا فقط totalQuestions رو نگه میداریم؛
  // اگر UI ضرایب داری همون قبلی می‌تونه بماند.
  if (slug === "all") formData.totalQuestions = 115;
  else if (slug === "technical_competency") formData.totalQuestions = 60;
  else if (slug === "base_competency") formData.totalQuestions = 35;
  else if (slug === "non_technical_competency") formData.totalQuestions = 20;
  else formData.totalQuestions = 0;

  qs("#previewTotalQuestions") &&
    (qs("#previewTotalQuestions").textContent =
      formData.totalQuestions + " سوال");
}

/* ===================== step 7 subjects ===================== */

async function loadSubjects() {
  const container = qs("#subjectsContainer");
  if (!container) return;

  container.innerHTML =
    '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> در حال بارگذاری دروس...</div>';

  // فیلترها
  const params = new URLSearchParams();
  if (formData.gradeId) params.append("grade_id", formData.gradeId);
  if (formData.branchId) params.append("branch_id", formData.branchId);
  if (formData.fieldId) params.append("field_id", formData.fieldId);
  if (formData.subfieldId) params.append("subfield_id", formData.subfieldId);
  if (formData.subjectTypeId && formData.subjectTypeSlug !== "all")
    params.append("subject_type_id", formData.subjectTypeId);

  try {
    const data = await getJSON(
      `${endpoint.subjects}?${params.toString()}`
    );
    const subjects = data.subjects || [];

    if (subjects.length === 0) {
      container.innerHTML =
        '<div class="alert alert-info">هیچ درسی یافت نشد.</div>';
      return;
    }

    displaySubjects(subjects);
  } catch (e) {
    console.error(e);
    container.innerHTML =
      '<div class="alert alert-danger">خطا در دریافت دروس.</div>';
  }
}

function displaySubjects(subjects) {
  const container = qs("#subjectsContainer");
  container.innerHTML = "";

  subjects.forEach((subject) => {
    const item = document.createElement("div");
    item.className = "subject-item";
    item.innerHTML = `
      <div class="subject-checkbox">
        <input type="checkbox" id="subject_${subject.id}"
               value="${subject.id}" onchange="updateSelectedSubjects()">
      </div>
      <div class="subject-info">
        <div class="subject-name">${subject.title_fa}</div>
        <div class="subject-meta">
          <span class="subject-code">${subject.code || "-"}</span>
          <span>${subject.hours || 0} ساعت</span>
        </div>
      </div>
    `;

    container.appendChild(item);
  });

  // در حالت all همه انتخاب شوند
  if (formData.subjectTypeSlug === "all") {
    setTimeout(() => {
      qsa(".subject-checkbox input").forEach((cb) => (cb.checked = true));
      updateSelectedSubjects();
    }, 50);
  }

  // restore subject selections
  if (formData.selectedSubjects.length) {
    setTimeout(() => {
      formData.selectedSubjects.forEach((id) => {
        qs(`#subject_${id}`) && (qs(`#subject_${id}`).checked = true);
      });
      updateSelectedSubjects();
    }, 50);
  }
}

window.updateSelectedSubjects = function () {
  const checked = qsa(".subject-checkbox input:checked");
  formData.selectedSubjects = checked.map((cb) => cb.value);

  setHidden("#subjectsInput", formData.selectedSubjects.join(","));

  const countEl = qs("#previewSubjectsCount");
  if (countEl) countEl.textContent = formData.selectedSubjects.length + " درس";

  saveToLocalStorage();
};

/* ===================== step 8 preview ===================== */

function updatePreview() {
  qs("#previewExamType") &&
    (qs("#previewExamType").textContent =
      examTypeNames[formData.examType] || "--");

  qs("#previewGrade") &&
    (qs("#previewGrade").textContent =
      formData.gradeName || "--");

  qs("#previewBranch") &&
    (qs("#previewBranch").textContent =
      formData.branchName || "--");

  qs("#previewField") &&
    (qs("#previewField").textContent =
      formData.fieldName || "--");

  qs("#previewSubfield") &&
    (qs("#previewSubfield").textContent =
      formData.subfieldName || "--");

  qs("#previewSubjectType") &&
    (qs("#previewSubjectType").textContent =
      formData.subjectTypeName ||
      subjectTypeFallbackNames[formData.subjectTypeSlug] ||
      "--");

  qs("#previewSubjectsCount") &&
    (qs("#previewSubjectsCount").textContent =
      formData.selectedSubjects.length
        ? formData.selectedSubjects.length + " درس"
        : "--");
}

/* ===================== navigation ===================== */

window.nextStep = function () {
  if (!validateCurrentStep()) return;

  if (currentStep < 8) {
    qs(`#step${currentStep}`)?.classList.remove("active");
    currentStep++;
    qs(`#step${currentStep}`)?.classList.add("active");

    handleStepChange();
    updateProgress();
    updateNavigationButtons();
    updatePreview();
    saveToLocalStorage();

    window.scrollTo({ top: 0, behavior: "smooth" });
  }
};

window.prevStep = function () {
  if (currentStep > 1) {
    qs(`#step${currentStep}`)?.classList.remove("active");
    currentStep--;
    qs(`#step${currentStep}`)?.classList.add("active");

    updateProgress();
    updateNavigationButtons();
    updatePreview();
    saveToLocalStorage();

    window.scrollTo({ top: 0, behavior: "smooth" });
  }
};

function handleStepChange() {
  if (currentStep === 2) loadGrades();
  if (currentStep === 3) loadBranches();
  if (currentStep === 4) loadFields();
  if (currentStep === 5) loadSubfields();
  if (currentStep === 6) loadSubjectTypes();
  if (currentStep === 7) loadSubjects();
}

/* ===================== validation ===================== */

function validateCurrentStep() {
  let ok = true;
  let msg = "";

  switch (currentStep) {
    case 1:
      if (!formData.examType) {
        ok = false;
        msg = "لطفاً نوع آزمون را انتخاب کنید.";
      }
      if (formData.examType !== "public" && !formData.classroomId) {
        ok = false;
        msg = "لطفاً یک کلاس انتخاب کنید.";
      }
      break;

    case 2:
      if (!formData.gradeId) {
        ok = false;
        msg = "لطفاً پایه تحصیلی را انتخاب کنید.";
      }
      break;

    case 3:
      if (!formData.branchId) {
        ok = false;
        msg = "لطفاً شاخه تحصیلی را انتخاب کنید.";
      }
      break;

    case 4:
      if (!formData.fieldId) {
        ok = false;
        msg = "لطفاً زمینه فنی را انتخاب کنید.";
      }
      break;

    case 5:
      if (!formData.subfieldId) {
        ok = false;
        msg = "لطفاً زیررشته را انتخاب کنید.";
      }
      break;

    case 6:
      if (!formData.subjectTypeSlug && !formData.subjectTypeId) {
        ok = false;
        msg = "لطفاً دسته درسی را انتخاب کنید.";
      }
      break;

    case 7:
      if (
        formData.selectedSubjects.length === 0 &&
        formData.subjectTypeSlug !== "all"
      ) {
        ok = false;
        msg = "لطفاً حداقل یک درس انتخاب کنید.";
      }
      break;
  }

  if (!ok && msg) showToast(msg, "error");
  return ok;
}

window.validateFinalStep = function () {
  if (
    !formData.examType ||
    !formData.gradeId ||
    !formData.branchId ||
    !formData.fieldId ||
    !formData.subfieldId ||
    (!formData.subjectTypeSlug && !formData.subjectTypeId)
  ) {
    showToast("لطفاً تمام مراحل را تکمیل کنید.", "error");
    return false;
  }

  if (
    formData.selectedSubjects.length === 0 &&
    formData.subjectTypeSlug !== "all"
  ) {
    showToast("لطفاً حداقل یک درس انتخاب کنید.", "error");
    return false;
  }

  localStorage.removeItem("examFormData");
  localStorage.removeItem("examCurrentStep");
  return true;
};

/* ===================== progress ===================== */

function updateProgress() {
  const progress = (currentStep / 8) * 100;
  qs("#progressFill") &&
    (qs("#progressFill").style.width = `${progress}%`);

  qsa(".step-item").forEach((item, index) => {
    item.classList.remove("active", "completed");
    if (index + 1 < currentStep) item.classList.add("completed");
    else if (index + 1 === currentStep) item.classList.add("active");
  });
}

function updateNavigationButtons() {
  const prevBtn = qs(".btn-prev");
  const nextBtn = qs(".btn-next");
  const submitBtn = qs(".btn-submit");

  if (currentStep === 1) {
    prevBtn.style.display = "none";
    nextBtn.style.display = "flex";
    submitBtn.style.display = "none";
  } else if (currentStep === 8) {
    prevBtn.style.display = "flex";
    nextBtn.style.display = "none";
    submitBtn.style.display = "flex";
  } else {
    prevBtn.style.display = "flex";
    nextBtn.style.display = "flex";
    submitBtn.style.display = "none";
  }
}

/* ===================== local storage ===================== */

function saveToLocalStorage() {
  localStorage.setItem("examFormData", JSON.stringify(formData));
  localStorage.setItem("examCurrentStep", currentStep);
}

function loadFromLocalStorage() {
  const savedData = localStorage.getItem("examFormData");
  const savedStep = localStorage.getItem("examCurrentStep");

  if (savedData) {
    formData = { ...formData, ...JSON.parse(savedData) };
    if (savedStep) currentStep = parseInt(savedStep);

    // restore hidden values
    setHidden("#examType", formData.examType);
    setHidden("#classroomId", formData.classroomId);
    setHidden("#sectionId", formData.sectionId);
    setHidden("#gradeId", formData.gradeId);
    setHidden("#branchId", formData.branchId);
    setHidden("#fieldId", formData.fieldId);
    setHidden("#subfieldId", formData.subfieldId);
    setHidden("#subjectTypeId", formData.subjectTypeId);
    setHidden("#subjectsInput", formData.selectedSubjects.join(","));

    // restore UI selections for step1 quickly
    if (formData.examType) {
      qs(`.type-card[data-type="${formData.examType}"]`)?.classList.add("selected");
    }
    if (formData.examType && formData.examType !== "public") {
      showClassroomSection(true);
      loadExistingClassrooms();
    }

    updatePreview();
    updateProgress();
    updateNavigationButtons();

    // jump to saved step
    qsa(".form-section").forEach(s => s.classList.remove("active"));
    qs(`#step${currentStep}`)?.classList.add("active");
    handleStepChange();
  }
}

// پاکسازی بعد از submit
qs("#examForm")?.addEventListener("submit", () => {
  localStorage.removeItem("examFormData");
  localStorage.removeItem("examCurrentStep");
});


......................................................................

──────────────────────────────────────────────────────────────────────
📄 FILE 8: teacher.php
📍 PATH: routes/teacher.php
📝 Original line #9: routes/teacher.php
📏 SIZE: 6.7 KB
🕒 MODIFIED: 2025-12-07 11:04:28
──────────────────────────────────────────────────────────────────────

<?php

use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| Teacher Controllers (App\Http\Controllers\Teacher)
|--------------------------------------------------------------------------
*/
use App\Http\Controllers\Teacher\DashboardController;
use App\Http\Controllers\Teacher\TeacherClassController;
use App\Http\Controllers\Teacher\TeacherExamController;
use App\Http\Controllers\Teacher\TeacherStudentController;
use App\Http\Controllers\Teacher\SubjectController;
use App\Http\Controllers\Teacher\QuestionController;

Route::prefix('dashboard')
    ->middleware(['auth', 'role.selected'])
    ->group(function () {

        Route::prefix('teacher')
            ->name('teacher.')
            ->middleware('role:teacher')
            ->group(function () {

                // ==========================================================
                // Teacher Dashboard
                // ==========================================================
                Route::get('/', [DashboardController::class, 'index'])->name('index');

                // ==========================================================
                // Classes
                // ==========================================================
                Route::get('/classes', [TeacherClassController::class, 'index'])
                    ->name('classes.index');

                Route::resource('classes', TeacherClassController::class)
                    ->parameters(['classes' => 'class'])
                    ->except(['index']);

                Route::get('classes/{class}/students', [TeacherClassController::class, 'students'])
                    ->name('classes.students');

                Route::post('classes/{class}/students', [TeacherClassController::class, 'addStudent'])
                    ->name('classes.students.add');

                Route::delete('classes/{class}/students/{student}', [TeacherClassController::class, 'removeStudent'])
                    ->name('classes.students.remove');

                // ==========================================================
                // Exams (create/store برگشت به resource کامل)
                // ==========================================================
                Route::resource('exams', TeacherExamController::class);

                // ==========================================================
                // Exams AJAX Data (برای وصل کردن UUID واقعی به فرانت)
                // این route ها را در TeacherExamController می‌سازیم
                // ==========================================================
                Route::prefix('exams/data')
                    ->name('exams.data.')
                    ->group(function () {

                        Route::get('/sections', [TeacherExamController::class, 'sections'])
                            ->name('sections');

                        Route::get('/grades', [TeacherExamController::class, 'grades'])
                            ->name('grades');

                        Route::get('/branches', [TeacherExamController::class, 'branches'])
                            ->name('branches');

                        Route::get('/fields', [TeacherExamController::class, 'fields'])
                            ->name('fields');

                        Route::get('/subfields', [TeacherExamController::class, 'subfields'])
                            ->name('subfields');

                        // ✅ FIX: باید دقیقاً subject-types باشد تا Blade خطا ندهد
                        Route::get('/subject-types', [TeacherExamController::class, 'subjectTypes'])
                            ->name('subject-types');

                        Route::get('/subjects', [TeacherExamController::class, 'subjects'])
                            ->name('subjects');
                    });

                // ==========================================================
                // Questions
                // ==========================================================
                Route::get('/exams/{exam}/questions', [QuestionController::class, 'index'])
                    ->name('exams.questions.index');
                Route::get('/exams/{exam}/questions/create', [QuestionController::class, 'create'])
                    ->name('exams.questions.create');
                Route::post('/exams/{exam}/questions', [QuestionController::class, 'store'])
                    ->name('exams.questions.store');
                Route::get('/exams/{exam}/questions/{question}/edit', [QuestionController::class, 'edit'])
                    ->name('exams.questions.edit');
                Route::put('/exams/{exam}/questions/{question}', [QuestionController::class, 'update'])
                    ->name('exams.questions.update');
                Route::delete('/exams/{exam}/questions/{question}', [QuestionController::class, 'destroy'])
                    ->name('exams.questions.destroy');

                // ==========================================================
                // Students
                // ==========================================================
                Route::get('/students', [TeacherStudentController::class, 'index'])
                    ->name('students.index');
                Route::get('/students/{student}', [TeacherStudentController::class, 'show'])
                    ->name('students.show');
                Route::get('/students/{student}/attempts', [TeacherStudentController::class, 'attempts'])
                    ->name('students.attempts');

                // Attempts
                Route::get('/attempts/{attempt}', [TeacherStudentController::class, 'attemptShow'])
                    ->name('attempts.show');
                Route::post('/attempts/{attempt}/answers/{answer}/grade', [TeacherStudentController::class, 'gradeEssayAnswer'])
                    ->name('attempts.answers.grade');

                // ==========================================================
                // Subjects
                // ==========================================================
                Route::get('/subjects', [SubjectController::class, 'index'])
                    ->name('subjects.index');
                Route::post('/subjects', [SubjectController::class, 'store'])
                    ->name('subjects.store');

                // ==========================================================
                // Static
                // ==========================================================
                Route::view('/reports', 'dashboard.teacher.reports.index')->name('reports.index');
                Route::view('/profile', 'dashboard.teacher.profile')->name('profile');
            });
    });


......................................................................

▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

════════════════════════════════════════════════════════════════════════════════
📊 FINAL SUMMARY
──────────────────────────────
Report generated: 2025-12-08 21:41:13
Input file: project_file_list_01.md
Total lines processed: 9
✅ Successfully processed: 8 files
❌ Not found: 1 files
📁 Report saved to: AI_REPORT_2025-12-08_214113.txt

⚠️  ATTENTION: Some files were not found!
   Check the paths above and update your input file.
════════════════════════════════════════════════════════════════════════════════
