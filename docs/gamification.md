# مستند گیمفیکیشن پروژه Smart-Edu

این سند، طراحی و نقشه‌ی پیاده‌سازی گیمفیکیشن در سامانه‌ی **Smart Education System** را توضیح می‌دهد. هدف، افزایش انگیزه و درگیرسازی دانش‌آموزان با محوریت «یادگیریِ قابل مشاهده و لذت‌بخش» است.

---

## 1) اهداف گیمفیکیشن

گیمفیکیشن در این پروژه برای «بازی‌کردنِ آموزش» نیست، بلکه برای ایجاد انگیزه و عادت یادگیری طراحی می‌شود. اهداف اصلی:

1. **درگیرسازی پایدار (Engagement):** دانش‌آموز در سیستم بماند و با آن تعامل کند.
2. **عادت‌سازی:** تداوم تمرین و آزمون دادن به رفتار روزمره تبدیل شود.
3. **قابل مشاهده کردن رشد:** پیشرفت به‌صورت عددی/تصویری دیده شود تا امید و انگیزه بالا برود.
4. **کاهش اضطراب آموزشی:** تمرکز روی «تلاش و پیشرفت» نه صرفاً «نمره».

---

## 2) مکانیک‌ها (Game Mechanics)

### A) سیستم XP و Level (هسته اصلی)

-   هر فعالیت آموزشی مقدار مشخصی **XP** می‌دهد.
-   با جمع شدن XP، دانش‌آموز **Level** می‌گیرد.
-   Level باید **ارزش کاربردی** داشته باشد (باز کردن امکانات/نشان‌ها/تم‌ها).

**قواعد مهم:**

-   XP فقط به نمره تعلق نگیرد؛ به **تلاش، تداوم و پیشرفت** هم داده شود.
-   از «فارم XP» جلوگیری شود (مثلاً برای آزمون‌های تکراری محدودیت یا کاهش تدریجی XP).

**نمونه منابع XP:**

-   شرکت در آزمون عمومی یا کلاسی
-   تکمیل آیتم‌های مسیر یادگیری
-   پیشرفت نسبت به عملکرد قبلی
-   تایید رفتار مثبت توسط معلم/مشاور

---

### B) Badge / Achievement (نشان‌ها)

نشان‌ها در سه گروه طراحی می‌شوند:

1. **تلاش (Effort Badges):**

    - مثال: «۳ روز پشت‌سرهم آزمون دادی»
    - مثال: «۱۰ تمرین تکمیل کردی»

2. **پیشرفت (Progress Badges):**

    - مثال: «نمره ریاضی ۱۵٪ بهتر شد»
    - مثال: «نقطه‌ضعف فیزیک پوشش داده شد»

3. **رفتاری/شخصیتی (Behavior Badges):**

    - با تایید معلم/مشاور ثبت می‌شود.
    - مثال: «پشتکار عالی»
    - مثال: «مشارکت ممتاز در کلاس»

نشان‌ها به‌صورت مدال در **پروفایل دانش‌آموز** و در داشبورد نمایش داده می‌شوند.

---

### C) Streak و Daily Goals (عادت‌سازی)

-   سیستم هدف روزانه/هفتگی برای دانش‌آموز تعریف می‌شود.
-   با انجام هدف‌ها، **Streak** بالا می‌رود.

**نمونه اهداف:**

-   امروز: ۱ آزمون + ۱ آیتم مسیر یادگیری
-   این هفته: ۳ تمرین تقویتی

**نکات:**

-   شکست streak باید یک پیام «بازگشت آسان» داشته باشد، نه تنبیه.
-   نوتیفیکیشن‌ها برای حفظ تداوم ضروری‌اند.

---

### D) Quest / Challenge (ماموریت‌ها)

ماموریت‌های کوتاه و جذاب برای ایجاد حس بازی:

-   «چالش ۵ سوالی ریاضی»
-   «سرعتی: ۱۰ دقیقه زمان داری»
-   «رفع ضعف: فقط سوال‌های سطح Basic»

هر Quest می‌تواند:

-   XP بیشتر بدهد.
-   یک badge خاص فعال کند.
-   باعث تنوع تجربه آموزشی شود.

---

### E) Leaderboard (با تنظیمات ایمن)

لیدربورد انگیزه‌دهنده است اما ممکن است مقایسه ناسالم ایجاد کند. بنابراین:

-   سه نوع رتبه‌بندی:

    1. **داخل کلاس**
    2. **داخل مدرسه/سازمان**
    3. **عمومی (جهانی)**

-   نمایش لیدربورد **اختیاری** باشد.

-   علاوه بر «رتبه نمره»، یک لیدربورد «رتبه پیشرفت» هم وجود داشته باشد.

---

### F) Currency + Shop (اختیاری، فاز بعدی)

یک ارز مجازی مثل **EduCoin/Gem/Star** که با فعالیت‌ها به دست می‌آید و برای خرید موارد زیر استفاده می‌شود:

-   تم پروفایل/آواتار
-   Hint اضافه در آزمون
-   باز کردن چالش‌های ویژه

**پیشنهاد:** این بخش بعد از تثبیت فازهای اولیه اضافه شود.

---

## 3) تغییرات دیتابیس (پیشنهاد Migration)

### جدول 1: `student_gamification_profiles`

-   `id`
-   `student_id` (FK -> users)
-   `total_xp` (int)
-   `level` (int)
-   `current_streak` (int)
-   `longest_streak` (int)
-   `coins` (int, optional)
-   `last_activity_at` (timestamp)
-   timestamps

### جدول 2: `badges`

-   `id`
-   `key` (unique)
-   `title`
-   `description`
-   `icon` (path/string)
-   `type` (enum: effort, progress, behavior)
-   `rules_json` (json: قوانین گرفتن نشان)
-   timestamps

### جدول 3: `student_badges`

-   `id`
-   `student_id`
-   `badge_id`
-   `earned_at`
-   timestamps

### جدول 4: `xp_logs`

-   `id`
-   `student_id`
-   `source_type` (enum: exam, quest, path, teacher_reward)
-   `source_id` (nullable)
-   `xp_amount`
-   timestamps

### جدول 5 (اختیاری فاز C): `quests` و `student_quests`

برای تعریف و ثبت ماموریت‌ها.

---

## 4) بک‌اند و منطق محاسبه

### تریگرهای XP

1. بعد از `submit exam` در `StudentExamController`
2. بعد از تکمیل آیتم مسیر یادگیری
3. بعد از تایید رفتار مثبت توسط Teacher/Counselor

### سرویس پیشنهادی

سرویسی مشابه `OTPService` با نام `GamificationService`:

-   `awardXp($student, $sourceType, $sourceId, $amount)`
-   `checkAndAwardBadges($student)`
-   `updateStreak($student)`
-   `calculateLevel($xp)`

**مزیت:** جداسازی منطق گیمفیکیشن از کنترلرها و خوانایی بالا.

---

## 5) UI/UX پیشنهادی

### داشبورد دانش‌آموز

-   کارت بالای صفحه:

    -   **Level**
    -   **XP Bar (progress bar)**
    -   **Streak فعلی**

-   بخش «نشان‌ها»
-   بخش «ماموریت‌های امروز»

### صفحه نتیجه آزمون

-   پیام تشویقی هوشمند:

    -   اگر پیشرفت کرده: «+XP برای بهتر شدن نسبت به قبل»
    -   اگر فقط آزمون را کامل کرده: «+XP برای تکمیل آزمون»

-   انیمیشن سبک و سریع (بدون شلوغی)

### نوتیفیکیشن‌ها

-   گرفتن badge
-   رسیدن به level جدید
-   حفظ/شکستن streak

---

## 6) اصول روانشناختی و ایمنی

برای جلوگیری از اثر منفی گیمفیکیشن:

1. **پاداش برای پیشرفت، نه فقط نمره**
2. **لیدربورد اختیاری و محدود به کلاس**
3. **نشان‌های رفتاری با تایید معلم/مشاور**
4. **ضد فارم XP** (کاهش XP در تکرارهای بی‌کیفیت)

---

## 7) نقشه اجرای مرحله‌ای

### فاز A (سریع و کم‌ریسک)

-   XP + Level
-   Streak + Last Activity
-   XP Log
-   UI داشبورد ساده

### فاز B

-   Badge System
-   قوانین `rules_json`
-   نمایش نشان‌ها در پروفایل و داشبورد

### فاز C

-   Quest/Challenge
-   Leaderboard داخل کلاس

### فاز D (اختیاری)

-   Currency + Shop
-   آواتار/تم/Hint

---

## 8) اتصال به معماری فعلی Smart-Edu

-   گیمفیکیشن به‌صورت «لایه خدماتی» کنار سیستم Exams/Attempts قرار می‌گیرد.
-   هیچ تغییری در هسته آزمون‌ها لازم نیست؛ فقط در نقاط پایان فعالیت (submit/complete) XP award می‌شود.

---

## 9) قدم بعدی

برای شروع پیاده‌سازی:

1. فاز شروع را انتخاب کنید (پیشنهاد: **فاز A**).
2. جدول دقیق XP برای فعالیت‌ها مشخص شود (کمک می‌کنم طراحی کنیم).
3. Migrationها و Service ساخته شوند.

---

**پایان سند**
