==================== FILE: routes/teacher.php ====================
<?php

use Illuminate\Support\Facades\Route;

use App\Http\Controllers\Teacher\DashboardController;
use App\Http\Controllers\Teacher\TeacherClassController;
use App\Http\Controllers\Teacher\TeacherExamController;
use App\Http\Controllers\Teacher\TeacherStudentController;
use App\Http\Controllers\Teacher\SubjectController;
use App\Http\Controllers\Teacher\QuestionController;

Route::prefix('dashboard')
    ->middleware(['auth', 'role.selected'])
    ->group(function () {

        Route::prefix('teacher')
            ->name('teacher.')
            ->middleware('role:teacher')
            ->group(function () {

                Route::get('/', [DashboardController::class, 'index'])->name('index');

                Route::get('/classes', [TeacherClassController::class, 'index'])
                    ->name('classes.index');

                Route::resource('classes', TeacherClassController::class)
                    ->parameters(['classes' => 'class'])
                    ->except(['index']);

                Route::get('classes/{class}/students', [TeacherClassController::class, 'students'])
                    ->name('classes.students');

                Route::post('classes/{class}/students', [TeacherClassController::class, 'addStudent'])
                    ->name('classes.students.add');

                Route::delete('classes/{class}/students/{student}', [TeacherClassController::class, 'removeStudent'])
                    ->name('classes.students.remove');

                // ==========================================================
                // โ Classes AJAX Data (DB ุฌุฏุฏ)
                // ==========================================================
                Route::prefix('classes/data')
                    ->name('classes.data.')
                    ->group(function () {
                        Route::get('/sections', [TeacherClassController::class, 'sections'])->name('sections');
                        Route::get('/grades/{section}', [TeacherClassController::class, 'grades'])->name('grades');

                        // โ branches ุงูุงู ุจุง section ูุงุฏ ูู grade
                        Route::get('/branches/{section}', [TeacherClassController::class, 'branches'])->name('branches');

                        Route::get('/fields/{branch}', [TeacherClassController::class, 'fields'])->name('fields');
                        Route::get('/subfields/{field}', [TeacherClassController::class, 'subfields'])->name('subfields');

                        // โ subject-types ุนููู (ุจุฏูู ูพุงุฑุงูุชุฑ)
                        Route::get('/subject-types', [TeacherClassController::class, 'subjectTypes'])->name('subject-types');

                        // โ subjects ุจุง querystring
                        Route::get('/subjects', [TeacherClassController::class, 'subjects'])->name('subjects');
                    });

                // ==========================================================
                // Exams (ูููู ูุจู)
                // ==========================================================
                Route::resource('exams', TeacherExamController::class);

                Route::prefix('exams/data')
                    ->name('exams.data.')
                    ->group(function () {

                        Route::get('/sections', [TeacherExamController::class, 'sections'])
                            ->name('sections');

                        Route::get('/grades', [TeacherExamController::class, 'grades'])
                            ->name('grades');

                        Route::get('/branches', [TeacherExamController::class, 'branches'])
                            ->name('branches');

                        Route::get('/fields', [TeacherExamController::class, 'fields'])
                            ->name('fields');

                        Route::get('/subfields', [TeacherExamController::class, 'subfields'])
                            ->name('subfields');

                        Route::get('/subject-types', [TeacherExamController::class, 'subjectTypes'])
                            ->name('subject-types');

                        Route::get('/subjects', [TeacherExamController::class, 'subjects'])
                            ->name('subjects');
                    });

                // Questions (ูุจู)
                Route::get('/exams/{exam}/questions', [QuestionController::class, 'index'])
                    ->name('exams.questions.index');
                Route::get('/exams/{exam}/questions/create', [QuestionController::class, 'create'])
                    ->name('exams.questions.create');
                Route::post('/exams/{exam}/questions', [QuestionController::class, 'store'])
                    ->name('exams.questions.store');
                Route::get('/exams/{exam}/questions/{question}/edit', [QuestionController::class, 'edit'])
                    ->name('exams.questions.edit');
                Route::put('/exams/{exam}/questions/{question}', [QuestionController::class, 'update'])
                    ->name('exams.questions.update');
                Route::delete('/exams/{exam}/questions/{question}', [QuestionController::class, 'destroy'])
                    ->name('exams.questions.destroy');

                // Students (ูุจู)
                Route::get('/students', [TeacherStudentController::class, 'index'])
                    ->name('students.index');
                Route::get('/students/{student}', [TeacherStudentController::class, 'show'])
                    ->name('students.show');
                Route::get('/students/{student}/attempts', [TeacherStudentController::class, 'attempts'])
                    ->name('students.attempts');

                Route::get('/attempts/{attempt}', [TeacherStudentController::class, 'attemptShow'])
                    ->name('attempts.show');
                Route::post('/attempts/{attempt}/answers/{answer}/grade', [TeacherStudentController::class, 'gradeEssayAnswer'])
                    ->name('attempts.answers.grade');

                // Subjects (ูุจู)
                Route::get('/subjects', [SubjectController::class, 'index'])
                    ->name('subjects.index');
                Route::post('/subjects', [SubjectController::class, 'store'])
                    ->name('subjects.store');

                Route::view('/reports', 'dashboard.teacher.reports.index')->name('reports.index');
                Route::view('/profile', 'dashboard.teacher.profile')->name('profile');
            });
    });


==================== FILE: app/Http/Controllers/Teacher/QuestionController.php ====================
==================== FILE: app/Http/Controllers/Teacher/QuestionController.php ====================
<?php

namespace App\Http\Controllers\Teacher;

use Illuminate\Support\Facades\Auth;
use App\Http\Controllers\Controller;
use App\Models\Exam;
use App\Models\Question;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;

class QuestionController extends Controller
{
    // ูุณุช ุณูุงูุงุช ฺฉ ุขุฒููู
    public function index(Exam $exam)
    {
        $this->authorizeTeacherExam($exam);

        $exam->load('classroom');

        $questions = Question::where('exam_id', $exam->id)
            ->latest()
            ->get();

        return view('dashboard.teacher.exams.questions.index', compact('exam', 'questions'));
    }

    // ูุฑู ุงุฌุงุฏ ุณูุงู ุฌุฏุฏ (Wizard)
    public function create(Exam $exam)
    {
        $this->authorizeTeacherExam($exam);

        $examMode = $this->detectExamMode($exam);

        $subjects = null;
        if ($examMode === 'multi_subject') {
            $subjects = $exam->subjects()->get(['id', 'title_fa']);
        }

        return view('dashboard.teacher.exams.questions.wizard.create', [
            'exam'     => $exam,
            'subjects' => $subjects,
            'examMode' => $examMode,
        ]);
    }

    public function store(Request $request, Exam $exam)
    {
        $this->authorizeTeacherExam($exam);

        $examMode = $this->detectExamMode($exam);

        $subjectRule = ($examMode === 'multi_subject')
            ? [
                'required',
                'integer',
                Rule::in($exam->subjects()->pluck('id')->all()),
            ]
            : ['nullable'];

        $validated = $request->validate([
            'content'        => 'required|string|max:2000',
            'question_type'  => 'required|in:mcq,true_false,fill_blank,essay',
            'score'          => 'nullable|numeric|min:0',
            'explanation'    => 'nullable|string|max:5000',
            'is_active'      => 'nullable|boolean',

            'subject_id'     => $subjectRule,

            // ูุชุงุฏุชุง
            'module_label'   => 'nullable|string|max:255',
            'page_number'    => 'nullable|integer|min:1|max:5000',

            // โ difficulty ุฏุฑ DB ุนุฏุฏ ุงุณุช ู NOT NULL โ ุจุงุฏ ููุดู ุนุฏุฏ ุฏุงุดุชู ุจุงุดุฏ
            'difficulty'     => 'nullable|integer|min:1|max:5',

            'hint'           => 'nullable|string',
            'solution'       => 'nullable|string',
            'resource_links' => 'nullable|array',
            'resource_links.*.title' => 'nullable|string|max:255',
            'resource_links.*.url'   => 'nullable|url',

            // ุชุณุช
            'options.a'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.b'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.c'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.d'                     => 'required_if:question_type,mcq|string|max:1000',
            'correct_answer.correct_option' => 'required_if:question_type,mcq|in:a,b,c,d',

            // ุฏุฑุณุช / ูุงุฏุฑุณุช
            'correct_answer.value' => 'required_if:question_type,true_false|in:0,1',

            // ุฌุง ุฎุงู
            'correct_answer.values'   => 'required_if:question_type,fill_blank|array|min:1',
            'correct_answer.values.*' => 'required_if:question_type,fill_blank|string|max:1000',
        ]);

        // -------------------------------
        // ุชุนู subject_id ููุง
        // -------------------------------
        if ($examMode === 'single_subject') {

            // ุงูููุช: primary_subject_id (ุงฺฏุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ)
            $subjectId = $exam->primary_subject_id ?? null;

            // fallback: ุงฺฏุฑ ุฏุฑ pivot ุฏููุงู ฑ ุฏุฑุณ ุจุงุดุฏ
            if (empty($subjectId)) {
                $subjectIds = $exam->subjects()->pluck('id')->all();
                if (count($subjectIds) === 1) {
                    $subjectId = $subjectIds[0];
                }
            }

            if (empty($subjectId)) {
                return back()
                    ->withErrors([
                        'subject_id' => 'ุจุฑุง ุงู ุขุฒููู ูฺ ุฏุฑุณ ุงุตู ุชูุธู ูุดุฏู ุงุณุช. ูุทูุงู ุงุจุชุฏุง ุขุฒููู ุฑุง ูุฑุงุด ฺฉุฑุฏู ู ุฏุฑุณ ุขู ุฑุง ูุดุฎุต ฺฉู.',
                    ])
                    ->withInput();
            }

        } else {
            $subjectId = $validated['subject_id'] ?? null;

            if (empty($subjectId)) {
                return back()
                    ->withErrors(['subject_id' => 'ุจุฑุง ุขุฒููู ฺูุฏุฏุฑุณ ุงูุชุฎุงุจ ุฏุฑุณ ุงูุฒุงู ุงุณุช.'])
                    ->withInput();
            }
        }

        // -------------------------------
        // ุขูุงุฏูโุณุงุฒ options / correct_answer
        // -------------------------------
        $type = $validated['question_type'];
        $options = null;
        $correctAnswer = null;

        if ($type === 'mcq') {
            $options = [
                'a' => $validated['options']['a'],
                'b' => $validated['options']['b'],
                'c' => $validated['options']['c'],
                'd' => $validated['options']['d'],
            ];
            $correctAnswer = [
                'correct_option' => $validated['correct_answer']['correct_option'],
            ];
        } elseif ($type === 'true_false') {
            $correctAnswer = [
                'value' => (bool) ($validated['correct_answer']['value']),
            ];
        } elseif ($type === 'fill_blank') {
            $correctAnswer = [
                'values' => array_values(array_filter($validated['correct_answer']['values'])),
            ];
        }

        // -------------------------------
        // ุฐุฎุฑู ุฑฺฉูุฑุฏ ุณุคุงู (taxonomy ุงุฒ exam)
        // -------------------------------
        Question::create([
            'exam_id'    => $exam->id,
            'subject_id' => $subjectId,

            'section_id'  => $exam->section_id,
            'grade_id'    => $exam->grade_id,
            'branch_id'   => $exam->branch_id,
            'field_id'    => $exam->field_id,
            'subfield_id' => $exam->subfield_id,

            'content'       => $validated['content'],
            'question_type' => $type,
            'score'         => $validated['score'] ?? 1,
            'explanation'   => $validated['explanation'] ?? null,
            'is_active'     => $request->boolean('is_active', true),

            'options'        => $options,
            'correct_answer' => $correctAnswer,

            // โ ููุดู ููุฏุงุฑ ุจุฏู ุชุง NOT NULL ูุฎูุฑุฏ
            'difficulty'     => $validated['difficulty'] ?? 2,

            // ุงูโูุง ุงฺฏุฑ ุฏุฑ ุฌุฏูู/fillable ูุจุงุดูุฏ ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ
            'module_label'   => $validated['module_label'] ?? null,
            'page_number'    => $validated['page_number'] ?? null,
            'hint'           => $validated['hint'] ?? null,
            'solution'       => $validated['solution'] ?? null,
            'resource_links' => $validated['resource_links'] ?? null,
        ]);

        return redirect()
            ->route('teacher.exams.questions.index', $exam)
            ->with('success', 'ุณุคุงู ุฌุฏุฏ ุงุถุงูู ุดุฏ.');
    }

    public function edit(Exam $exam, Question $question)
    {
        $this->authorizeTeacherExam($exam);

        if ($question->exam_id !== $exam->id) {
            abort(404);
        }

        $examMode = $this->detectExamMode($exam);
        $subjects = null;

        if ($examMode === 'multi_subject') {
            $subjects = $exam->subjects()->get(['id', 'title_fa']);
        }

        return view('dashboard.teacher.exams.questions.wizard.edit', [
            'exam'     => $exam,
            'question' => $question,
            'subjects' => $subjects,
            'examMode' => $examMode,
        ]);
    }

    public function update(Request $request, Exam $exam, Question $question)
    {
        $this->authorizeTeacherExam($exam);

        if ($question->exam_id !== $exam->id) {
            abort(404);
        }

        $examMode = $this->detectExamMode($exam);

        $subjectRule = ($examMode === 'multi_subject')
            ? [
                'required',
                'integer',
                Rule::in($exam->subjects()->pluck('id')->all()),
            ]
            : ['nullable'];

        $validated = $request->validate([
            'content'        => 'required|string|max:2000',
            'question_type'  => 'required|in:mcq,true_false,fill_blank,essay',
            'score'          => 'nullable|numeric|min:0',
            'explanation'    => 'nullable|string|max:5000',
            'is_active'      => 'nullable|boolean',

            'subject_id'     => $subjectRule,

            'module_label'   => 'nullable|string|max:255',
            'page_number'    => 'nullable|integer|min:1|max:5000',

            // โ ูุดฺฉู ูุจู: ุงุฑุฌุงุน ุจู $validated ุฏุงุฎู validate
            'difficulty'     => 'nullable|integer|min:1|max:5',

            'hint'           => 'nullable|string',
            'solution'       => 'nullable|string',
            'resource_links' => 'nullable|array',
            'resource_links.*.title' => 'nullable|string|max:255',
            'resource_links.*.url'   => 'nullable|url',

            'options.a'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.b'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.c'                     => 'required_if:question_type,mcq|string|max:1000',
            'options.d'                     => 'required_if:question_type,mcq|string|max:1000',
            'correct_answer.correct_option' => 'required_if:question_type,mcq|in:a,b,c,d',

            'correct_answer.value' => 'required_if:question_type,true_false|in:0,1',

            'correct_answer.values'   => 'required_if:question_type,fill_blank|array|min:1',
            'correct_answer.values.*' => 'required_if:question_type,fill_blank|string|max:1000',
        ]);

        // subject ุฏุฑ update
        if ($examMode === 'single_subject') {

            $subjectId = $exam->primary_subject_id ?? null;

            if (empty($subjectId)) {
                $subjectIds = $exam->subjects()->pluck('id')->all();
                if (count($subjectIds) === 1) {
                    $subjectId = $subjectIds[0];
                }
            }

            if (empty($subjectId)) {
                return back()
                    ->withErrors(['subject_id' => 'ุจุฑุง ุงู ุขุฒููู ูฺ ุฏุฑุณ ุงุตู ุชูุธู ูุดุฏู ุงุณุช.'])
                    ->withInput();
            }

        } else {
            $subjectId = $validated['subject_id'] ?? null;
            if (empty($subjectId)) {
                return back()
                    ->withErrors(['subject_id' => 'ุจุฑุง ุขุฒููู ฺูุฏุฏุฑุณ ุงูุชุฎุงุจ ุฏุฑุณ ูุงุฒู ุงุณุช.'])
                    ->withInput();
            }
        }

        $type = $validated['question_type'];
        $options = null;
        $correctAnswer = null;

        if ($type === 'mcq') {
            $options = [
                'a' => $validated['options']['a'],
                'b' => $validated['options']['b'],
                'c' => $validated['options']['c'],
                'd' => $validated['options']['d'],
            ];
            $correctAnswer = [
                'correct_option' => $validated['correct_answer']['correct_option'],
            ];
        } elseif ($type === 'true_false') {
            $correctAnswer = [
                'value' => (bool) ($validated['correct_answer']['value']),
            ];
        } elseif ($type === 'fill_blank') {
            $correctAnswer = [
                'values' => array_values(array_filter($validated['correct_answer']['values'])),
            ];
        }

        $question->update([
            'subject_id' => $subjectId,

            'section_id'  => $exam->section_id,
            'grade_id'    => $exam->grade_id,
            'branch_id'   => $exam->branch_id,
            'field_id'    => $exam->field_id,
            'subfield_id' => $exam->subfield_id,

            'content'       => $validated['content'],
            'question_type' => $type,
            'score'         => $validated['score'] ?? 1,
            'explanation'   => $validated['explanation'] ?? null,
            'is_active'     => $request->boolean('is_active', true),

            'options'        => $options,
            'correct_answer' => $correctAnswer,

            // โ ููุดู ููุฏุงุฑ ุจุฏู ุชุง NOT NULL ูุฎูุฑุฏ
            'difficulty'     => $validated['difficulty'] ?? 2,

            'module_label'   => $validated['module_label'] ?? null,
            'page_number'    => $validated['page_number'] ?? null,
            'hint'           => $validated['hint'] ?? null,
            'solution'       => $validated['solution'] ?? null,
            'resource_links' => $validated['resource_links'] ?? null,
        ]);

        return redirect()
            ->route('teacher.exams.questions.index', $exam)
            ->with('success', 'ุณุคุงู ุจุง ููููุช ูุฑุงุด ุดุฏ.');
    }

    public function destroy(Exam $exam, Question $question)
    {
        $this->authorizeTeacherExam($exam);

        if ($question->exam_id !== $exam->id) {
            abort(404);
        }

        $question->delete();

        return redirect()
            ->route('teacher.exams.questions.index', $exam)
            ->with('success', 'ุณุคุงู ุญุฐู ุดุฏ.');
    }

    /**
     * ุชุดุฎุต ููุฏ ุขุฒููู
     */
    private function detectExamMode(Exam $exam): string
    {
        // โ ุงฺฏุฑ ุณุชูู exam_mode ุฏุงุฑุ ุญููุช ุงุตู ููู ุงุณุช
        if (!empty($exam->exam_mode)) {
            return $exam->exam_mode;
        }

        // fallback ูุฏู
        if ($exam->exam_type === 'class_comprehensive') {
            return 'multi_subject';
        }

        return 'single_subject';
    }

    /**
     * ููุท ูุนูู ุตุงุญุจ ุขุฒููู (ุขุฒุงุฏ) ุง ูุนูู ฺฉูุงุณ ุขุฒูููุ ุญู ูุฏุฑุช ุณูุงูโูุง ุฑุง ุฏุงุฑุฏ.
     */
    private function authorizeTeacherExam(Exam $exam): void
    {
        $teacherId = Auth::id();

        $exam->loadMissing('classroom');

        if (is_null($exam->classroom_id)) {
            abort_unless(
                $exam->teacher_id === $teacherId,
                403,
                'ุดูุง ุงุฌุงุฒู ูุฏุฑุช ุณูุงูุงุช ุงู ุขุฒููู ุฑุง ูุฏุงุฑุฏ.'
            );
        } else {
            abort_unless(
                $exam->classroom && $exam->classroom->teacher_id === $teacherId,
                403,
                'ุดูุง ุงุฌุงุฒู ูุฏุฑุช ุณูุงูุงุช ุงู ุขุฒููู ุฑุง ูุฏุงุฑุฏ.'
            );
        }
    }
}


==================== FILE: resources/views/dashboard/teacher/exams/questions/index.blade.php ====================
@extends('layouts.app')
@section('title', 'ุณูุงูโูุง ุขุฒููู')

@push('styles')
<style>
    .q-card {
        border-radius: 1.25rem;
        background: #fff;
        box-shadow: 0 8px 24px rgba(18,38,63,.06);
        border: 0;
    }
    .q-header-pill {
        border-radius: 999px;
        padding: .35rem .8rem;
        font-weight: 700;
        font-size: .85rem;
        background: #f1f5f9;
        color: #334155;
        display: inline-flex;
        align-items: center;
        gap: .4rem;
    }
    .q-header-pill .dot {
        width: 9px; height: 9px; border-radius: 50%;
        background: #0d6efd;
        box-shadow: 0 0 0 4px rgba(13,110,253,.15);
    }
    .badge-type {
        border-radius: 999px;
        font-size: .75rem;
        font-weight: 800;
    }
    .badge-type-mcq    { background:#eff6ff; color:#1d4ed8; }
    .badge-type-tf     { background:#ecfdf3; color:#16a34a; }
    .badge-type-fill   { background:#fefce8; color:#ca8a04; }
    .badge-type-essay  { background:#f5f3ff; color:#6d28d9; }
    .btn-q {
        border-radius: .9rem;
        padding: .45rem .9rem;
        font-size: .85rem;
        display:inline-flex;
        align-items:center;
        gap:.35rem;
    }
</style>
@endpush

@section('content')
<div class="container-fluid">

    {{-- Header --}}
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
        <div>
            <div class="q-header-pill mb-2">
                <span class="dot"></span>
                ูุฏุฑุช ุณูุงูโูุง
            </div>
            <h4 class="fw-bold mb-1">
                ุณูุงูโูุง ุขุฒููู: {{ $exam->title ?? 'ุจุฏูู ุนููุงู' }}
            </h4>
            <div class="text-muted small">
                ุณุงุฎุชุงุฑ ุณูุงูโูุง ุจุฑ ุงุณุงุณ JSON (options &amp; correct_answer) ุงุณุช.
            </div>
        </div>

        <div class="d-flex gap-2">
            <a href="{{ route('teacher.exams.edit', $exam) }}"
               class="btn btn-outline-secondary btn-q shadow-sm">
                <i class="bi bi-arrow-right"></i>
                ูุฑุงุด ุขุฒููู
            </a>
            <a href="{{ route('teacher.exams.questions.create', $exam) }}"
               class="btn btn-primary btn-q shadow-sm">
                <i class="bi bi-plus-circle"></i>
                ุณูุงู ุฌุฏุฏ
            </a>
        </div>
    </div>

    {{-- Alert --}}
    @if(session('success'))
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill me-1"></i>
            {{ session('success') }}
        </div>
    @endif

    <div class="q-card p-3 p-md-4">
        @if($questions->isEmpty())
            <div class="text-center py-4">
                <div class="fs-1 text-muted mb-2">
                    <i class="bi bi-question-circle"></i>
                </div>
                <h5 class="fw-bold mb-2">ูููุฒ ุณูุงู ุซุจุช ูุดุฏู ุงุณุช</h5>
                <p class="text-muted small mb-3">
                    ุงููู ุณูุงู ุฑุง ุงุถุงูู ฺฉู ุชุง ุขุฒููู ุขูุงุฏูโ ุงุณุชูุงุฏู ุดูุฏ.
                </p>
                <a href="{{ route('teacher.exams.questions.create', $exam) }}"
                   class="btn btn-primary btn-q">
                    <i class="bi bi-plus-circle"></i>
                    ุงูุฒูุฏู ุงููู ุณูุงู
                </a>
            </div>
        @else
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>ูุชู ุณูุงู</th>
                            <th>ููุน</th>
                            <th>ูพุงุณุฎ / ฺฏุฒููโูุง</th>
                            <th>ูุถุนุช</th>
                            <th class="text-end">ุนููุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($questions as $q)
                            @php
                                $opts = $q->options ?? [];
                                $ca   = $q->correct_answer ?? [];
                            @endphp
                            <tr>
                                <td>{{ $loop->iteration }}</td>

                                {{-- ูุชู ุณูุงู --}}
                                <td style="max-width: 320px;">
                                    <div class="fw-semibold">
                                        {{ \Illuminate\Support\Str::limit($q->content, 90) }}
                                    </div>
                                </td>

                                {{-- ููุน ุณูุงู --}}
                                <td>
                                    @switch($q->question_type)
                                        @case('mcq')
                                            <span class="badge badge-type badge-type-mcq">ุชุณุช</span>
                                            @break
                                        @case('true_false')
                                            <span class="badge badge-type badge-type-tf">ุฏุฑุณุช / ูุงุฏุฑุณุช</span>
                                            @break
                                        @case('fill_blank')
                                            <span class="badge badge-type badge-type-fill">ุฌุง ุฎุงู</span>
                                            @break
                                        @case('essay')
                                            <span class="badge badge-type badge-type-essay">ุชุดุฑุญ</span>
                                            @break
                                        @default
                                            <span class="badge bg-secondary">ูุงูุดุฎุต</span>
                                    @endswitch
                                </td>

                                {{-- ูพุงุณุฎ / ฺฏุฒููโูุง --}}
                                <td>
                                    @if($q->question_type === 'mcq')
                                        @php $correctKey = $ca['correct_option'] ?? null; @endphp
                                        @foreach($opts as $key => $val)
                                            <div class="small">
                                                <strong>{{ strtoupper($key) }}.</strong>
                                                {{ $val }}
                                                @if($correctKey === $key)
                                                    <span class="badge bg-success-subtle text-success ms-1">
                                                        ุตุญุญ
                                                    </span>
                                                @endif
                                            </div>
                                        @endforeach

                                    @elseif($q->question_type === 'true_false')
                                        @php $val = $ca['value'] ?? null; @endphp
                                        <span class="badge bg-info-subtle text-info">
                                            ุฌูุงุจ ุตุญุญ: {{ $val ? 'ุฏุฑุณุช' : 'ูุงุฏุฑุณุช' }}
                                        </span>

                                    @elseif($q->question_type === 'fill_blank')
                                        @php $vals = $ca['values'] ?? []; @endphp
                                        <div class="small">
                                            ุฌูุงุจโูุง:
                                            <span class="fw-semibold">
                                                {{ implode(' ุ ', $vals) }}
                                            </span>
                                        </div>

                                    @else
                                        <span class="text-muted small">ุณูุงู ุชุดุฑุญ (ุจุฏูู ฺฏุฒูู)</span>
                                    @endif
                                </td>

                                {{-- ูุถุนุช --}}
                                <td>
                                    @if($q->is_active)
                                        <span class="badge bg-success-subtle text-success">
                                            <i class="bi bi-check-circle me-1"></i> ูุนุงู
                                        </span>
                                    @else
                                        <span class="badge bg-secondary-subtle text-secondary">
                                            <i class="bi bi-slash-circle me-1"></i> ุบุฑูุนุงู
                                        </span>
                                    @endif
                                </td>

                                {{-- ุนููุงุช --}}
                                <td class="text-end">
                                    <div class="d-inline-flex gap-1">
                                        <a href="{{ route('teacher.exams.questions.edit', [$exam, $q]) }}"
                                           class="btn btn-outline-primary btn-q btn-sm">
                                            <i class="bi bi-pencil-square"></i>
                                            ูุฑุงุด
                                        </a>
                                        <form action="{{ route('teacher.exams.questions.destroy', [$exam, $q]) }}"
                                              method="POST"
                                              onsubmit="return confirm('ุณูุงู ุญุฐู ุดูุฏุ');">
                                            @csrf
                                            @method('DELETE')
                                            <button class="btn btn-outline-danger btn-q btn-sm">
                                                <i class="bi bi-trash"></i>
                                                ุญุฐู
                                            </button>
                                        </form>
                                    </div>
                                </td>

                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        @endif
    </div>

</div>
@endsection


==================== FILE: resources/views/dashboard/teacher/exams/questions/wizard/create.blade.php ====================
@extends('layouts.app')
@section('title', 'ุณูุงู ุฌุฏุฏ (ูุฒุงุฑุฏ)')

@push('styles')
    <link rel="stylesheet" href="{{ asset('assets/css/question-wizard.css') }}">
@endpush

@section('content')
@php
    $examMode = $exam->exam_mode ?? 'single_subject';
    $isMulti  = $examMode === 'multi_subject';

    $examSubjects = $exam->subjects ?? collect();
    $primarySubject = $examSubjects->first();

    // ุจุฑุง ููุงุด ูุงู ุฏุฑุณ ุฏุฑ ุญุงูุช ุชฺฉโุฏุฑุณ
    $singleSubjectLabel = $primarySubject->title_fa
        ?? $exam->subject
        ?? 'ุจุฏูู ูุงู';
@endphp

<div class="qw-container container-fluid">

    {{-- HEADER --}}
    <div class="qw-page-header">
        <div class="qw-header-content">
            <div class="qw-header-title">
                <h1>
                    <span class="qw-gradient-text">
                        ุงูุฒูุฏู ุณูุงู ุฌุฏุฏ
                    </span>
                    ๐
                </h1>
                <p class="qw-header-subtitle">
                    ุณูุงู ุฌุฏุฏ ุจุฑุง ุขุฒููู
                    <strong>ยซ{{ $exam->title ?? 'ุจุฏูู ุนููุงู' }}ยป</strong>
                    ุซุจุช ูโุดูุฏ.
                </p>
                <div class="qw-exam-meta">
                    <span class="badge bg-primary-subtle text-primary qw-badge-pill">
                        ุญุงูุช ุขุฒููู:
                        {{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}
                    </span>

                    @if($examMode === 'single_subject')
                        <span class="badge bg-info-subtle text-info qw-badge-pill">
                            ุฏุฑุณ ุขุฒููู:
                            {{ $singleSubjectLabel }}
                        </span>
                    @else
                        <span class="badge bg-secondary-subtle text-secondary qw-badge-pill">
                            ุชุนุฏุงุฏ ุฏุฑุณโูุง ุขุฒููู:
                            {{ $examSubjects->count() }}
                        </span>
                    @endif
                </div>
            </div>

            <a href="{{ route('teacher.exams.questions.index', $exam) }}"
               class="qw-btn-back">
                <i class="bi bi-arrow-right"></i>
                ุจุงุฒฺฏุดุช ุจู ุณูุงูโูุง
            </a>
        </div>
    </div>

    {{-- WIZARD WRAPPER --}}
    <div class="row g-3">

        {{-- LEFT: FORM (Wizard) --}}
        <div class="col-lg-8">
            <div class="qw-card">

                {{-- STEPS PROGRESS --}}
                <div class="qw-steps-wrapper">
                    <div class="qw-progress-bar">
                        <div class="qw-progress-fill" id="qwProgressFill"></div>
                    </div>
                    <div class="qw-steps">
                        <div class="qw-step active" data-step="1">
                            <div class="qw-step-number">ฑ</div>
                            <div class="qw-step-label">ุงุทูุงุนุงุช ฺฉู</div>
                        </div>
                        <div class="qw-step" data-step="2">
                            <div class="qw-step-number">ฒ</div>
                            <div class="qw-step-label">ูุชู ู ููุน ุณูุงู</div>
                        </div>
                        <div class="qw-step" data-step="3">
                            <div class="qw-step-number">ณ</div>
                            <div class="qw-step-label">ูพุงุณุฎโูุง ู ฺฉูุฏ</div>
                        </div>
                        <div class="qw-step" data-step="4">
                            <div class="qw-step-number">ด</div>
                            <div class="qw-step-label">ูุชุงุฏุชุง ู ููุงุจุน</div>
                        </div>
                    </div>
                </div>

                {{-- ERRORS --}}
                @if($errors->any())
                    <div class="alert alert-danger qw-alert">
                        <div class="fw-semibold mb-1">
                            <i class="bi bi-exclamation-triangle-fill me-1"></i>
                            ูุทูุงู ููุงุฑุฏ ุฒุฑ ุฑุง ุงุตูุงุญ ฺฉู:
                        </div>
                        <ul class="mb-0">
                            @foreach($errors->all() as $e)
                                <li>{{ $e }}</li>
                            @endforeach
                        </ul>
                    </div>
                @endif

                <form
                    id="questionWizardForm"
                    action="{{ route('teacher.exams.questions.store', $exam) }}"
                    method="POST"
                    novalidate
                >
                    @csrf

                    {{-- STEP 1: Info / Subject / Status --}}
                    <div class="qw-step-content active" data-step="1">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">๐</div>
                            <h2 class="qw-section-title">ุงุทูุงุนุงุช ฺฉู ุณูุงู</h2>
                            <p class="qw-section-desc">
                                ุญุงูุช ุขุฒูููุ ุฏุฑุณ (ุฏุฑ ุตูุฑุช ฺูุฏุฏุฑุณ) ู ูุถุนุช ูุนุงู ุจูุฏู ุณูุงู ุฑุง ูุดุฎุต ฺฉู.
                            </p>
                        </div>

                        <div class="row g-3">

                            {{-- Exam mode (read-only) --}}
                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ุญุงูุช ุขุฒููู
                                </label>
                                <input
                                    type="text"
                                    class="form-control qw-input"
                                    value="{{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}"
                                    disabled
                                >
                                <div class="form-text qw-hint">
                                    ุฏุฑ ุตูุฑุช ฺูุฏุฏุฑุณุ ุจุงุฏ ุจุฑุง ูุฑ ุณูุงู ุฏุฑุณ ุฑุง ูุดุฎุต ฺฉู.
                                </div>
                            </div>

                            {{-- Subject select (only for multi_subject) --}}
                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ุฏุฑุณ ุณูุงู
                                    @if($isMulti)
                                        <span class="text-danger">*</span>
                                    @endif
                                </label>

                                @if($isMulti)
                                    <select
                                        name="subject_id"
                                        id="qwSubjectSelect"
                                        class="form-select qw-input"
                                    >
                                        <option value="">ุงูุชุฎุงุจ ุฏุฑุณ...</option>
                                        @foreach($examSubjects as $subj)
                                            <option
                                                value="{{ $subj->id }}"
                                                data-title="{{ $subj->title_fa }}"
                                                {{ old('subject_id') == $subj->id ? 'selected' : '' }}
                                            >
                                                {{ $subj->title_fa }}
                                                @if($subj->code)
                                                    ({{ $subj->code }})
                                                @endif
                                            </option>
                                        @endforeach
                                    </select>
                                    <div class="form-text qw-hint">
                                        ููุท ุฏุฑุณโูุง ููุงุด ุฏุงุฏู ูโุดููุฏ ฺฉู ุจุฑุง ุงู ุขุฒููู ุชุนุฑู ุดุฏูโุงูุฏ.
                                    </div>
                                @else
                                    <input
                                        type="text"
                                        class="form-control qw-input"
                                        value="{{ $singleSubjectLabel }}"
                                        disabled
                                    >
                                    <div class="form-text qw-hint">
                                        ุฏุฑ ุญุงูุช ุชฺฉโุฏุฑุณุ ุชูุงู ุณูุงูโูุง ุจู ููู ุฏุฑุณ ูุชุตู ูโุดููุฏ.
                                    </div>
                                @endif
                            </div>

                            {{-- Score --}}
                            <div class="col-md-4">
                                <label class="form-label qw-label">
                                    ุงูุชุงุฒ ุณูุงู
                                </label>
                                <input
                                    type="number"
                                    name="score"
                                    id="qwScoreInput"
                                    class="form-control qw-input @error('score') is-invalid @enderror"
                                    value="{{ old('score', 1) }}"
                                    min="0"
                                    step="0.25"
                                >
                                @error('score')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                                <div class="form-text qw-hint">
                                    ูโุชูุงู ุจุนุฏุงู ุงูุชุงุฒ ุฑุง ูุฑุงุด ฺฉู.
                                </div>
                            </div>

                            {{-- Active toggle --}}
                            <div class="col-md-4 d-flex align-items-center">
                                <div class="form-check form-switch qw-switch">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        role="switch"
                                        name="is_active"
                                        id="qwIsActive"
                                        value="1"
                                        {{ old('is_active', 1) ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label fw-semibold" for="qwIsActive">
                                        ุณูุงู ูุนุงู ุจุงุดุฏ
                                    </label>
                                </div>
                            </div>

                            {{-- reserved space for future difficulty/topic --}}
                            <div class="col-md-4">
                                <label class="form-label qw-label">
                                    ุณุทุญ ุฏุดูุงุฑ (ุงุฎุชุงุฑ - ุขูุฏู)
                                </label>
                                <select
                                    name="difficulty"
                                    id="qwDifficulty"
                                    class="form-select qw-input"
                                    disabled
                                >
                                    <option value="">(ุจูโุฒูุฏ)</option>
                                    <option value="easy">ุขุณุงู</option>
                                    <option value="normal">ูุชูุณุท</option>
                                    <option value="hard">ุณุฎุช</option>
                                </select>
                                <div class="form-text qw-hint">
                                    ุจุฑุง ูุณุฎูู ูุนู ูููุฒ ุจู ุจฺฉโุงูุฏ ูุตู ูุดุฏู ุงุณุช.
                                </div>
                            </div>

                        </div>
                    </div>

                    {{-- STEP 2: Question Text & Type --}}
                    <div class="qw-step-content" data-step="2">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">โ๏ธ</div>
                            <h2 class="qw-section-title">ูุชู ุณูุงู ู ููุน ุขู</h2>
                            <p class="qw-section-desc">
                                ูุชู ฺฉุงูู ุณูุงู ุฑุง ุจููุณ ู ููุน ุขู ุฑุง ูุดุฎุต ฺฉู ุชุง ุจุฎุด ููุงุณุจ ูพุงุณุฎโูุง ูุนุงู ุดูุฏ.
                            </p>
                        </div>

                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ูุชู ุณูุงู
                                <span class="text-danger">*</span>
                            </label>
                            <textarea
                                name="content"
                                id="qwContent"
                                rows="5"
                                class="form-control qw-input @error('content') is-invalid @enderror"
                                placeholder="ูุชู ฺฉุงูู ุณูุงู ุฑุง ุจููุณ..."
                            >{{ old('content') }}</textarea>
                            @error('content')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                            <div class="form-text qw-hint">
                                ูโุชูุงู ุงุฒ LaTeX / ูุฑูููโูุง ุฏุฑ ูุณุฎูโูุง ุจุนุฏ ูพุดุชุจุงู ุงุถุงูู ฺฉู.
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ููุน ุณูุงู
                                    <span class="text-danger">*</span>
                                </label>
                                <select
                                    name="question_type"
                                    id="qwQuestionType"
                                    class="form-select qw-input @error('question_type') is-invalid @enderror"
                                >
                                    <option value="">ุงูุชุฎุงุจ ฺฉูุฏ...</option>
                                    <option value="mcq"        {{ old('question_type') === 'mcq' ? 'selected' : '' }}>ุชุณุช (ฺูุงุฑฺฏุฒููโุง)</option>
                                    <option value="true_false" {{ old('question_type') === 'true_false' ? 'selected' : '' }}>ุฏุฑุณุช / ูุงุฏุฑุณุช</option>
                                    <option value="fill_blank" {{ old('question_type') === 'fill_blank' ? 'selected' : '' }}>ุฌุง ุฎุงู</option>
                                    <option value="essay"      {{ old('question_type') === 'essay' ? 'selected' : '' }}>ุชุดุฑุญ</option>
                                </select>
                                @error('question_type')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                                <div class="form-text qw-hint">
                                    ุจุฑุงุณุงุณ ุงู ุงูุชุฎุงุจุ ูุฑุญููู ุจุนุฏ ูุฑู ูพุงุณุฎโูุง ุชุบุฑ ูโฺฉูุฏ.
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- STEP 3: Answers & Correct Answer --}}
                    @php
                        $oldOptions = old('options', []);
                        $oldCorrectOpt = old('correct_answer.correct_option');
                        $oldTF = old('correct_answer.value');
                        $oldFill = old('correct_answer.values', ['']);
                    @endphp

                    <div class="qw-step-content" data-step="3">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">โ</div>
                            <h2 class="qw-section-title">ูพุงุณุฎโูุง ู ฺฉูุฏ ุณูุงู</h2>
                            <p class="qw-section-desc">
                                ุจุฑุงุณุงุณ ููุน ุณูุงูุ ฺฏุฒููโูุงุ ูพุงุณุฎ ุตุญุญ ุง ูุณุช ูพุงุณุฎโูุง ุตุญุญ ุฑุง ุชูุธู ฺฉู.
                            </p>
                        </div>

                        {{-- MCQ --}}
                        <div id="qwMcqBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ฺฏุฒููโูุง ุณูุงู ุชุณุช</div>
                            <div class="qw-hint mb-2">
                                ฺูุงุฑ ฺฏุฒูู ูุงุฑุฏ ฺฉู ู ฺฉ ุฑุง ุจู ุนููุงู ูพุงุณุฎ ุตุญุญ ุงูุชุฎุงุจ ฺฉู.
                            </div>

                            @foreach(['a','b','c','d'] as $opt)
                                <div class="input-group mb-2">
                                    <span class="input-group-text">{{ strtoupper($opt) }}</span>
                                    <input
                                        type="text"
                                        name="options[{{ $opt }}]"
                                        class="form-control qw-input"
                                        value="{{ $oldOptions[$opt] ?? '' }}"
                                        placeholder="ูุชู ฺฏุฒูู {{ strtoupper($opt) }}"
                                    >
                                    <span class="input-group-text bg-white">
                                        <input
                                            class="form-check-input mt-0"
                                            type="radio"
                                            name="correct_answer[correct_option]"
                                            value="{{ $opt }}"
                                            {{ $oldCorrectOpt === $opt ? 'checked' : '' }}
                                        >
                                        <span class="ms-1 small">ุตุญุญ</span>
                                    </span>
                                </div>
                            @endforeach
                        </div>

                        {{-- True / False --}}
                        <div id="qwTfBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุฌูุงุจ ุตุญุญ (ุฏุฑุณุช / ูุงุฏุฑุณุช)</div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="form-check">
                                    <input
                                        class="form-check-input"
                                        type="radio"
                                        name="correct_answer[value]"
                                        id="qwTfTrue"
                                        value="1"
                                        {{ $oldTF === '1' ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label" for="qwTfTrue">ุฏุฑุณุช</label>
                                </div>
                                <div class="form-check">
                                    <input
                                        class="form-check-input"
                                        type="radio"
                                        name="correct_answer[value]"
                                        id="qwTfFalse"
                                        value="0"
                                        {{ $oldTF === '0' ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label" for="qwTfFalse">ูุงุฏุฑุณุช</label>
                                </div>
                            </div>
                        </div>

                        {{-- Fill in the Blank --}}
                        <div id="qwFillBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุฌูุงุจโูุง ุตุญุญ (ุฌุง ุฎุงู)</div>
                            <div class="qw-hint mb-2">
                                ุจุฑุง ูุฑ ุฌูุงุจ ูุงุจู ูุจููุ ฺฉ ุฎุท ุฌุฏุง ุซุจุช ฺฉู.
                            </div>

                            <div id="qwFillContainer">
                                @foreach($oldFill as $idx => $val)
                                    <div class="input-group mb-2">
                                        <span class="input-group-text">ุฌูุงุจ {{ $idx + 1 }}</span>
                                        <input
                                            type="text"
                                            name="correct_answer[values][]"
                                            class="form-control qw-input"
                                            value="{{ $val }}"
                                        >
                                    </div>
                                @endforeach
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-secondary btn-sm mt-1"
                                id="qwAddFillAnswer"
                            >
                                <i class="bi bi-plus-circle"></i>
                                ุงูุฒูุฏู ุฌูุงุจ ุฏฺฏุฑ
                            </button>
                        </div>

                        {{-- Essay has no extra inputs --}}
                        <div id="qwEssayInfo" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุณูุงู ุชุดุฑุญ</div>
                            <div class="qw-hint">
                                ุจุฑุง ุณูุงูโูุง ุชุดุฑุญ ูพุงุณุฎ ุงุฒ ุฏุงูุดโุขููุฒ ุฏุฑุงูุช ูโุดูุฏ ู ฺฉูุฏ ุฑุง ูโุชูุงู ุฏุฑ ุจุฎุด
                                ยซุชูุถุญ / ุฑุงูููุงยป ุฏุฑุฌ ฺฉุฑุฏ.
                            </div>
                        </div>
                    </div>

                    {{-- STEP 4: Explanation + Resources --}}
                    <div class="qw-step-content" data-step="4">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">๐</div>
                            <h2 class="qw-section-title">ุงุทูุงุนุงุช ุขููุฒุด ู ููุงุจุน</h2>
                            <p class="qw-section-desc">
                                ุชูุถุญ ุณูุงู ู ููฺฉโูุง ุขููุฒุด ูุฑุชุจุท ุฑุง ูุงุฑุฏ ฺฉู ุชุง ุชุญูู ุขุฒููู ุบูโุชุฑ ุดูุฏ.
                            </p>
                        </div>

                        {{-- Explanation / hint --}}
                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ุชูุถุญ / ุฑุงูููุง ุณูุงู (ุงุฎุชุงุฑ)
                            </label>
                            <textarea
                                name="explanation"
                                id="qwExplanation"
                                rows="3"
                                class="form-control qw-input"
                                placeholder="ูโุชูุงู ุฑุงูโุญูุ ูฺฉุงุช ฺฉูุฏ ุง ุชูุถุญ ุชุตุญุญ ุฑุง ุงูุฌุง ุจููุณ."
                            >{{ old('explanation') }}</textarea>
                            <div class="form-text qw-hint">
                                ุงู ูุชู ุฏุฑ ุจุฎุด ุชุญูู ูุชุงุฌ ุจุฑุง ููุฑุฌููุง ู ุง ูุนูู ูุงุจู ุงุณุชูุงุฏู ุงุณุช.
                            </div>
                        </div>

                        {{-- Resource links (dynamic) --}}
                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ููฺฉโูุง ุขููุฒุด ูุฑุชุจุท (ุงุฎุชุงุฑุ ูุงูุญุฏูุฏ)
                            </label>
                            <div class="qw-hint mb-2">
                                ูโุชูุงู ูุฏูุ ููุงููุ ุฌุฒูู ู ... ุฑุง ุงุถุงูู ฺฉู.
                            </div>

                            <div id="qwLinksContainer">
                                {{-- ุงฺฏุฑ old ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ูโุชูุงู ุจุนุฏุงู ุขู ุฑุง ูพุฑ ฺฉู. ูุนูุงู ุฎุงู ุดุฑูุน ูโฺฉูู --}}
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-sm"
                                id="qwAddLink"
                            >
                                <i class="bi bi-link-45deg"></i>
                                ุงูุฒูุฏู ููฺฉ ุขููุฒุด
                            </button>

                            <div class="form-text qw-hint mt-1">
                                ููฺฉโูุง ุฏุฑ ูุงูุจ JSON ุจู ุจฺฉโุงูุฏ ุงุฑุณุงู ูโุดููุฏ (ูุฑุญููู ุจุนุฏ ุจฺฉโุงูุฏ).
                            </div>
                        </div>
                    </div>

                    {{-- NAV BUTTONS --}}
                    <div class="qw-nav-buttons">
                        <button
                            type="button"
                            class="btn qw-btn-nav qw-btn-prev"
                            id="qwPrevBtn"
                        >
                            <i class="bi bi-arrow-right"></i>
                            ูุฑุญูู ูุจู
                        </button>

                        <button
                            type="button"
                            class="btn qw-btn-nav qw-btn-next"
                            id="qwNextBtn"
                        >
                            ูุฑุญูู ุจุนุฏ
                            <i class="bi bi-arrow-left"></i>
                        </button>

                        <button
                            type="submit"
                            class="btn qw-btn-nav qw-btn-submit"
                            id="qwSubmitBtn"
                        >
                            <i class="bi bi-check-circle"></i>
                            ุฐุฎุฑู ุณูุงู
                        </button>
                    </div>

                </form>
            </div>
        </div>

        {{-- RIGHT: LIVE PREVIEW (Desktop only) --}}
        <div class="col-lg-4 d-none d-lg-block">
            <div class="qw-preview-card">
                <div class="qw-preview-header">
                    <div>
                        <div class="qw-preview-title">
                            <i class="bi bi-eye me-1"></i>
                            ูพุดโููุงุด ุณูุงู
                        </div>
                        <div class="qw-preview-subtitle">
                            ุจุง ุชุบุฑ ูุฑูุ ุงู ูพุดโููุงุด ุจูโุทูุฑ ุฒูุฏู ุขูพุฏุช ูโุดูุฏ.
                        </div>
                    </div>
                    <span class="badge bg-success-subtle text-success fw-bold">
                        Live
                    </span>
                </div>

                <div class="qw-preview-body" id="qwPreview">
                    <div class="qw-preview-badge-row">
                        <span class="badge bg-primary-subtle text-primary" id="qwPreviewTypeBadge">
                            ููุน ุณูุงู: โ
                        </span>
                        <span class="badge bg-info-subtle text-info" id="qwPreviewScore">
                            ุงูุชุงุฒ: 1
                        </span>
                        <span class="badge bg-secondary-subtle text-secondary" id="qwPreviewStatus">
                            ูุถุนุช: ูุนุงู
                        </span>
                    </div>

                    <div class="qw-preview-question" id="qwPreviewContent">
                        ูููุฒ ูุชู ุจุฑุง ุณูุงู ูุงุฑุฏ ูุดุฏู ุงุณุช.
                    </div>

                    <div class="qw-preview-meta">
                        <div class="qw-preview-meta-item">
                            <span class="qw-preview-meta-label">ุฏุฑุณ:</span>
                            <span class="qw-preview-meta-value" id="qwPreviewSubject">
                                {{ $examMode === 'multi_subject' ? 'ุงูุชุฎุงุจ ูุดุฏู' : $singleSubjectLabel }}
                            </span>
                        </div>
                        <div class="qw-preview-meta-item">
                            <span class="qw-preview-meta-label">ุญุงูุช ุขุฒููู:</span>
                            <span class="qw-preview-meta-value">
                                {{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}
                            </span>
                        </div>
                    </div>

                    <div class="qw-preview-answers">
                        <div class="qw-preview-answers-title">
                            ูพุดโููุงุด ูพุงุณุฎโูุง
                        </div>
                        <div id="qwPreviewAnswersInner">
                            ููุน ุณูุงู ุฑุง ุงูุชุฎุงุจ ฺฉู ุชุง ูพุดโููุงุด ูพุงุณุฎโูุง ููุงุด ุฏุงุฏู ุดูุฏ.
                        </div>
                    </div>

                    <div class="qw-preview-explanation">
                        <div class="qw-preview-explanation-title">
                            ุชูุถุญ / ุฑุงูููุง
                        </div>
                        <div id="qwPreviewExplanation" class="qw-preview-explanation-body">
                            ูููุฒ ุชูุถุญ ุซุจุช ูุดุฏู ุงุณุช.
                        </div>
                    </div>

                    <div class="qw-preview-links">
                        <div class="qw-preview-links-title">
                            ููฺฉโูุง ุขููุฒุด
                        </div>
                        <div id="qwPreviewLinks" class="qw-preview-links-body">
                            ููฺฉ ุซุจุช ูุดุฏู ุงุณุช.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div> {{-- /row --}}
</div> {{-- /container --}}
@endsection

@push('scripts')
    <script src="{{ asset('assets/js/question-wizard.js') }}"></script>
@endpush


==================== FILE: resources/views/dashboard/teacher/exams/questions/wizard/edit.blade.php ====================
@extends('layouts.app')
@section('title', 'ูุฑุงุด ุณูุงู (ูุฒุงุฑุฏ)')

@push('styles')
    <link rel="stylesheet" href="{{ asset('assets/css/question-wizard.css') }}">
@endpush

@section('content')
@php
    $examMode = $exam->exam_mode ?? 'single_subject';
    $isMulti  = $examMode === 'multi_subject';

    $examSubjects = $exam->subjects ?? collect();
    $primarySubject = $examSubjects->first();

    $singleSubjectLabel = $primarySubject->title_fa
        ?? $exam->subject
        ?? 'ุจุฏูู ูุงู';

    $qt       = old('question_type', $question->question_type);
    $opts     = old('options', $question->options ?? []);
    $ca       = old('correct_answer', $question->correct_answer ?? []);
    $tfVal    = $ca['value']  ?? null;
    $fillVals = $ca['values'] ?? [''];

    $initialScore   = old('score', $question->score);
    $initialActive  = old('is_active', $question->is_active);
    $initialContent = old('content', $question->content);
    $initialExplain = old('explanation', $question->explanation);

    $initialSubjectId = old('subject_id', $question->subject_id ?? null);
@endphp

<div class="qw-container container-fluid">

    {{-- HEADER --}}
    <div class="qw-page-header">
        <div class="qw-header-content">
            <div class="qw-header-title">
                <h1>
                    <span class="qw-gradient-text">
                        ูุฑุงุด ุณูุงู
                    </span>
                    โ๏ธ
                </h1>
                <p class="qw-header-subtitle">
                    ุฏุฑ ุญุงู ูุฑุงุด ุณูุงู ูุฑุจูุท ุจู ุขุฒููู
                    <strong>ยซ{{ $exam->title ?? 'ุจุฏูู ุนููุงู' }}ยป</strong>
                    ูุณุช.
                </p>
                <div class="qw-exam-meta">
                    <span class="badge bg-primary-subtle text-primary qw-badge-pill">
                        ุญุงูุช ุขุฒููู:
                        {{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}
                    </span>

                    @if($examMode === 'single_subject')
                        <span class="badge bg-info-subtle text-info qw-badge-pill">
                            ุฏุฑุณ ุขุฒููู:
                            {{ $singleSubjectLabel }}
                        </span>
                    @else
                        <span class="badge bg-secondary-subtle text-secondary qw-badge-pill">
                            ุชุนุฏุงุฏ ุฏุฑุณโูุง ุขุฒููู:
                            {{ $examSubjects->count() }}
                        </span>
                    @endif
                </div>
            </div>

            <a href="{{ route('teacher.exams.questions.index', $exam) }}"
               class="qw-btn-back">
                <i class="bi bi-arrow-right"></i>
                ุจุงุฒฺฏุดุช ุจู ุณูุงูโูุง
            </a>
        </div>
    </div>

    <div class="row g-3">

        {{-- LEFT: FORM --}}
        <div class="col-lg-8">
            <div class="qw-card">

                {{-- STEPS --}}
                <div class="qw-steps-wrapper">
                    <div class="qw-progress-bar">
                        <div class="qw-progress-fill" id="qwProgressFill"></div>
                    </div>
                    <div class="qw-steps">
                        <div class="qw-step active" data-step="1">
                            <div class="qw-step-number">ฑ</div>
                            <div class="qw-step-label">ุงุทูุงุนุงุช ฺฉู</div>
                        </div>
                        <div class="qw-step" data-step="2">
                            <div class="qw-step-number">ฒ</div>
                            <div class="qw-step-label">ูุชู ู ููุน ุณูุงู</div>
                        </div>
                        <div class="qw-step" data-step="3">
                            <div class="qw-step-number">ณ</div>
                            <div class="qw-step-label">ูพุงุณุฎโูุง ู ฺฉูุฏ</div>
                        </div>
                        <div class="qw-step" data-step="4">
                            <div class="qw-step-number">ด</div>
                            <div class="qw-step-label">ูุชุงุฏุชุง ู ููุงุจุน</div>
                        </div>
                    </div>
                </div>

                {{-- ERRORS --}}
                @if($errors->any())
                    <div class="alert alert-danger qw-alert">
                        <div class="fw-semibold mb-1">
                            <i class="bi bi-exclamation-triangle-fill me-1"></i>
                            ูุทูุงู ุฎุทุงูุง ุฒุฑ ุฑุง ุจุฑุฑุณ ฺฉู:
                        </div>
                        <ul class="mb-0">
                            @foreach($errors->all() as $e)
                                <li>{{ $e }}</li>
                            @endforeach
                        </ul>
                    </div>
                @endif

                <form
                    id="questionWizardForm"
                    action="{{ route('teacher.exams.questions.update', [$exam, $question]) }}"
                    method="POST"
                    novalidate
                >
                    @csrf
                    @method('PUT')

                    {{-- STEP 1 --}}
                    <div class="qw-step-content active" data-step="1">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">๐</div>
                            <h2 class="qw-section-title">ุงุทูุงุนุงุช ฺฉู ุณูุงู</h2>
                            <p class="qw-section-desc">
                                ูโุชูุงู ุฏุฑุณ ุณูุงู (ุฏุฑ ุขุฒููู ฺูุฏุฏุฑุณ)ุ ุงูุชุงุฒ ู ูุถุนุช ูุนุงู ุจูุฏู ุฑุง ุชูุธู ฺฉู.
                            </p>
                        </div>

                        <div class="row g-3">

                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ุญุงูุช ุขุฒููู
                                </label>
                                <input
                                    type="text"
                                    class="form-control qw-input"
                                    value="{{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}"
                                    disabled
                                >
                            </div>

                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ุฏุฑุณ ุณูุงู
                                    @if($isMulti)
                                        <span class="text-danger">*</span>
                                    @endif
                                </label>

                                @if($isMulti)
                                    <select
                                        name="subject_id"
                                        id="qwSubjectSelect"
                                        class="form-select qw-input"
                                    >
                                        <option value="">ุงูุชุฎุงุจ ุฏุฑุณ...</option>
                                        @foreach($examSubjects as $subj)
                                            <option
                                                value="{{ $subj->id }}"
                                                data-title="{{ $subj->title_fa }}"
                                                {{ (string)$initialSubjectId === (string)$subj->id ? 'selected' : '' }}
                                            >
                                                {{ $subj->title_fa }}
                                                @if($subj->code)
                                                    ({{ $subj->code }})
                                                @endif
                                            </option>
                                        @endforeach
                                    </select>
                                    <div class="form-text qw-hint">
                                        ุงฺฏุฑ ูุจูุงู ุณูุงู ุจู ุฏุฑุณ ูุตู ุดุฏูุ ุงูุฌุง ุงูุชุฎุงุจโุดุฏู ููุงุด ุฏุงุฏู ูโุดูุฏ.
                                    </div>
                                @else
                                    <input
                                        type="text"
                                        class="form-control qw-input"
                                        value="{{ $singleSubjectLabel }}"
                                        disabled
                                    >
                                @endif
                            </div>

                            <div class="col-md-4">
                                <label class="form-label qw-label">
                                    ุงูุชุงุฒ ุณูุงู
                                </label>
                                <input
                                    type="number"
                                    name="score"
                                    id="qwScoreInput"
                                    class="form-control qw-input @error('score') is-invalid @enderror"
                                    value="{{ $initialScore }}"
                                    min="0"
                                    step="0.25"
                                >
                                @error('score')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="col-md-4 d-flex align-items-center">
                                <div class="form-check form-switch qw-switch">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        role="switch"
                                        name="is_active"
                                        id="qwIsActive"
                                        value="1"
                                        {{ $initialActive ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label fw-semibold" for="qwIsActive">
                                        ุณูุงู ูุนุงู ุจุงุดุฏ
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label qw-label">
                                    ุณุทุญ ุฏุดูุงุฑ (ุขูุฏู)
                                </label>
                                <select
                                    name="difficulty"
                                    id="qwDifficulty"
                                    class="form-select qw-input"
                                    disabled
                                >
                                    <option value="">(ุจูโุฒูุฏ)</option>
                                    <option value="easy">ุขุณุงู</option>
                                    <option value="normal">ูุชูุณุท</option>
                                    <option value="hard">ุณุฎุช</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    {{-- STEP 2 --}}
                    <div class="qw-step-content" data-step="2">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">โ๏ธ</div>
                            <h2 class="qw-section-title">ูุชู ุณูุงู ู ููุน ุขู</h2>
                            <p class="qw-section-desc">
                                ุฏุฑ ุตูุฑุช ุชุบุฑ ููุน ุณูุงูุ ูุฑู ูพุงุณุฎโูุง ุฏุฑ ูุฑุญููู ุจุนุฏ ุจูโุฑูุฒุฑุณุงู ูโุดูุฏ.
                            </p>
                        </div>

                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ูุชู ุณูุงู
                                <span class="text-danger">*</span>
                            </label>
                            <textarea
                                name="content"
                                id="qwContent"
                                rows="5"
                                class="form-control qw-input @error('content') is-invalid @enderror"
                            >{{ $initialContent }}</textarea>
                            @error('content')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label qw-label">
                                    ููุน ุณูุงู
                                    <span class="text-danger">*</span>
                                </label>
                                <select
                                    name="question_type"
                                    id="qwQuestionType"
                                    class="form-select qw-input @error('question_type') is-invalid @enderror"
                                >
                                    <option value="mcq"        {{ $qt === 'mcq' ? 'selected' : '' }}>ุชุณุช (ฺูุงุฑฺฏุฒููโุง)</option>
                                    <option value="true_false" {{ $qt === 'true_false' ? 'selected' : '' }}>ุฏุฑุณุช / ูุงุฏุฑุณุช</option>
                                    <option value="fill_blank" {{ $qt === 'fill_blank' ? 'selected' : '' }}>ุฌุง ุฎุงู</option>
                                    <option value="essay"      {{ $qt === 'essay' ? 'selected' : '' }}>ุชุดุฑุญ</option>
                                </select>
                                @error('question_type')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                        </div>
                    </div>

                    {{-- STEP 3 --}}
                    <div class="qw-step-content" data-step="3">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">โ</div>
                            <h2 class="qw-section-title">ูพุงุณุฎโูุง ู ฺฉูุฏ ุณูุงู</h2>
                            <p class="qw-section-desc">
                                ฺฏุฒููโูุงุ ุฌูุงุจ ุตุญุญ ุง ูุณุช ุฌูุงุจโูุง ุฌุง ุฎุงู ุฑุง ุชูุธู ฺฉู.
                            </p>
                        </div>

                        {{-- MCQ --}}
                        <div id="qwMcqBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ฺฏุฒููโูุง ุณูุงู ุชุณุช</div>
                            @foreach(['a','b','c','d'] as $opt)
                                <div class="input-group mb-2">
                                    <span class="input-group-text">{{ strtoupper($opt) }}</span>
                                    <input
                                        type="text"
                                        name="options[{{ $opt }}]"
                                        class="form-control qw-input"
                                        value="{{ $opts[$opt] ?? '' }}"
                                        placeholder="ูุชู ฺฏุฒูู {{ strtoupper($opt) }}"
                                    >
                                    <span class="input-group-text bg-white">
                                        <input
                                            class="form-check-input mt-0"
                                            type="radio"
                                            name="correct_answer[correct_option]"
                                            value="{{ $opt }}"
                                            {{ ($ca['correct_option'] ?? null) === $opt ? 'checked' : '' }}
                                        >
                                        <span class="ms-1 small">ุตุญุญ</span>
                                    </span>
                                </div>
                            @endforeach
                        </div>

                        {{-- TF --}}
                        <div id="qwTfBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุฌูุงุจ ุตุญุญ (ุฏุฑุณุช / ูุงุฏุฑุณุช)</div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="form-check">
                                    <input
                                        class="form-check-input"
                                        type="radio"
                                        name="correct_answer[value]"
                                        id="qwTfTrue"
                                        value="1"
                                        {{ (string)$tfVal === '1' ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label" for="qwTfTrue">ุฏุฑุณุช</label>
                                </div>
                                <div class="form-check">
                                    <input
                                        class="form-check-input"
                                        type="radio"
                                        name="correct_answer[value]"
                                        id="qwTfFalse"
                                        value="0"
                                        {{ (string)$tfVal === '0' ? 'checked' : '' }}
                                    >
                                    <label class="form-check-label" for="qwTfFalse">ูุงุฏุฑุณุช</label>
                                </div>
                            </div>
                        </div>

                        {{-- Fill --}}
                        <div id="qwFillBlock" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุฌูุงุจโูุง ุตุญุญ (ุฌุง ุฎุงู)</div>
                            <div id="qwFillContainer">
                                @foreach($fillVals as $idx => $val)
                                    <div class="input-group mb-2">
                                        <span class="input-group-text">ุฌูุงุจ {{ $idx + 1 }}</span>
                                        <input
                                            type="text"
                                            name="correct_answer[values][]"
                                            class="form-control qw-input"
                                            value="{{ $val }}"
                                        >
                                    </div>
                                @endforeach
                            </div>

                            <button
                                type="button"
                                class="btn btn-outline-secondary btn-sm mt-1"
                                id="qwAddFillAnswer"
                            >
                                <i class="bi bi-plus-circle"></i>
                                ุงูุฒูุฏู ุฌูุงุจ ุฏฺฏุฑ
                            </button>
                        </div>

                        {{-- Essay info --}}
                        <div id="qwEssayInfo" class="qw-answer-block" style="display:none;">
                            <div class="qw-block-title">ุณูุงู ุชุดุฑุญ</div>
                            <div class="qw-hint">
                                ฺฉูุฏ ู ูฺฉุงุช ุชุตุญุญ ุฑุง ุฏุฑ ุจุฎุด ุชูุถุญ ุจููุณ.
                            </div>
                        </div>
                    </div>

                    {{-- STEP 4 --}}
                    <div class="qw-step-content" data-step="4">
                        <div class="qw-section-header">
                            <div class="qw-section-icon">๐</div>
                            <h2 class="qw-section-title">ุงุทูุงุนุงุช ุขููุฒุด ู ููุงุจุน</h2>
                            <p class="qw-section-desc">
                                ุชูุถุญ ุณูุงู ู ููฺฉโูุง ุขููุฒุด ุฑุง ุชฺฉูู ุง ุงุตูุงุญ ฺฉู.
                            </p>
                        </div>

                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ุชูุถุญ / ุฑุงูููุง ุณูุงู (ุงุฎุชุงุฑ)
                            </label>
                            <textarea
                                name="explanation"
                                id="qwExplanation"
                                rows="3"
                                class="form-control qw-input"
                            >{{ $initialExplain }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label qw-label">
                                ููฺฉโูุง ุขููุฒุด ูุฑุชุจุท
                            </label>
                            <div class="qw-hint mb-2">
                                ุฏุฑ ูุณุฎูู ูุนู ูููุฒ ุฏุงุฏูโูุง ููฺฉ ุงุฒ DB ูพุฑ ููโุดูุฏุ ุงูุง ูโุชูุงู ููฺฉโูุง ุฌุฏุฏ ุงุถุงูู ฺฉู.
                            </div>

                            <div id="qwLinksContainer"></div>

                            <button
                                type="button"
                                class="btn btn-outline-primary btn-sm"
                                id="qwAddLink"
                            >
                                <i class="bi bi-link-45deg"></i>
                                ุงูุฒูุฏู ููฺฉ ุขููุฒุด
                            </button>
                        </div>
                    </div>

                    {{-- NAV --}}
                    <div class="qw-nav-buttons">
                        <button
                            type="button"
                            class="btn qw-btn-nav qw-btn-prev"
                            id="qwPrevBtn"
                        >
                            <i class="bi bi-arrow-right"></i>
                            ูุฑุญูู ูุจู
                        </button>

                        <button
                            type="button"
                            class="btn qw-btn-nav qw-btn-next"
                            id="qwNextBtn"
                        >
                            ูุฑุญูู ุจุนุฏ
                            <i class="bi bi-arrow-left"></i>
                        </button>

                        <button
                            type="submit"
                            class="btn qw-btn-nav qw-btn-submit"
                            id="qwSubmitBtn"
                        >
                            <i class="bi bi-save2"></i>
                            ุฐุฎุฑู ุชุบุฑุงุช
                        </button>
                    </div>

                </form>
            </div>
        </div>

        {{-- RIGHT: PREVIEW (Desktop only) --}}
        <div class="col-lg-4 d-none d-lg-block">
            <div class="qw-preview-card">
                <div class="qw-preview-header">
                    <div>
                        <div class="qw-preview-title">
                            <i class="bi bi-eye me-1"></i>
                            ูพุดโููุงุด ุณูุงู
                        </div>
                        <div class="qw-preview-subtitle">
                            ุชุบุฑุงุช ูุฑูุ ุจูโุตูุฑุช ุฒูุฏู ุงูุฌุง ููุงุด ุฏุงุฏู ูโุดูุฏ.
                        </div>
                    </div>
                    <span class="badge bg-warning-subtle text-warning fw-bold">
                        Edit
                    </span>
                </div>

                <div class="qw-preview-body" id="qwPreview">
                    <div class="qw-preview-badge-row">
                        <span class="badge bg-primary-subtle text-primary" id="qwPreviewTypeBadge">
                            ููุน ุณูุงู:
                            {{ $qt ?: 'โ' }}
                        </span>
                        <span class="badge bg-info-subtle text-info" id="qwPreviewScore">
                            ุงูุชุงุฒ: {{ $initialScore ?? 0 }}
                        </span>
                        <span class="badge bg-secondary-subtle text-secondary" id="qwPreviewStatus">
                            ูุถุนุช: {{ $initialActive ? 'ูุนุงู' : 'ุบุฑูุนุงู' }}
                        </span>
                    </div>

                    <div class="qw-preview-question" id="qwPreviewContent">
                        {{ $initialContent ?: 'ูุชู ุจุฑุง ุณูุงู ุซุจุช ูุดุฏู ุงุณุช.' }}
                    </div>

                    <div class="qw-preview-meta">
                        <div class="qw-preview-meta-item">
                            <span class="qw-preview-meta-label">ุฏุฑุณ:</span>
                            <span class="qw-preview-meta-value" id="qwPreviewSubject">
                                @if($isMulti)
                                    @php
                                        $subj = $examSubjects->firstWhere('id', $initialSubjectId);
                                    @endphp
                                    {{ $subj?->title_fa ?? 'ุงูุชุฎุงุจ ูุดุฏู' }}
                                @else
                                    {{ $singleSubjectLabel }}
                                @endif
                            </span>
                        </div>
                        <div class="qw-preview-meta-item">
                            <span class="qw-preview-meta-label">ุญุงูุช ุขุฒููู:</span>
                            <span class="qw-preview-meta-value">
                                {{ $examMode === 'multi_subject' ? 'ฺูุฏุฏุฑุณ (ุฌุงูุน)' : 'ุชฺฉโุฏุฑุณ' }}
                            </span>
                        </div>
                    </div>

                    <div class="qw-preview-answers">
                        <div class="qw-preview-answers-title">
                            ูพุดโููุงุด ูพุงุณุฎโูุง
                        </div>
                        <div id="qwPreviewAnswersInner">
                            {{-- JS ุจุฑ ุงุณุงุณ ููุน ุณูุงู ูพุฑุด ูโฺฉูุฏ --}}
                        </div>
                    </div>

                    <div class="qw-preview-explanation">
                        <div class="qw-preview-explanation-title">
                            ุชูุถุญ / ุฑุงูููุง
                        </div>
                        <div id="qwPreviewExplanation" class="qw-preview-explanation-body">
                            {{ $initialExplain ?: 'ูููุฒ ุชูุถุญ ุซุจุช ูุดุฏู ุงุณุช.' }}
                        </div>
                    </div>

                    <div class="qw-preview-links">
                        <div class="qw-preview-links-title">
                            ููฺฉโูุง ุขููุฒุด
                        </div>
                        <div id="qwPreviewLinks" class="qw-preview-links-body">
                            ููฺฉ ุซุจุช ูุดุฏู ุงุณุช.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div> {{-- row --}}
</div> {{-- container --}}
@endsection

@push('scripts')
    <script src="{{ asset('assets/js/question-wizard.js') }}"></script>
@endpush


==================== FILE: resources/views/layouts/app.blade.php ====================
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>@yield('title', 'Smart Edu | ูพูู ฺฉุงุฑุจุฑ')</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">

    <link rel="stylesheet" href="{{ asset('assets/css/dashboard.css') }}">

    <style>
        body {
            font-family: Vazirmatn, system-ui, -apple-system, "Segoe UI", sans-serif;
            background: #f8fafc;
            padding-top: 70px;
            /* ูุงุตูู ุฒุฑ navbar ุซุงุจุช */
        }

        .app-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-body {
            flex: 1;
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar-wrap {
            width: 260px;
            flex-shrink: 0;
            background: #fff;
            border-left: 1px solid #e5e7eb;
        }

        .content-wrap {
            flex: 1;
            padding: 1.25rem;
            background: #f8fafc;
        }

        @media (max-width: 992px) {
            .sidebar-wrap {
                width: 220px;
            }
        }

        @media (max-width: 768px) {
            .app-body {
                flex-direction: column;
            }

            .sidebar-wrap {
                width: 100%;
                border-left: 0;
                border-bottom: 1px solid #e5e7eb;
            }
        }
    </style>

    @stack('styles')
</head>

<body>
    <div class="app-wrapper">

        {{-- NAVBAR --}}
        @include('layouts.app.navbar')

        <div class="app-body">

{{-- SIDEBAR --}}
<div class="sidebar-wrap">
    @php
        $user = auth()->user();

        // ููุด ูุนู: ุงูู selected_role (ููุด ุงูุชุฎุงุจ)ุ ุงฺฏุฑ ูุจูุฏ status
        $role = $role
            ?? ($user->selected_role ?? null)
            ?? ($user->status ?? null);
    @endphp

                @if ($role === 'student')
                    @include('layouts.app.sidebar-student')

                @elseif ($role === 'teacher')
                    @include('layouts.app.sidebar-teacher')

                @elseif ($role === 'admin')
                    {{-- โ ุณุงุฏุจุงุฑ ุงุฏูู ุชู partials ูุณุช --}}
                    @include('layouts.app.sidebar-admin')

                @else
                    <div class="p-3 text-muted small">
                        ููุด ุดูุง ูุดุฎุต ูุณุช. ูุทูุงู ุงุฒ ุตูุญู ุงุตู ุฏูุจุงุฑู ูุงุฑุฏ ุดูุฏ.
                    </div>
                @endif
            </div>


            {{-- MAIN --}}
            <main class="content-wrap">
                @yield('content')
            </main>

        </div>
    </div>

    <form id="logoutForm" method="POST" action="{{ route('logout') }}" class="d-none">
        @csrf
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    @stack('scripts')
</body>

</html>


==================== FILE: resources/views/layouts/guest.blade.php ====================
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>@yield('title', 'ุณุงูุงูู ููุดููุฏ ุขููุฒุด | Smart Edu')</title>

    {{-- Vendor CSS --}}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">

    {{-- Shared Theme (ุจุฑุง ููุงููฺฏ ุจุง partialูุง) --}}
    <link rel="stylesheet" href="{{ asset('assets/css/theme.css') }}">

    {{-- Landing CSS --}}
    <link rel="stylesheet" href="{{ asset('assets/css/landing.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/app.css') }}">

    <style>
        body {
            font-family: Vazirmatn, system-ui, -apple-system, "Segoe UI", sans-serif;
            background: #f8fafc;
            padding-top: 70px;
            /* ุงฺฏุฑ navbar ุซุงุจุช ุจุงุดุฏ */
        }
    </style>

    @stack('styles')
</head>

<body>

    @yield('content')

    {{-- Vendor JS --}}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    {{-- Project JS --}}
    <script src="{{ asset('assets/js/app.js') }}"></script>
    <script src="{{ asset('assets/js/landing.js') }}"></script>
    <script src="{{ asset('assets/js/auth.js') }}"></script>

    @stack('scripts')
</body>

</html>


==================== FILE: resources/views/dashboard/teacher/index.blade.php ====================
@extends('layouts.app')

@section('title', 'ูพูู ูุนูู - ุฏุงุดุจูุฑุฏ')

@push('styles')
<style>
    :root {
        --primary: #7B68EE;
        --primary-light: rgba(123, 104, 238, 0.1);
        --primary-gradient: linear-gradient(135deg, #7B68EE, #FF6B9D);
        --secondary: #FF6B9D;
        --secondary-light: rgba(255, 107, 157, 0.1);
        --accent: #00D4AA;
        --accent-light: rgba(0, 212, 170, 0.1);
        --gold: #FFD166;
        --light: #ffffff;
        --dark: #2D3047;
        --dark-light: #3A3F6D;
        --gray: #8A8D9B;
        --light-gray: #F8F9FF;
        --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 8px 20px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 12px 30px rgba(0, 0, 0, 0.16);
        --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
        --gradient-1: linear-gradient(135deg, #7B68EE, #FF6B9D);
        --gradient-2: linear-gradient(135deg, #00D4AA, #4361EE);
        --gradient-3: linear-gradient(135deg, #FFD166, #FF9A3D);
        --gradient-4: linear-gradient(135deg, #7209B7, #3A0CA3);
        --radius-xl: 24px;
        --radius-lg: 20px;
        --radius-md: 16px;
        --radius-sm: 12px;
    }

    * {
        font-family: 'Vazirmatn', sans-serif;
    }

    body {
        background-color: #f5f7ff;
        color: var(--dark);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .teacher-dashboard {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px 15px 80px;
        animation: fadeIn 0.6s ease both;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInLeft {
        from { transform: translateX(-30px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideInRight {
        from { transform: translateX(30px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    @keyframes float {
        0%,100% { transform: translateY(0); }
        50%     { transform: translateY(-10px); }
    }

    @keyframes floaty {
        0%,100% { transform: translateY(0) translateX(0); }
        50%     { transform: translateY(-15px) translateX(-10px); }
    }

    @keyframes shimmer {
        0%   { background-position: -200% center; }
        100% { background-position: 200% center; }
    }

    /* ========== HERO HEADER ========== */
    .hero-section {
        background: linear-gradient(135deg,
                rgba(123, 104, 238, 0.1) 0%,
                rgba(255, 107, 157, 0.1) 50%,
                rgba(0, 212, 170, 0.1) 100%);
        border-radius: var(--radius-xl);
        padding: 35px 40px;
        margin-bottom: 35px;
        border: 2px solid rgba(123, 104, 238, 0.15);
        position: relative;
        overflow: hidden;
        animation: slideInRight 0.5s ease-out;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(123, 104, 238, 0.08), transparent 70%);
        border-radius: 50%;
        animation: floaty 8s ease-in-out infinite;
    }

    .hero-section::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -10%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(0, 212, 170, 0.08), transparent 70%);
        border-radius: 50%;
        animation: floaty 10s ease-in-out infinite reverse;
    }

    .hero-content h1 {
        font-weight: 900;
        font-size: 2.2rem;
        color: var(--dark);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .hero-content h1::before {
        content: '';
        width: 8px;
        height: 50px;
        background: var(--primary-gradient);
        border-radius: 10px;
    }

    .hero-subtitle {
        color: var(--gray);
        font-size: 1.1rem;
        line-height: 1.8;
        max-width: 700px;
        margin: 0;
    }

    .hero-actions {
        display: flex;
        gap: 20px;
        margin-top: 25px;
        flex-wrap: wrap;
        position: relative;
        z-index: 2;
    }

    .btn-hero {
        padding: 16px 32px;
        border-radius: var(--radius-lg);
        font-weight: 800;
        font-size: 1.05rem;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-decoration: none;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-md);
        background: #fff;
    }

    .btn-hero:active {
        transform: scale(0.97);
    }

    .btn-primary-grad {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 10px 25px rgba(123, 104, 238, 0.3);
    }

    .btn-primary-grad:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(123, 104, 238, 0.4);
    }

    .btn-primary-grad::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.6s;
    }

    .btn-primary-grad:hover::before {
        left: 100%;
    }

    .btn-outline-secondary-grad {
        background: transparent;
        color: var(--dark);
        border: 2px solid var(--gray);
    }

    .btn-outline-secondary-grad:hover {
        background: var(--light-gray);
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
    }

    .highlight {
        background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 900;
    }

    /* ========== KPI STATS ========== */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
        animation: fadeIn 0.6s ease-out;
        animation-delay: 0.1s;
        animation-fill-mode: both;
    }

    .kpi-card {
        background: var(--light);
        border-radius: var(--radius-xl);
        padding: 28px;
        box-shadow: var(--shadow-lg);
        border: 2px solid transparent;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        animation: slideInRight 0.5s ease-out;
    }

    .kpi-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--shadow-xl);
        border-color: var(--primary-light);
    }

    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, rgba(123, 104, 238, 0.08), transparent);
        border-radius: 0 var(--radius-xl) 0 0;
    }

    .kpi-card:nth-child(2)::before {
        background: linear-gradient(135deg, rgba(0, 212, 170, 0.08), transparent);
    }

    .kpi-card:nth-child(3)::before {
        background: linear-gradient(135deg, rgba(255, 209, 102, 0.08), transparent);
    }

    .kpi-card:nth-child(4)::before {
        background: linear-gradient(135deg, rgba(255, 107, 157, 0.08), transparent);
    }

    .kpi-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
        z-index: 2;
    }

    .kpi-title {
        color: var(--gray);
        font-size: 0.95rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .kpi-icon {
        width: 60px;
        height: 60px;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: white;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s;
    }

    .kpi-card:hover .kpi-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .kpi-value {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--dark);
        margin-bottom: 10px;
        position: relative;
        z-index: 2;
        line-height: 1;
    }

    .kpi-trend {
        font-size: 0.9rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 5px;
        position: relative;
        z-index: 2;
    }

    .trend-up { color: #00D4AA; }
    .trend-down { color: #FF6B9D; }

    /* ========== MAIN DASHBOARD GRID ========== */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        margin-bottom: 35px;
    }

    @media (max-width: 992px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    /* ========== RECENT EXAMS CARD ========== */
    .recent-exams-card {
        background: var(--light);
        border-radius: var(--radius-xl);
        padding: 30px;
        box-shadow: var(--shadow-lg);
        border: 2px solid rgba(0, 0, 0, 0.05);
        height: 100%;
        position: relative;
        overflow: hidden;
        animation: slideInLeft 0.6s ease-out;
    }

    .recent-exams-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, rgba(123, 104, 238, 0.05), transparent);
        border-radius: 0 var(--radius-xl) 0 0;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        position: relative;
        z-index: 2;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--light-gray);
    }

    .card-title {
        font-weight: 900;
        font-size: 1.4rem;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card-title i {
        color: var(--primary);
        background: var(--primary-light);
        width: 45px;
        height: 45px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .view-all-link {
        color: var(--primary);
        font-weight: 800;
        font-size: 0.95rem;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s;
    }

    .view-all-link:hover {
        gap: 10px;
        color: var(--secondary);
    }

    .exams-list {
        list-style: none;
        margin: 0;
        padding: 0;
        position: relative;
        z-index: 2;
    }

    .exam-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 15px;
        border-radius: var(--radius-md);
        border-bottom: 2px dashed rgba(123, 104, 238, 0.1);
        transition: all 0.3s;
        text-decoration: none;
        color: inherit;
    }

    .exam-item:last-child {
        border-bottom: none;
    }

    .exam-item:hover {
        background: var(--primary-light);
        transform: translateX(8px);
        border-bottom-color: transparent;
    }

    .exam-info { flex: 1; }

    .exam-title {
        font-weight: 900;
        color: var(--dark);
        font-size: 1.05rem;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .exam-title i {
        color: var(--primary);
        font-size: 1.1rem;
    }

    .exam-meta {
        display: flex;
        align-items: center;
        gap: 20px;
        font-size: 0.9rem;
        color: var(--gray);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .meta-item i {
        font-size: 0.95rem;
    }

    .exam-badge {
        background: var(--primary-light);
        color: var(--primary);
        padding: 8px 16px;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 900;
        display: flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
    }

    .empty-state {
        text-align: center;
        padding: 50px 30px;
        position: relative;
        z-index: 2;
    }

    .empty-icon {
        font-size: 4rem;
        color: var(--light-gray);
        margin-bottom: 20px;
        opacity: 0.7;
    }

    .empty-text {
        color: var(--gray);
        font-size: 1.1rem;
        margin-bottom: 25px;
        line-height: 1.7;
    }

    .btn-create-first {
        padding: 14px 28px;
        background: var(--gradient-1);
        color: white;
        border: none;
        border-radius: var(--radius-lg);
        font-weight: 800;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
        text-decoration: none;
        box-shadow: 0 8px 20px rgba(123, 104, 238, 0.3);
    }

    .btn-create-first:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(123, 104, 238, 0.4);
    }

    /* ========== QUICK ACTIONS CARD ========== */
    .quick-actions-card {
        background: var(--light);
        border-radius: var(--radius-xl);
        padding: 30px;
        box-shadow: var(--shadow-lg);
        border: 2px solid rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
        animation: slideInRight 0.6s ease-out;
    }

    .quick-actions-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-2);
    }

    .quick-grid {
        display: grid;
        gap: 15px;
        position: relative;
        z-index: 2;
    }

    .quick-action {
        background: var(--light-gray);
        border-radius: var(--radius-lg);
        padding: 22px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        text-decoration: none;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 2px solid transparent;
        color: inherit;
    }

    .quick-action:hover {
        background: var(--light);
        border-color: var(--primary-light);
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .quick-content {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 1;
    }

    .quick-icon {
        width: 55px;
        height: 55px;
        border-radius: 16px;
        background: var(--primary-light);
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        transition: all 0.3s;
        flex-shrink: 0;
    }

    .quick-action:hover .quick-icon {
        background: var(--gradient-1);
        color: white;
        transform: scale(1.1);
    }

    .quick-text h4 {
        font-weight: 900;
        color: var(--dark);
        font-size: 1rem;
        margin: 0 0 5px;
    }

    .quick-text p {
        color: var(--gray);
        font-size: 0.85rem;
        margin: 0;
        line-height: 1.5;
    }

    .quick-arrow {
        color: var(--gray);
        font-size: 1.1rem;
        transition: all 0.3s;
    }

    .quick-action:hover .quick-arrow {
        transform: translateX(-5px);
        color: var(--primary);
    }

    /* ========== SYSTEM STATUS CARD ========== */
    .system-status-card {
        background: linear-gradient(135deg, #2D3047, #1A1C30);
        color: white;
        border-radius: var(--radius-xl);
        padding: 30px;
        position: relative;
        overflow: hidden;
        animation: slideInRight 0.6s ease-out;
        animation-delay: 0.2s;
        animation-fill-mode: both;
    }

    .system-status-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(0, 212, 170, 0.15), transparent 70%);
        border-radius: 50%;
        animation: floaty 12s ease-in-out infinite;
    }

    .system-status-card::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -10%;
        width: 250px;
        height: 250px;
        background: radial-gradient(circle, rgba(123, 104, 238, 0.15), transparent 70%);
        border-radius: 50%;
        animation: floaty 10s ease-in-out infinite reverse;
    }

    .system-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        position: relative;
        z-index: 2;
    }

    .system-header i {
        color: var(--accent);
        background: rgba(0, 212, 170, 0.15);
        width: 50px;
        height: 50px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
    }

    .system-header h3 {
        font-weight: 900;
        font-size: 1.3rem;
        margin: 0;
    }

    .system-description {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.95rem;
        line-height: 1.7;
        margin-bottom: 25px;
        position: relative;
        z-index: 2;
    }

    .system-list {
        display: grid;
        gap: 18px;
        position: relative;
        z-index: 2;
    }

    .system-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .system-item i {
        color: var(--gold);
        font-size: 1rem;
        margin-top: 3px;
        flex-shrink: 0;
    }

    .system-item p {
        color: rgba(255, 255, 255, 0.85);
        font-size: 0.95rem;
        margin: 0;
        line-height: 1.6;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 1200px) {
        .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
        .teacher-dashboard { padding: 15px 10px 60px; }

        .hero-section { padding: 25px; }

        .hero-content h1 { font-size: 1.8rem; }

        .hero-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-hero {
            width: 100%;
            justify-content: center;
        }

        .stats-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .kpi-card { padding: 22px; }

        .kpi-value { font-size: 2.2rem; }

        .dashboard-grid { gap: 20px; }

        .exam-meta {
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }

        .exam-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }

        .exam-badge { align-self: flex-start; }

        .quick-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .quick-action { padding: 18px; }
    }

    @media (max-width: 480px) {
        .stats-grid { grid-template-columns: 1fr; }

        .kpi-value { font-size: 2rem; }

        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }

        .view-all-link { align-self: flex-start; }
    }

    .btn-hero,
    .btn-create-first,
    .quick-action,
    .exam-item {
        min-height: 48px;
    }

    ::selection {
        background: rgba(123, 104, 238, 0.2);
        color: var(--dark);
    }
</style>
@endpush

@section('content')
<div class="teacher-dashboard">

    {{-- HERO --}}
    <div class="hero-section">
        <div class="hero-content">
            <h1>
                <span class="highlight">ุฏุงุดุจูุฑุฏ ูุนูู</span>
            </h1>
            <p class="hero-subtitle">
                ุฎูุงุตูโุง ุงุฒ ุขุฒูููโูุงุ ฺฉูุงุณโูุง ู ูุนุงูุช ุฏุงูุดโุขููุฒุงู ุดูุง.
                ุงุฒ ุขุฎุฑู ุขูุงุฑูุง ู ฺฏุฒุงุฑุดโูุง ูุทูุน ุดูุฏ.
            </p>
        </div>

        <div class="hero-actions">
            <a href="{{ route('teacher.exams.create') }}" class="btn-hero btn-primary-grad">
                <i class="fas fa-file-circle-plus"></i>
                ุงุฌุงุฏ ุขุฒููู ุฌุฏุฏ
            </a>
            <a href="{{ route('teacher.exams.index') }}" class="btn-hero btn-outline-secondary-grad">
                <i class="fas fa-clipboard-list"></i>
                ูุฏุฑุช ุขุฒูููโูุง
            </a>
        </div>
    </div>

    {{-- KPI --}}
    <div class="stats-grid">
        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-title">ุชุนุฏุงุฏ ฺฉู ุขุฒูููโูุง</div>
                <div class="kpi-icon" style="background: var(--gradient-1);">
                    <i class="fas fa-file-alt"></i>
                </div>
            </div>
            <div class="kpi-value">{{ $stats['total_exams'] ?? '0' }}</div>
            <div class="kpi-trend trend-up">
                <i class="fas fa-arrow-up"></i>
                ูุณุจุช ุจู ูุงู ฺฏุฐุดุชู
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-title">ุขุฒูููโูุง ูุนุงู</div>
                <div class="kpi-icon" style="background: var(--gradient-2);">
                    <i class="fas fa-bolt"></i>
                </div>
            </div>
            <div class="kpi-value">{{ $stats['active_exams'] ?? '0' }}</div>
            <div class="kpi-trend trend-up">
                <i class="fas fa-chart-line"></i>
                ุฏุฑ ุญุงู ุงุฌุฑุง
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-title">ุชุนุฏุงุฏ ุฏุงูุดโุขููุฒุงู</div>
                <div class="kpi-icon" style="background: var(--gradient-3);">
                    <i class="fas fa-user-graduate"></i>
                </div>
            </div>
            <div class="kpi-value">{{ $stats['students_count'] ?? '0' }}</div>
            <div class="kpi-trend trend-up">
                <i class="fas fa-users"></i>
                @if (($stats['new_students'] ?? 0) > 0)
                    {{ $stats['new_students'] }} ุฏุงูุดโุขููุฒ ุฌุฏุฏ
                @else
                    ุจุฏูู ุฏุงูุดโุขููุฒ ุฌุฏุฏ
                @endif
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-header">
                <div class="kpi-title">ูพุงุณุฎ ุจุฑุฑุณโูุดุฏู</div>
                <div class="kpi-icon" style="background: var(--gradient-4);">
                    <i class="fas fa-clipboard-check"></i>
                </div>
            </div>
            <div class="kpi-value">{{ $stats['pending_reviews'] ?? '0' }}</div>
            <div class="kpi-trend trend-down">
                <i class="fas fa-exclamation-circle"></i>
                ูุงุฒ ุจู ุจุฑุฑุณ ููุฑ
            </div>
        </div>
    </div>

    {{-- MAIN GRID --}}
    <div class="dashboard-grid">

        {{-- RECENT EXAMS --}}
        <div class="recent-exams-card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-clock-rotate-left"></i>
                    ุขุฒูููโูุง ุงุฎุฑ ุดูุง
                </div>
                <a href="{{ route('teacher.exams.index') }}" class="view-all-link">
                    ูุดุงูุฏู ููู
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>

            @if($recentExams->count())
                <ul class="exams-list">
                    @foreach($recentExams as $exam)
                        <li>
                            <a href="{{ route('teacher.exams.edit', $exam->id) }}" class="exam-item">
                                <div class="exam-info">
                                    <div class="exam-title">
                                        <i class="fas fa-file-pen"></i>
                                        {{ $exam->title }}
                                    </div>

                                    <div class="exam-meta">
                                        <span class="meta-item">
                                            <i class="fas fa-layer-group"></i>
                                            ุณุทุญ: {{ $exam->level ?? 'โ' }}
                                        </span>

                                        <span class="meta-item">
                                            <i class="fas fa-calendar-day"></i>
                                            ุชุงุฑุฎ:
                                            {{ $exam->start_at ? $exam->start_at->format('Y/m/d H:i') : 'ูุงูุดุฎุต' }}
                                        </span>

                                        <span class="meta-item">
                                            <i class="fas fa-question-circle"></i>
                                            ุณูุงูุงุช: {{ $exam->questions_count ?? 0 }}
                                        </span>
                                    </div>
                                </div>

                                <div class="exam-badge">
                                    <i class="fas fa-user-check"></i>
                                    {{ $exam->attempts_count ?? 0 }} ุดุฑฺฉุชโฺฉููุฏู
                                </div>
                            </a>
                        </li>
                    @endforeach
                </ul>
            @else
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <h3 style="color: var(--dark); margin-bottom: 15px; font-weight: 900;">
                        ูููุฒ ุขุฒููู ุซุจุช ูฺฉุฑุฏูโุงุฏ
                    </h3>
                    <p class="empty-text">
                        ุจุฑุง ุดุฑูุน ฺฉุงุฑ ู ุงุฌุงุฏ ุงููู ุขุฒูููุ ุฑู ุฏฺฉูู ุฒุฑ ฺฉูฺฉ ฺฉูุฏ.
                        ูโุชูุงูุฏ ุขุฒูููโูุง ูุฎุชูู ุจุง ุณุทูุญ ูุชูุงูุช ุงุฌุงุฏ ฺฉูุฏ.
                    </p>
                    <a href="{{ route('teacher.exams.create') }}" class="btn-create-first">
                        <i class="fas fa-plus-circle"></i>
                        ุงุฌุงุฏ ุงููู ุขุฒููู
                    </a>
                </div>
            @endif
        </div>

        {{-- RIGHT SIDE: QUICK + STATUS --}}
        <div>
            <div class="quick-actions-card">
                <div class="card-header" style="border: none; padding: 0 0 20px 0;">
                    <div class="card-title">
                        <i class="fas fa-bolt"></i>
                        ูุงูุจุฑูุง ููู
                    </div>
                </div>

                <div class="quick-grid">
                    <a href="{{ route('teacher.classes.index') }}" class="quick-action">
                        <div class="quick-content">
                            <div class="quick-icon"
                                 style="color: var(--primary); background: rgba(123, 104, 238, 0.1);">
                                <i class="fas fa-people-group"></i>
                            </div>
                            <div class="quick-text">
                                <h4>ูุฏุฑุช ฺฉูุงุณโูุง</h4>
                                <p>ุณุงุฎุชุ ูุฑุงุด ู ฺฏุฑููโุจูุฏ</p>
                            </div>
                        </div>
                        <div class="quick-arrow">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a href="{{ route('teacher.students.index') }}" class="quick-action">
                        <div class="quick-content">
                            <div class="quick-icon"
                                 style="color: #00D4AA; background: rgba(0, 212, 170, 0.1);">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="quick-text">
                                <h4>ูุณุช ุฏุงูุดโุขููุฒุงู</h4>
                                <p>ุญุถูุฑ ู ุนููฺฉุฑุฏ</p>
                            </div>
                        </div>
                        <div class="quick-arrow">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a href="{{ route('teacher.reports.index') }}" class="quick-action">
                        <div class="quick-content">
                            <div class="quick-icon"
                                 style="color: #4361EE; background: rgba(67, 97, 238, 0.1);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="quick-text">
                                <h4>ฺฏุฒุงุฑุดโูุง ู ุชุญููโูุง</h4>
                                <p>ูููุฏุงุฑ ู ูพุดุฑูุช</p>
                            </div>
                        </div>
                        <div class="quick-arrow">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a href="{{ route('teacher.profile') }}" class="quick-action">
                        <div class="quick-content">
                            <div class="quick-icon"
                                 style="color: #FF6B9D; background: rgba(255, 107, 157, 0.1);">
                                <i class="fas fa-user-cog"></i>
                            </div>
                            <div class="quick-text">
                                <h4>ูพุฑููุงู ูู</h4>
                                <p>ูุฏุฑุช ุญุณุงุจ ฺฉุงุฑุจุฑ</p>
                            </div>
                        </div>
                        <div class="quick-arrow">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>
                </div>
            </div>

            <div class="system-status-card">
                <div class="system-header">
                    <i class="fas fa-shield-check"></i>
                    <h3>ูุถุนุช ฺฉู ุณุณุชู</h3>
                </div>
                <p class="system-description">
                    ุงู ุจุฎุด ุจุฑุง ุงุนูุงูโูุง ู ุงุฏุขูุฑโูุง ููู ุดูุงุณุช.
                    ุขุฎุฑู ูุถุนุช ุณุณุชู ู ุชูุตูโูุง ุขููุฒุด ุฑุง ุงูุฌุง ูุดุงูุฏู ฺฉูุฏ.
                </p>

                <div class="system-list">
                    <div class="system-item">
                        <i class="fas fa-bell"></i>
                        <p><strong>ุงุฏุขูุฑ:</strong> ูุชุงุฌ ุขุฒูููโูุง ุชุดุฑุญ ุฑุง ุจุฑุฑุณ ฺฉูุฏ.</p>
                    </div>
                    <div class="system-item">
                        <i class="fas fa-lightbulb"></i>
                        <p><strong>ูพุดููุงุฏ:</strong> ุจุฑุง ูุฑ ฺฉูุงุณ ุญุฏุงูู ฺฉ ุขุฒููู ุชูุฑู ุชูุธู ฺฉูุฏ.</p>
                    </div>
                    <div class="system-item">
                        <i class="fas fa-chart-line"></i>
                        <p><strong>ฺฏุฒุงุฑุด:</strong> ูุงูฺฏู ููุฑุงุช ฺฉูุงุณ ุดูุง ฑตูช ุจูุจูุฏ ุงูุชู ุงุณุช.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>
@endsection

@push('scripts')
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ุงููุดู ุชุฃุฎุฑ KPI
        document.querySelectorAll('.kpi-card').forEach((card, i) => {
            card.style.animationDelay = (i * 0.1) + 's';
        });

        // ูุจุฑู ุจุฑุง ุขุชูโูุง ฺฉูฺฉ (ุฏุฑ ุตูุฑุช ูพุดุชุจุงู)
        if (navigator.vibrate) {
            const clickable = document.querySelectorAll(
                '.btn-hero, .quick-action, .exam-item, .btn-create-first'
            );
            clickable.forEach(el => {
                el.addEventListener('click', () => navigator.vibrate(25));
            });
        }

        // ุงฺฏุฑ ุขุฒููู ุจุฑุฑุณโูุดุฏู ุฏุงุฑูุ ฺฉ ููุฏุงู ุงุฏุขูุฑ ูุฑู
        const pending = parseInt('{{ $stats['pending_reviews'] ?? 0 }}', 10);
        if (pending > 0) {
            setTimeout(showReminderModal, 3000);
        }

        function showReminderModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.9);
                background: white;
                padding: 30px;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                z-index: 1000;
                text-align: center;
                max-width: 400px;
                width: 90%;
                animation: scaleIn 0.3s ease forwards;
                border: 3px solid var(--primary);
            `;
            modal.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 20px; color: var(--primary);">
                    <i class="fas fa-bell"></i>
                </div>
                <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 1.3rem; font-weight: 700;">
                    ุงุฏุขูุฑ ููู!
                </h3>
                <p style="color: var(--gray); margin-bottom: 25px; font-size: 1rem; line-height: 1.6;">
                    ุดูุง {{ $stats['pending_reviews'] ?? 0 }} ุขุฒููู ุจุฑุฑุณโูุดุฏู ุฏุงุฑุฏ.
                    ุชูุตู ูโฺฉูู ุจุฑุง ุญูุธ ฺฉูุช ุขููุฒุดุ ุญุฏุงฺฉุซุฑ ุธุฑู ฒด ุณุงุนุช ุจุฑุฑุณ ุดููุฏ.
                </p>
                <div style="display: flex; gap: 10px;">
                    <button onclick="closeReminderModal()"
                            style="flex:1; padding: 14px; border: none; background: var(--light-gray); color: var(--dark); border-radius: 12px; font-weight: 700; font-size: 1rem;">
                        ุจุงุดู
                    </button>
                    <button onclick="window.location.href='{{ route('teacher.exams.index') }}';"
                            style="flex:1; padding: 14px; border: none; background: var(--gradient-1); color: white; border-radius: 12px; font-weight: 700; font-size: 1rem;">
                        ูุดุงูุฏู ุขุฒูููโูุง
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            const overlay = document.createElement('div');
            overlay.id = 'reminderOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 999;
                animation: fadeIn .3s ease;
            `;
            document.body.appendChild(overlay);

            window.closeReminderModal = function() {
                modal.remove();
                const ov = document.getElementById('reminderOverlay');
                if (ov) ov.remove();
            };
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes scaleIn {
                from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
                to   { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to   { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    });
</script>
@endpush


==================== FILE: resources/views/dashboard/teacher/exams/create.blade.php ====================
@extends('layouts.app')
@section('title', 'ุณุงุฎุช ุขุฒููู ุฌุฏุฏ - SmartEdu')

@push('styles')
<style>
    /* ุชู ูุฑูุฒูโุง - ุขุจ ุฏุฑุง */
    :root {
        --primary: #00CED1;
        --primary-light: rgba(0, 206, 209, 0.1);
        --primary-gradient: linear-gradient(135deg, #00CED1, #20B2AA);
        --secondary: #4682B4;
        --secondary-light: rgba(70, 130, 180, 0.1);
        --accent: #48D1CC;
        --accent-light: rgba(72, 209, 204, 0.1);
        --success: #32CD32;
        --success-light: rgba(50, 205, 50, 0.1);
        --warning: #FFA500;
        --warning-light: rgba(255, 165, 0, 0.1);
        --light: #ffffff;
        --dark: #2F4F4F;
        --dark-light: #4A6F6F;
        --gray: #708090;
        --light-gray: #F0F8FF;
        --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 8px 20px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 12px 30px rgba(0, 0, 0, 0.16);
        --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
        --radius-xl: 24px;
        --radius-lg: 20px;
        --radius-md: 16px;
        --radius-sm: 12px;
    }

    * { font-family: 'Vazirmatn', sans-serif; }

    body {
        background-color: #f8fcfc;
        color: var(--dark);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .create-exam-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px 15px 80px;
        animation: fadeIn 0.6s ease both;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideInLeft {
        from { transform: translateX(-30px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to   { transform: translateY(0); opacity: 1; }
    }

    /* HEADER */
    .page-header {
        background: linear-gradient(135deg, rgba(0, 206, 209, 0.1), rgba(70, 130, 180, 0.1));
        border-radius: var(--radius-xl);
        padding: 25px 30px;
        margin-bottom: 30px;
        border: 2px solid rgba(0, 206, 209, 0.15);
        position: relative;
        overflow: hidden;
        animation: slideInLeft 0.5s ease-out;
    }
    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(0, 206, 209, 0.08), transparent 70%);
        border-radius: 50%;
    }
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        position: relative;
        z-index: 2;
    }
    .header-title h1 {
        font-weight: 900;
        font-size: 1.8rem;
        color: var(--dark);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .header-title h1::before {
        content: '';
        width: 8px;
        height: 40px;
        background: var(--primary-gradient);
        border-radius: 10px;
    }
    .header-subtitle {
        color: var(--gray);
        font-size: 1.05rem;
        line-height: 1.8;
        max-width: 600px;
    }
    .btn-back {
        padding: 12px 24px;
        border-radius: var(--radius-lg);
        font-weight: 800;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: transparent;
        color: var(--dark);
        border: 2px solid var(--gray);
        transition: all 0.25s ease;
        text-decoration: none;
        white-space: nowrap;
    }
    .btn-back:hover {
        background: var(--light-gray);
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }

    /* PROGRESS */
    .progress-container { margin-bottom: 35px; animation: slideUp 0.5s ease-out; }
    .progress-bar {
        height: 8px;
        background: var(--light-gray);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 15px;
    }
    .progress-fill {
        height: 100%;
        background: var(--primary-gradient);
        border-radius: 4px;
        width: 12.5%;
        transition: width 0.6s ease;
    }
    .progress-steps {
        display: flex;
        justify-content: space-between;
        padding: 0 8px;
        gap: 6px;
        flex-wrap: wrap;
    }
    .step-item { text-align: center; flex: 1; min-width: 105px; }
    .step-number {
        width: 34px; height: 34px; border-radius: 50%;
        background: var(--light);
        border: 2px solid var(--light-gray);
        display: flex; align-items: center; justify-content: center;
        font-weight: 900; color: var(--gray);
        margin: 0 auto 6px;
        transition: all 0.3s;
        font-size: .9rem;
    }
    .step-item.active .step-number {
        background: var(--primary); color: white; border-color: var(--primary); transform: scale(1.08);
    }
    .step-item.completed .step-number {
        background: var(--success); color: white; border-color: var(--success);
    }
    .step-name {
        font-size: 0.82rem; font-weight: 800; color: var(--gray);
        transition: all .3s;
    }
    .step-item.active .step-name { color: var(--primary); font-weight: 900; }

    /* FORM CONTAINER */
    .form-container {
        background: var(--light);
        border-radius: var(--radius-xl);
        padding: 36px;
        box-shadow: var(--shadow-lg);
        border: 2px solid rgba(0, 206, 209, 0.08);
        position: relative;
        overflow: hidden;
        animation: slideUp 0.6s ease-out;
    }

    .form-section { display: none; animation: fadeIn .35s ease; }
    .form-section.active { display: block; }

    .section-header { margin-bottom: 25px; text-align: center; }
    .section-icon { font-size: 2.6rem; margin-bottom: 10px; color: var(--primary); }
    .section-title { font-weight: 900; font-size: 1.45rem; color: var(--dark); margin-bottom: 8px; }
    .section-description {
        color: var(--gray); font-size: 1.02rem; line-height: 1.7;
        max-width: 700px; margin: 0 auto;
    }

    /* SELECTION GRID (reusable cards) */
    .selection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 16px;
        margin-top: 12px;
    }
    @media (max-width: 768px) {
        .selection-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 480px) {
        .selection-grid { grid-template-columns: 1fr; }
    }
    .selection-card {
        border: 3px solid var(--light-gray);
        border-radius: var(--radius-lg);
        padding: 18px 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.25s ease;
        background: var(--light);
        position: relative;
        overflow: hidden;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 6px;
    }
    .selection-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); border-color: rgba(0,206,209,.35); }
    .selection-card.selected {
        border-color: var(--primary);
        background: linear-gradient(135deg, rgba(0, 206, 209, 0.06), rgba(70, 130, 180, 0.06));
        box-shadow: var(--shadow-md);
    }
    .selection-icon { font-size: 2rem; }
    .selection-name { font-weight: 900; font-size: 1.05rem; color: var(--dark); }
    .selection-description { color: var(--gray); font-size: 0.9rem; line-height: 1.6; margin: 0; }

    /* EXAM TYPE cards (step1) */
    .exam-type-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
    @media (max-width: 768px) { .exam-type-grid { grid-template-columns: 1fr; } }
    .type-card {
        border: 3px solid var(--light-gray);
        border-radius: var(--radius-lg);
        padding: 22px 18px;
        text-align: center;
        cursor: pointer;
        transition: all 0.25s ease;
        background: var(--light);
        position: relative;
        overflow: hidden;
        min-height: 175px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 8px;
    }
    .type-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-lg); }
    .type-card.selected {
        border-color: var(--primary);
        background: linear-gradient(135deg, rgba(0, 206, 209, 0.05), rgba(70, 130, 180, 0.05));
        box-shadow: var(--shadow-md);
    }
    .type-icon { font-size: 2.2rem; color: var(--primary); }
    .type-title { font-weight: 900; font-size: 1.1rem; color: var(--dark); }
    .type-description { color: var(--gray); font-size: 0.9rem; line-height: 1.6; margin:0; }
    .type-badge {
        position: absolute; top: 10px; left: 10px;
        background: var(--primary); color: #fff;
        padding: 4px 12px; border-radius: 999px;
        font-size: .75rem; font-weight: 900;
    }

    /* SUBJECTS LIST (step7) */
    .subjects-wrap { margin-top: 8px; }
    .subject-item {
        display: flex; align-items: center; gap: 12px;
        background: var(--light);
        border: 2px solid var(--light-gray);
        border-radius: var(--radius-md);
        padding: 12px 14px;
        margin-bottom: 10px;
        transition: all .2s ease;
    }
    .subject-item:hover { border-color: rgba(0,206,209,.35); box-shadow: var(--shadow-sm); }
    .subject-checkbox input { width: 18px; height: 18px; cursor: pointer; }
    .subject-info { flex:1; text-align:right; }
    .subject-name { font-weight: 900; font-size: 1rem; margin-bottom: 4px; }
    .subject-meta { color: var(--gray); font-size: .85rem; display:flex; gap:10px; flex-wrap:wrap; }
    .subject-code { background: var(--light-gray); padding:2px 8px; border-radius: 6px; }

    /* PREVIEW (step8) */
    .preview-section {
        background: linear-gradient(135deg, rgba(0, 206, 209, 0.05), rgba(70, 130, 180, 0.05));
        border-radius: var(--radius-xl);
        padding: 22px;
        margin-bottom: 25px;
        border: 2px solid var(--primary-light);
    }
    .preview-title {
        font-weight: 900; color: var(--dark);
        margin-bottom: 14px; display:flex; align-items:center; gap:8px;
        font-size: 1.15rem;
    }
    .preview-grid {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px;
    }
    .preview-item {
        background: var(--light); border-radius: var(--radius-md); padding: 12px;
        border: 2px solid var(--light-gray);
    }
    .preview-label { font-size: .85rem; color: var(--gray); font-weight: 700; margin-bottom: 4px; }
    .preview-value { font-weight: 900; color: var(--dark); font-size: 1rem; }

    /* DETAILS FORM (step8) */
    .details-form { max-width: 650px; margin: 0 auto; }
    .form-group { margin-bottom: 20px; }
    .form-label {
        color: var(--dark);
        font-weight: 900; font-size: 1rem; margin-bottom: 10px;
        display:flex; align-items:center; gap:8px;
    }
    .form-label i {
        color: var(--primary);
        background: var(--primary-light);
        width: 34px; height: 34px; border-radius: 10px;
        display:flex; align-items:center; justify-content:center; font-size:1rem;
    }
    .form-input, .form-textarea {
        width: 100%; padding: 14px 16px;
        border: 2px solid var(--light-gray);
        border-radius: var(--radius-md);
        background: var(--light); color: var(--dark);
        font-weight: 700; font-size: 1rem;
        transition: all .25s ease;
    }
    .form-textarea { min-height: 110px; resize: vertical; line-height: 1.7; }
    .form-input:focus, .form-textarea:focus {
        outline: none; border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 206, 209, 0.2);
    }

    .checkbox-group {
        background: var(--light-gray);
        border-radius: var(--radius-lg);
        padding: 16px;
        margin-top: 12px;
    }
    .form-check { display:flex; align-items:center; gap:10px; }
    .form-check-input { width: 20px; height: 20px; cursor: pointer; }
    .form-check-label { font-weight: 900; font-size: 1rem; cursor: pointer; }
    .form-text { font-size: .9rem; color: var(--gray); margin-top: 8px; }

    /* NAV BUTTONS */
    .nav-buttons {
        display: flex; justify-content: space-between;
        margin-top: 30px; gap: 12px;
    }
    .btn-nav {
        padding: 14px 26px;
        border-radius: var(--radius-lg);
        font-weight: 900; font-size: 1rem;
        display:flex; align-items:center; gap:8px; justify-content:center;
        cursor:pointer; border:2px solid transparent; min-width: 150px;
        transition: all .25s ease;
    }
    .btn-prev { background: transparent; color: var(--dark); border:2px solid var(--gray); }
    .btn-prev:hover { background: var(--light-gray); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
    .btn-next { background: var(--primary-gradient); color:#fff; box-shadow: 0 8px 18px rgba(0,206,209,.3); }
    .btn-next:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,206,209,.4); }
    .btn-submit { background: var(--success); color:#fff; box-shadow: 0 8px 18px rgba(50,205,50,.3); }
    .btn-submit:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(50,205,50,.4); }

    @media (max-width: 768px) {
        .form-container { padding: 22px; }
        .header-title h1 { font-size: 1.5rem; }
        .nav-buttons { flex-direction: column; }
        .btn-nav { width: 100%; min-width: unset; }
    }
</style>
@endpush

@section('content')
<div class="create-exam-container">

    {{-- HEADER --}}
    <div class="page-header">
        <div class="header-content">
            <div class="header-title">
                <h1>
                    <span style="background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 100%);
                                 -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        ุณุงุฎุช ุขุฒููู ุฌุฏุฏ
                    </span>
                    ๐
                </h1>
                <p class="header-subtitle">ุขุฒููู ุฎูุฏ ุฑุง ุจู ุตูุฑุช ูุฑุญููโุง ู ุจุง ุฏูุช ุงุฌุงุฏ ฺฉูุฏ.</p>
            </div>

            <a href="{{ route('teacher.exams.index') }}" class="btn-back">
                <i class="fas fa-arrow-right"></i>
                ุจุงุฒฺฏุดุช ุจู ูุณุช ุขุฒูููโูุง
            </a>
        </div>
    </div>

    {{-- PROGRESS --}}
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-steps">
            <div class="step-item active" data-step="1">
                <div class="step-number">ฑ</div>
                <div class="step-name">ููุน ุขุฒููู</div>
            </div>
            <div class="step-item" data-step="2">
                <div class="step-number">ฒ</div>
                <div class="step-name">ูพุงู ุชุญุตู</div>
            </div>
            <div class="step-item" data-step="3">
                <div class="step-number">ณ</div>
                <div class="step-name">ุดุงุฎู ุชุญุตู</div>
            </div>
            <div class="step-item" data-step="4">
                <div class="step-number">ด</div>
                <div class="step-name">ุฒููู ูู</div>
            </div>
            <div class="step-item" data-step="5">
                <div class="step-number">ต</div>
                <div class="step-name">ุฒุฑุฑุดุชู</div>
            </div>
            <div class="step-item" data-step="6">
                <div class="step-number">ถ</div>
                <div class="step-name">ุฏุณุชู ุฏุฑุณ</div>
            </div>
            <div class="step-item" data-step="7">
                <div class="step-number">ท</div>
                <div class="step-name">ุงูุชุฎุงุจ ุฏุฑุณ</div>
            </div>
            <div class="step-item" data-step="8">
                <div class="step-number">ธ</div>
                <div class="step-name">ุฌุฒุฆุงุช</div>
            </div>
        </div>
    </div>

    {{-- FORM --}}
    <div class="form-container">
@if ($errors->any())
    <div class="alert alert-danger">
        <ul class="mb-0">
            @foreach ($errors->all() as $error)
                <li>{{ $error }}</li>
            @endforeach
        </ul>
    </div>
@endif

        <form method="POST" action="{{ route('teacher.exams.store') }}" id="examForm" onsubmit="return validateFinalStep()">
            @csrf

            {{-- Hidden Inputs (JS fills these) --}}
            <input type="hidden" name="exam_type" id="examType" value="public">
            <input type="hidden" name="classroom_id" id="classroomId" value="{{ $selectedClassroomId ?? '' }}">

            <input type="hidden" name="section_id" id="sectionId">
            <input type="hidden" name="grade_id" id="gradeId">
            <input type="hidden" name="branch_id" id="branchId">
            <input type="hidden" name="field_id" id="fieldId">
            <input type="hidden" name="subfield_id" id="subfieldId">
            <input type="hidden" name="subject_type_id" id="subjectTypeId">
            <input type="hidden" name="subjects" id="subjectsInput">

            {{-- STEP 1 --}}
            <div class="form-section active" id="step1">
                <div class="section-header">
                    <div class="section-icon">๐ฏ</div>
                    <h2 class="section-title">ููุน ุขุฒููู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ฺฉ ุงุฒ ฺฏุฒููโูุง ุฒุฑ ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="exam-type-grid">
                    <div class="type-card" data-type="public" onclick="selectExamType('public')">
                        <div class="type-icon">๐</div>
                        <div class="type-title">ุขุฒููู ุนููู</div>
                        <p class="type-description">ุจุฑุง ุชูุงู ููุฑุฌูุงู ูุงุจู ุฏุณุชุฑุณ ุงุณุช.</p>
                        <div class="type-badge">ุนููู</div>
                    </div>

                    <div class="type-card" data-type="class_single" onclick="selectExamType('class_single')">
                        <div class="type-icon">๐</div>
                        <div class="type-title">ฺฉูุงุณ ุชฺฉโุฏุฑุณ</div>
                        <p class="type-description">ููุท ุจุฑุง ฺฉ ฺฉูุงุณ ู ฺฉ ุฏุฑุณ ูุดุฎุต.</p>
                        <div class="type-badge">ุชุฎุตุต</div>
                    </div>

                    <div class="type-card" data-type="class_comprehensive" onclick="selectExamType('class_comprehensive')">
                        <div class="type-icon">๐</div>
                        <div class="type-title">ฺฉูุงุณ ุฌุงูุน</div>
                        <p class="type-description">ุจุฑุง ฺฉ ฺฉูุงุณ ุดุงูู ููู ุฏุฑูุณ ูพุงู.</p>
                        <div class="type-badge">ุฌุงูุน</div>
                    </div>
                </div>

                {{-- Classroom selection (only for class exams) --}}
                <div id="classroomSelectionSection" style="display:none; margin-top:24px;">
                    <div class="section-header" style="margin-bottom:12px;">
                        <h3 class="section-title" style="font-size:1.2rem;">ฺฉูุงุณ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h3>
                        <p class="section-description">ฺฉูุงุณโูุง ุดูุง ุงุฒ ุณุณุชู ุจุงุฑฺฏุฐุงุฑ ูโุดููุฏ.</p>
                    </div>

                    <div class="selection-grid" id="existingClassroomsContainer"></div>

                    <div style="text-align:center; margin-top:14px;">
                        <button type="button" class="btn-nav btn-prev" onclick="createNewClassroom()" style="border-color:var(--primary); color:var(--primary);">
                            <i class="fas fa-plus-circle"></i>
                            ุงุฌุงุฏ ฺฉูุงุณ ุฌุฏุฏ
                        </button>
                    </div>
                </div>
            </div>

            {{-- STEP 2 --}}
            <div class="form-section" id="step2">
                <div class="section-header">
                    <div class="section-icon">๐</div>
                    <h2 class="section-title">ูพุงู ุชุญุตู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ูพุงูู ููุฑุฏ ูุธุฑ ุขุฒููู ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="selection-grid" id="gradesGrid"></div>
            </div>

            {{-- STEP 3 --}}
            <div class="form-section" id="step3">
                <div class="section-header">
                    <div class="section-icon">๐</div>
                    <h2 class="section-title">ุดุงุฎู ุชุญุตู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ุดุงุฎูู ุขููุฒุด ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="selection-grid" id="branchesGrid"></div>
            </div>

            {{-- STEP 4 --}}
            <div class="form-section" id="step4">
                <div class="section-header">
                    <div class="section-icon">๐ญ</div>
                    <h2 class="section-title">ุฒููู ุขููุฒุด ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ุฒูููู ุขููุฒุด ูุฑุชุจุท ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="selection-grid" id="fieldsGrid"></div>
            </div>

            {{-- STEP 5 --}}
            <div class="form-section" id="step5">
                <div class="section-header">
                    <div class="section-icon">๐ฌ</div>
                    <h2 class="section-title">ุฒุฑุฑุดุชู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ุฒุฑุฑุดุชูู ููุฑุฏ ูุธุฑ ุฑุง ูุดุฎุต ููุงุฏ.</p>
                </div>

                <div class="selection-grid" id="subfieldGrid"></div>
            </div>

            {{-- STEP 6 --}}
            <div class="form-section" id="step6">
                <div class="section-header">
                    <div class="section-icon">๐</div>
                    <h2 class="section-title">ุฏุณุชู ุฏุฑุณ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ุฏุณุชูู ุฏุฑุณ ุขุฒููู ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="selection-grid" id="subjectTypesGrid"></div>
            </div>

            {{-- STEP 7 --}}
            <div class="form-section" id="step7">
                <div class="section-header">
                    <div class="section-icon">๐</div>
                    <h2 class="section-title">ุฏุฑุณ(ูุง) ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</h2>
                    <p class="section-description">ุจุฑ ุงุณุงุณ ููุน ุขุฒูููุ ุฏุฑุณโูุง ููุฑุฏ ูุธุฑ ุฑุง ุงูุชุฎุงุจ ููุงุฏ.</p>
                </div>

                <div class="subjects-wrap" id="subjectsContainer"></div>
            </div>

            {{-- STEP 8 --}}
            <div class="form-section" id="step8">
                <div class="section-header">
                    <div class="section-icon">โ๏ธ</div>
                    <h2 class="section-title">ุฌุฒุฆุงุช ุขุฒููู ุฑุง ุชฺฉูู ฺฉูุฏ</h2>
                    <p class="section-description">ุงุทูุงุนุงุช ุชฺฉูู ุขุฒููู ุฑุง ูุงุฑุฏ ููุงุฏ.</p>
                </div>

                {{-- Preview --}}
                <div class="preview-section">
                    <div class="preview-title">
                        <i class="fas fa-eye"></i>
                        ูพุดโููุงุด ุขุฒููู
                    </div>
                    <div class="preview-grid">
                        <div class="preview-item">
                            <div class="preview-label">ููุน ุขุฒููู</div>
                            <div class="preview-value" id="previewExamType">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ูพุงู ุชุญุตู</div>
                            <div class="preview-value" id="previewGrade">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุดุงุฎู ุชุญุตู</div>
                            <div class="preview-value" id="previewBranch">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุฒููู ูู</div>
                            <div class="preview-value" id="previewField">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุฒุฑุฑุดุชู</div>
                            <div class="preview-value" id="previewSubfield">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุฏุณุชู ุฏุฑุณ</div>
                            <div class="preview-value" id="previewSubjectType">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุชุนุฏุงุฏ ุฏุฑุณโูุง ุงูุชุฎุงุจ</div>
                            <div class="preview-value" id="previewSubjectsCount">--</div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">ุชุนุฏุงุฏ ุณูุงูุงุช ูพุดููุงุฏ</div>
                            <div class="preview-value" id="previewTotalQuestions">--</div>
                        </div>
                    </div>
                </div>

                {{-- Details Form --}}
                <div class="details-form">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-heading"></i>
                            ุนููุงู ุขุฒููู
                        </label>
                        <input type="text" name="title" class="form-input"
                               value="{{ old('title') }}"
                               placeholder="ูุซุงู: ุขุฒููู ูุตู ฑ ุดุจฺฉู"
                               required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-clock"></i>
                            ูุฏุช ุฒูุงู ุขุฒููู (ุฏููู)
                        </label>
                        <input type="number" name="duration" class="form-input"
                               value="{{ old('duration', 60) }}"
                               min="5" max="300" step="5" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-align-left"></i>
                            ุชูุถุญุงุช ุขุฒููู
                        </label>
                        <textarea name="description" class="form-textarea" rows="4"
                                  placeholder="ูุฏู ุขุฒูููุ ูฺฉุงุช ููู ู ...">{{ old('description') }}</textarea>
                    </div>

                    <div class="checkbox-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="is_active" id="activeCheck" value="1" checked>
                            <label class="form-check-label" for="activeCheck">ุขุฒููู ุจูุงูุงุตูู ูุนุงู ุดูุฏ</label>
                        </div>
                        <div class="form-text">
                            ุฏุฑ ุตูุฑุช ุนุฏู ุงูุชุฎุงุจุ ุขุฒููู ุจู ุตูุฑุช ูพุดโููุณ ุฐุฎุฑู ูโุดูุฏ.
                        </div>
                    </div>
                </div>
            </div>

{{-- ========== NAVIGATION BUTTONS ========== --}}
<div class="nav-buttons">
    <button type="button" class="btn-nav btn-prev" onclick="prevStep()">
        <i class="fas fa-arrow-right"></i>
        ูุฑุญูู ูุจู
    </button>

    <button type="button" class="btn-nav btn-next" onclick="nextStep()">
        ูุฑุญูู ุจุนุฏ
        <i class="fas fa-arrow-left"></i>
    </button>

    <button type="submit" class="btn-nav btn-submit">
        <i class="fas fa-check"></i>
        ุงุฌุงุฏ ุขุฒููู
    </button>
</div>

        </form>
    </div>
</div>
@endsection

@push('scripts')
<script src="{{ asset('assets/js/exam-wizard.js') }}"></script>
<script src="{{ asset('assets/js/classroom-modal.js') }}"></script>
@endpush


==================== FILE: resources/views/dashboard/teacher/exams/edit.blade.php ====================
{{-- resources/views/dashboard/teacher/exams/edit.blade.php --}}
@extends('layouts.app')
@section('title', 'ูุฑุงุด ุขุฒููู')

@push('styles')
    <style>
        .form-card {
            border: 0;
            border-radius: 1.25rem;
            background: #fff;
            box-shadow: 0 8px 24px rgba(18, 38, 63, .06)
        }

        .step-pill {
            border-radius: 999px;
            padding: .35rem .8rem;
            font-weight: 700;
            font-size: .85rem;
            background: #f8fafc;
            color: #334155;
            display: inline-flex;
            align-items: center;
            gap: .4rem
        }

        .step-pill .dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #16a34a;
            box-shadow: 0 0 0 4px rgba(22, 163, 74, .12)
        }

        .input-soft {
            border: 0;
            box-shadow: 0 6px 18px rgba(18, 38, 63, .06);
            border-radius: .9rem;
            padding: .7rem .9rem
        }

        .input-soft:focus {
            box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .15)
        }

        .hint {
            font-size: .85rem;
            color: #6c757d
        }

        .preview-card {
            border: 1px dashed #e2e8f0;
            border-radius: 1.25rem;
            background: linear-gradient(180deg, #fff, #f8fafc)
        }

        .preview-badge {
            background: rgba(16, 185, 129, .12);
            color: #059669;
            font-weight: 800
        }

        .btn-wizard {
            border-radius: 1rem;
            padding: .7rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: .5rem
        }

        .floating-help {
            position: sticky;
            top: 90px
        }

        .danger-zone {
            border: 1px solid rgba(220, 53, 69, .2);
            background: rgba(220, 53, 69, .04);
            border-radius: 1rem
        }
    </style>
@endpush

@section('content')
    <div class="container-fluid">

        {{-- Header --}}
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2 fade-up">
            <div>
                <h4 class="fw-bold mb-1"><i class="bi bi-pencil-square me-1 text-warning"></i> ูุฑุงุด ุขุฒููู</h4>
                <div class="text-muted small">
                    ุชุบุฑุงุช ุฑุง ุงุนูุงู ฺฉู ู ุฐุฎุฑู ุจุฒู. ูุถุนุช ุงูุชุดุงุฑ ู ุชุงุฑุฎ ุฑุง ูู ูโุชูุงู ุขูพุฏุช ฺฉู.
                </div>
            </div>
            <div class="d-flex gap-2">
                <a href="{{ route('teacher.exams.questions.index', $exam) }}"
                   class="btn btn-outline-primary d-inline-flex align-items-center gap-2 shadow-sm">
                    <i class="bi bi-question-circle"></i>
                    ูุฏุฑุช ุณูุงูโูุง
                </a>
                <a href="{{ route('teacher.exams.index') }}"
                   class="btn btn-outline-secondary d-inline-flex align-items-center gap-2 shadow-sm">
                    <i class="bi bi-arrow-right"></i>
                    ุจุงุฒฺฏุดุช
                </a>
            </div>
        </div>

        {{-- Validation errors --}}
        @if ($errors->any())
            <div class="alert alert-danger fade-up">
                <div class="fw-semibold mb-2">
                    <i class="bi bi-exclamation-triangle-fill me-1"></i>
                    ูุทูุงู ุฎุทุงูุง ุฒุฑ ุฑุง ุจุฑุฑุณ ฺฉู:
                </div>
                <ul class="mb-0">
                    @foreach ($errors->all() as $error)
                        <li>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        @if (session('success'))
            <div class="alert alert-success fade-up">
                <i class="bi bi-check-circle-fill me-1"></i>
                {{ session('success') }}
            </div>
        @endif

        <div class="row g-3">

            {{-- Form column --}}
            <div class="col-lg-8">
                <div class="form-card p-3 p-md-4 fade-up">

                    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
                        <div class="step-pill"><span class="dot"></span> ูุฑุงุด ุงุทูุงุนุงุช ุขุฒููู</div>
                        <div class="hint">* ููุฏูุง ุณุชุงุฑูโุฏุงุฑ ุถุฑูุฑโุงูุฏ.</div>
                    </div>

                    <form action="{{ route('teacher.exams.update', $exam) }}" method="POST" class="row g-3" novalidate>
                        @csrf
                        @method('PUT')

                        {{-- Title --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold">ุนููุงู ุขุฒููู <span class="text-danger">*</span></label>
                            <input type="text"
                                   name="title"
                                   class="form-control input-soft"
                                   placeholder="ูุซูุงู: ุขุฒููู ูุตู ฑ ุฑุงุถ"
                                   value="{{ old('title', $exam->title) }}"
                                   required>
                        </div>

                        {{-- Scope + Classroom --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold d-block">ููุน ุขุฒููู <span class="text-danger">*</span></label>

@php
    // 1) ุงฺฏุฑ ูุฑู ุจุง ุฎุทุง ุจุฑฺฏุดุชูุ ููุฏุงุฑ ููุงู old('scope')
    $scopeVal = old('scope');

    // 2) ุงฺฏุฑ ูููุฒ ููุฏุงุฑ ุชุนู ูุดุฏู:
    if (!$scopeVal) {
        if (!empty($exam->scope)) {
            // ุงฺฏุฑ ุชู DB scope ุฏุงุฑูุ ููุงู ุฑุง ุจฺฏุฑ
            $scopeVal = $exam->scope;
        } else {
            // ุงฺฏุฑ scope ุฎุงู ุงุณุชุ ุงุฒ ููุน ุขุฒููู ุญุฏุณ ุจุฒู
            // public = ุขุฒุงุฏ    |   ุจูู = ฺฉูุงุณ
            $scopeVal = $exam->exam_type === 'public' ? 'free' : 'classroom';
        }
    }
@endphp

                            <div class="form-check form-check-inline">
                                <input class="form-check-input"
                                       type="radio"
                                       name="scope"
                                       id="editScopeClassroom"
                                       value="classroom"
                                    {{ $scopeVal === 'classroom' ? 'checked' : '' }}>
                                <label class="form-check-label" for="editScopeClassroom">ฺฉูุงุณ</label>
                            </div>

                            <div class="form-check form-check-inline">
                                <input class="form-check-input"
                                       type="radio"
                                       name="scope"
                                       id="editScopeFree"
                                       value="free"
                                    {{ $scopeVal === 'free' ? 'checked' : '' }}>
                                <label class="form-check-label" for="editScopeFree">ุขุฒุงุฏ</label>
                            </div>

                            <div class="hint mt-1">ุงฺฏุฑ ุขุฒููู ุขุฒุงุฏ ุจุงุดุฏุ ุจู ูฺ ฺฉูุงุณ ูุตู ูุณุช.</div>
                        </div>

                        <div class="col-md-6" id="editClassroomBox">
                            <label class="form-label fw-semibold">ฺฉูุงุณ ูุฑุจูุทู <span class="text-danger">*</span></label>
                            <select name="classroom_id" class="form-select input-soft">
                                <option value="">ุงูุชุฎุงุจ ฺฉูุงุณ...</option>
                                @foreach ($classrooms as $c)
                                    <option value="{{ $c->id }}"
                                        {{ (string) old('classroom_id', $exam->classroom_id) === (string) $c->id ? 'selected' : '' }}>
                                        {{ $c->title ?? $c->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>

                        {{-- Subject & Level --}}
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">ุฏุฑุณ / ููุถูุน <span class="text-danger">*</span></label>
                            <select name="subject" class="form-select input-soft" required>
                                <option value="" disabled {{ old('subject', $exam->subject) ? '' : 'selected' }}>ุงูุชุฎุงุจ ุฏุฑุณ</option>
                                @foreach ($subjects ?? [] as $s)
                                    <option value="{{ $s }}"
                                        {{ old('subject', $exam->subject) === $s ? 'selected' : '' }}>
                                        {{ $s }}
                                    </option>
                                @endforeach
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-semibold">ุณุทุญ ุขุฒููู <span class="text-danger">*</span></label>
                            @php $lvl = old('level', $exam->level ?? 'taghviyati'); @endphp
                            <select name="level" class="form-select input-soft" required>
                                <option value="taghviyati" {{ $lvl === 'taghviyati' ? 'selected' : '' }}>ุชููุช</option>
                                <option value="konkur" {{ $lvl === 'konkur' ? 'selected' : '' }}>ฺฉูฺฉูุฑ</option>
                                <option value="olympiad" {{ $lvl === 'olympiad' ? 'selected' : '' }}>ุงูููพุงุฏ</option>
                            </select>
                        </div>

                        {{-- Duration & Start time --}}
                        <div class="col-md-4">
                            <label class="form-label fw-semibold">ูุฏุช ุขุฒููู (ุฏููู) <span class="text-danger">*</span></label>
                            <input type="number"
                                   min="1"
                                   name="duration"
                                   class="form-control input-soft"
                                   value="{{ old('duration', $exam->duration_minutes) }}"
                                   required>
                        </div>

                        <div class="col-md-8">
                            <label class="form-label fw-semibold">ุชุงุฑุฎ ู ุฒูุงู ุดุฑูุน</label>
                            <input type="datetime-local"
                                   name="start_at"
                                   class="form-control input-soft"
                                   value="{{ old('start_at', optional($exam->start_at)->format('Y-m-d\TH:i')) }}">
                            <div class="hint mt-1">ุชุงุฑุฎ/ุฒูุงู ุฑุง ุจุฑุง ููุงููฺฏ ุจุฑฺฏุฒุงุฑ ุชูุธู ฺฉู.</div>
                        </div>

                        {{-- Description --}}
                        <div class="col-12">
                            <label class="form-label fw-semibold">ุชูุถุญุงุช</label>
                            <textarea name="description"
                                      rows="4"
                                      class="form-control input-soft"
                                      placeholder="ุชูุถุญุงุช ฺฉูุชุงู ุฏุฑุจุงุฑู ูุฏู ุขุฒููู...">{{ old('description', $exam->description) }}</textarea>
                        </div>

                        {{-- Publish toggle --}}
                        <div class="col-12">
                            @php $pub = old('is_published', $exam->is_published); @endphp
                            <div class="form-check form-switch">
                                <input class="form-check-input"
                                       type="checkbox"
                                       role="switch"
                                       id="publishSwitch"
                                       name="is_published"
                                       value="1"
                                    {{ $pub ? 'checked' : '' }}>
                                <label class="form-check-label fw-semibold" for="publishSwitch">ุขุฒููู ููุชุดุฑ ุจุงุดุฏ</label>
                            </div>
                            <div class="hint mt-1">ุฏุฑ ุตูุฑุช ุงูุชุดุงุฑุ ุขุฒููู ุจุฑุง ุฏุงูุดโุขููุฒูุง ูุงุจู ูุดุงูุฏู ูโุดูุฏ.</div>
                        </div>

                        {{-- Actions --}}
                        <div class="col-12 d-flex flex-wrap gap-2 mt-2">
                            <button type="submit" class="btn btn-primary btn-wizard shadow-sm">
                                <i class="bi bi-save2"></i>
                                ุฐุฎุฑู ุชุบุฑุงุช
                            </button>
                            <a href="{{ route('teacher.exams.questions.index', $exam) }}"
                               class="btn btn-outline-primary btn-wizard shadow-sm">
                                <i class="bi bi-question-circle"></i>
                                ุฑูุชู ุจู ุณูุงูโูุง
                            </a>
                        </div>

                    </form>

                    {{-- Danger zone --}}
                    <div class="danger-zone p-3 mt-4">
                        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                            <div>
                                <div class="fw-bold text-danger">
                                    <i class="bi bi-trash3 me-1"></i> ุญุฐู ุขุฒููู
                                </div>
                                <div class="small text-muted">ุงู ุนููุงุช ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช.</div>
                            </div>
                            <form action="{{ route('teacher.exams.destroy', $exam) }}" method="POST">
                                @csrf
                                @method('DELETE')
                                <button class="btn btn-outline-danger btn-wizard"
                                        onclick="return confirm('ุขุง ุงุฒ ุญุฐู ุขุฒููู ูุทูุฆู ูุณุชุฏุ')">
                                    ุญุฐู ูุทุน
                                </button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>

            {{-- Preview / tips column --}}
            <div class="col-lg-4">
                <div class="floating-help fade-up">

                    <div class="preview-card p-3 mb-3">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="fw-bold">
                                <i class="bi bi-eye me-1"></i> ูพุดโููุงุด ุณุฑุน
                            </div>
                            <span class="badge preview-badge">Live</span>
                        </div>
                        <div class="small text-muted mb-2">ุจุง ุชุบุฑ ูุฑูุ ุงู ฺฉุงุฑุช ุขูพุฏุช ูโุดูุฏ.</div>

                        <div class="border rounded-3 p-3 bg-white" id="livePreview">
                            <div class="fw-semibold" id="pvTitle">{{ $exam->title }}</div>
                            <div class="text-muted small mt-1" id="pvMeta">
                                {{ $exam->level }} โข {{ $exam->subject }} โข {{ $exam->duration_minutes }} ุฏููู
                            </div>
                            <div class="text-muted small mt-2" id="pvStart">
                                ุดุฑูุน: {{ optional($exam->start_at)->format('Y/m/d H:i') }}
                            </div>
                            <div class="mt-2">
                                @if ($exam->is_published)
                                    <span class="badge bg-success">
                                        <i class="bi bi-broadcast-pin me-1"></i> ููุชุดุฑ ุดุฏู
                                    </span>
                                @else
                                    <span class="badge bg-secondary">
                                        <i class="bi bi-pencil-square me-1"></i> ูพุดโููุณ
                                    </span>
                                @endif
                            </div>
                        </div>
                    </div>

                    <div class="form-card p-3">
                        <div class="fw-bold mb-2">
                            <i class="bi bi-lightbulb me-1 text-warning"></i> ูพุดููุงุฏูุง ุจูุจูุฏ
                        </div>
                        <ul class="small text-muted mb-0 ps-3">
                            <li>ูุจู ุงุฒ ุงูุชุดุงุฑุ ุญุฏุงูู ต ุณุคุงู ุงุถุงูู ฺฉู.</li>
                            <li>ุงฺฏุฑ ุฒูุงู ุจุฑฺฏุฒุงุฑ ุชุบุฑ ฺฉุฑุฏุ ุงุทูุงุนู ุจูุฑุณุช.</li>
                            <li>ูโุชูุงู ุจุนุฏุงู ูุฏุช ู ุณุทุญ ุฑุง ุงุตูุงุญ ฺฉู.</li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </div>

    @push('scripts')
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const title = document.querySelector('input[name="title"]');
                const subject = document.querySelector('select[name="subject"]');
                const level = document.querySelector('select[name="level"]');
                const duration = document.querySelector('input[name="duration"]');
                const startAt = document.querySelector('input[name="start_at"]');

                const pvTitle = document.getElementById('pvTitle');
                const pvMeta = document.getElementById('pvMeta');
                const pvStart = document.getElementById('pvStart');

                function updatePreview() {
                    if (pvTitle) pvTitle.textContent = title?.value?.trim() || 'ุนููุงู ุขุฒููู';
                    const s = subject?.value || 'ุฏุฑุณ';
                    const l = level?.value || 'ุณุทุญ';
                    const d = duration?.value || 'โ';
                    if (pvMeta) pvMeta.textContent = `${l} โข ${s} โข ${d} ุฏููู`;
                    if (pvStart) pvStart.textContent = startAt?.value
                        ? `ุดุฑูุน: ${startAt.value.replace('T', ' ')}`
                        : 'ุฒูุงู ุดุฑูุน';
                }

                [title, subject, level, duration, startAt].forEach(el =>
                    el?.addEventListener('input', updatePreview)
                );
                updatePreview();
            });

            // toggle classroom box
            const editScopeFree = document.getElementById('editScopeFree');
            const editScopeClassroom = document.getElementById('editScopeClassroom');
            const editClassroomBox = document.getElementById('editClassroomBox');
            const editClassroomSelect = editClassroomBox?.querySelector('select[name="classroom_id"]');

            function toggleEditClassroom() {
                const isFree = editScopeFree?.checked;
                if (editClassroomBox) editClassroomBox.style.display = isFree ? 'none' : 'block';
                if (editClassroomSelect) editClassroomSelect.required = !isFree;
            }

            editScopeFree?.addEventListener('change', toggleEditClassroom);
            editScopeClassroom?.addEventListener('change', toggleEditClassroom);
            toggleEditClassroom();
        </script>
    @endpush
@endsection


==================== FILE: resources/views/dashboard/teacher/exams/index.blade.php ====================
@extends('layouts.app')
@section('title', 'ุขุฒูููโูุง')

@push('styles')
    <style>
        /* ุชู ฺฉุงูู SmartEdu */
        :root {
            --primary: #7B68EE;
            --primary-light: rgba(123, 104, 238, 0.1);
            --primary-gradient: linear-gradient(135deg, #7B68EE, #FF6B9D);
            --secondary: #FF6B9D;
            --secondary-light: rgba(255, 107, 157, 0.1);
            --accent: #00D4AA;
            --accent-light: rgba(0, 212, 170, 0.1);
            --gold: #FFD166;
            --light: #ffffff;
            --dark: #2D3047;
            --dark-light: #3A3F6D;
            --gray: #8A8D9B;
            --light-gray: #F8F9FF;
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 8px 20px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 12px 30px rgba(0, 0, 0, 0.16);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
            --gradient-1: linear-gradient(135deg, #7B68EE, #FF6B9D);
            --gradient-2: linear-gradient(135deg, #00D4AA, #4361EE);
            --gradient-3: linear-gradient(135deg, #FFD166, #FF9A3D);
            --gradient-4: linear-gradient(135deg, #7209B7, #3A0CA3);
            --radius-xl: 24px;
            --radius-lg: 20px;
            --radius-md: 16px;
            --radius-sm: 12px;
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
        }

        body {
            background-color: #f5f7ff;
            color: var(--dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .exams-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 15px 80px;
            animation: fadeIn 0.6s ease both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-30px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(30px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        /* ========== HEADER ========== */
        .page-header {
            background: var(--light);
            border-radius: var(--radius-xl);
            padding: 25px 30px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            border: 2px solid rgba(123, 104, 238, 0.08);
            position: relative;
            overflow: hidden;
            animation: slideInRight 0.5s ease-out;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.05), transparent);
            border-radius: 0 var(--radius-xl) 0 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .header-title h1 {
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title h1::before {
            content: '';
            width: 8px;
            height: 40px;
            background: var(--primary-gradient);
            border-radius: 10px;
        }

        .header-subtitle {
            color: var(--gray);
            font-size: 1.05rem;
            line-height: 1.8;
            max-width: 600px;
        }

        .btn-create-exam {
            padding: 15px 28px;
            border-radius: var(--radius-lg);
            font-weight: 800;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--gradient-1);
            color: white;
            border: none;
            box-shadow: 0 8px 20px rgba(123, 104, 238, 0.3);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn-create-exam:active {
            transform: scale(0.97);
        }

        .btn-create-exam:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(123, 104, 238, 0.4);
        }

        .btn-create-exam::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }

        .btn-create-exam:hover::before {
            left: 100%;
        }

        /* ========== FILTER SECTION ========== */
        .filter-section {
            background: var(--light);
            border-radius: var(--radius-xl);
            padding: 25px 30px;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
            border: 2px solid rgba(123, 104, 238, 0.08);
            animation: slideInLeft 0.5s ease-out;
        }

        .filter-title {
            font-weight: 900;
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-title i {
            color: var(--primary);
            background: var(--primary-light);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .filter-form {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-label {
            color: var(--gray);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: block;
        }

        .form-select-custom {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-md);
            background: var(--light);
            color: var(--dark);
            font-weight: 700;
            transition: all 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%237B68EE' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 18px center;
            background-size: 16px;
            padding-left: 45px;
        }

        .form-select-custom:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(123, 104, 238, 0.2);
        }

        .btn-filter {
            padding: 14px 28px;
            border-radius: var(--radius-md);
            font-weight: 800;
            font-size: 1rem;
            background: transparent;
            color: var(--dark);
            border: 2px solid var(--gray);
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-filter:hover {
            background: var(--light-gray);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        /* ========== EXAMS TABLE ========== */
        .exams-table-container {
            background: var(--light);
            border-radius: var(--radius-xl);
            padding: 0;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(123, 104, 238, 0.08);
            overflow: hidden;
            animation: fadeIn 0.6s ease-out;
            animation-delay: 0.1s;
            animation-fill-mode: both;
        }

        .table-header {
            padding: 25px 30px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-weight: 900;
            font-size: 1.3rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
        }

        .table-title i {
            color: var(--primary);
            background: var(--primary-light);
            width: 45px;
            height: 45px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .exams-count {
            background: var(--primary-light);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .exams-table {
            width: 100%;
            border-collapse: collapse;
        }

        .exams-table thead {
            background: linear-gradient(90deg, rgba(123, 104, 238, 0.05), rgba(255, 107, 157, 0.05));
        }

        .exams-table th {
            padding: 20px 25px;
            text-align: right;
            font-weight: 900;
            color: var(--dark);
            font-size: 0.95rem;
            border-bottom: 2px solid var(--light-gray);
            white-space: nowrap;
        }

        .exams-table tbody tr {
            transition: all 0.3s;
            border-bottom: 1px solid var(--light-gray);
        }

        .exams-table tbody tr:last-child {
            border-bottom: none;
        }

        .exams-table tbody tr:hover {
            background: var(--primary-light);
            transform: translateX(-5px);
        }

        .exams-table td {
            padding: 20px 25px;
            vertical-align: middle;
            font-weight: 700;
            color: var(--dark);
        }

        .exam-title-cell {
            font-weight: 900 !important;
            font-size: 1.05rem;
        }

        .exam-classroom {
            color: var(--gray);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .exam-duration {
            color: var(--dark);
            font-weight: 900;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .exam-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 900;
            white-space: nowrap;
        }

        .status-active {
            background: rgba(0, 212, 170, 0.15);
            color: #00D4AA;
        }

        .status-inactive {
            background: rgba(138, 141, 155, 0.15);
            color: var(--gray);
        }

        .exam-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-action {
            padding: 10px 18px;
            border-radius: var(--radius-md);
            font-weight: 800;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            transition: all 0.3s;
            border: 2px solid transparent;
            min-width: 90px;
            justify-content: center;
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        .btn-details {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-details:hover {
            background: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        .btn-edit {
            background: transparent;
            color: var(--dark);
            border: 2px solid var(--gray);
        }

        .btn-edit:hover {
            background: var(--light-gray);
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            padding: 60px 30px;
            text-align: center;
            animation: fadeIn 0.6s ease-out;
        }

        .empty-icon {
            font-size: 5rem;
            color: var(--light-gray);
            margin-bottom: 25px;
            opacity: 0.7;
        }

        .empty-title {
            font-weight: 900;
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .empty-description {
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.7;
            max-width: 500px;
            margin: 0 auto 30px;
        }

        /* ========== ALERTS ========== */
        .alert-success-custom {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(0, 212, 170, 0.05));
            border: 2px solid rgba(0, 212, 170, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px 25px;
            color: var(--dark);
            font-weight: 700;
            margin-bottom: 30px;
            animation: slideInRight 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .alert-success-custom::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.08), transparent);
            border-radius: 0 var(--radius-lg) 0 0;
        }

        .alert-success-custom i {
            color: #00D4AA;
            font-size: 1.3rem;
            margin-left: 10px;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 992px) {
            .exams-table {
                display: block;
                overflow-x: auto;
            }

            .exams-table thead {
                display: none;
            }

            .exams-table tbody tr {
                display: block;
                margin-bottom: 20px;
                border: 2px solid var(--light-gray);
                border-radius: var(--radius-lg);
                padding: 20px;
            }

            .exams-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px dashed var(--light-gray);
            }

            .exams-table td:last-child {
                border-bottom: none;
                padding-top: 20px;
                justify-content: flex-end;
            }

            .exams-table td::before {
                content: attr(data-label);
                font-weight: 900;
                color: var(--gray);
                font-size: 0.9rem;
                min-width: 100px;
                text-align: left;
            }

            .exam-actions {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .exams-container {
                padding: 15px 10px 60px;
            }

            .page-header {
                padding: 20px;
            }

            .header-title h1 {
                font-size: 1.5rem;
            }

            .btn-create-exam {
                width: 100%;
                justify-content: center;
            }

            .filter-section {
                padding: 20px;
            }

            .table-header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .empty-state {
                padding: 40px 20px;
            }

            .empty-icon {
                font-size: 4rem;
            }
        }

        @media (max-width: 480px) {
            .btn-action {
                min-width: auto;
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .exam-status {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }

        /* ุฏฺฉููโูุง ููุณ ุจุฒุฑฺฏ */
        .btn-create-exam,
        .btn-filter,
        .btn-action {
            min-height: 44px;
        }

        /* ุงูุชุฎุงุจ ูุชู */
        ::selection {
            background: rgba(123, 104, 238, 0.2);
            color: var(--dark);
        }
    </style>
@endpush

@section('content')
    <div class="exams-container">
        {{-- ========== PAGE HEADER ========== --}}
        <div class="page-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>
                        <span
                            style="background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            ุขุฒูููโูุง ูู
                        </span>
                        ๐
                    </h1>
                    <p class="header-subtitle">
                        ููู ุขุฒูููโูุง ฺฉูุงุณโูุง ุดูุง ุฏุฑ ฺฉ ูฺฏุงู.
                        ูโุชูุงูุฏ ุขุฒูููโูุง ุฑุง ูุฏุฑุชุ ูุฑุงุด ู ูุชุงุฌ ุฑุง ูุดุงูุฏู ฺฉูุฏ.
                    </p>
                </div>

                <a href="{{ route('teacher.exams.create') }}" class="btn-create-exam">
                    <i class="fas fa-plus-circle"></i>
                    ุณุงุฎุช ุขุฒููู ุฌุฏุฏ
                </a>
            </div>
        </div>

        {{-- ========== SUCCESS ALERT ========== --}}
        @if (session('success'))
            <div class="alert-success-custom d-flex align-items-center">
                <i class="fas fa-check-circle"></i>
                <div class="flex-grow-1">{{ session('success') }}</div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        @endif

        {{-- ========== FILTER SECTION ========== --}}
        <div class="filter-section">
            <h3 class="filter-title">
                <i class="fas fa-filter"></i>
                ููุชุฑ ู ุฌุณุชุฌู ูพุดุฑูุชู
            </h3>

            <form method="GET" class="filter-form">
                <div class="form-group">
                    <label class="form-label">ููุชุฑ ุจุฑ ุงุณุงุณ ฺฉูุงุณ</label>
                    <select name="classroom_id" class="form-select-custom">
                        <option value="">ููู ฺฉูุงุณโูุง</option>
@foreach (($classrooms ?? []) as $c)
                            <option value="{{ $c->id }}" @selected(request('classroom_id') == $c->id)>
                                {{ $c->title ?? $c->name }}
                            </option>
                        @endforeach
                    </select>
                </div>

                <button type="submit" class="btn-filter">
                    <i class="fas fa-sliders-h"></i>
                    ุงุนูุงู ููุชุฑ
                </button>
            </form>
        </div>

        {{-- ========== EXAMS TABLE ========== --}}
        @if ($exams->count() === 0)
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h3 class="empty-title">ูููุฒ ุขุฒููู ูุณุงุฎุชูโุงุฏ!</h3>
                <p class="empty-description">
                    ุจุฑุง ุดุฑูุนุ ุงููู ุขุฒููู ุฎูุฏ ุฑุง ุงุฌุงุฏ ฺฉูุฏ.
                    ูโุชูุงูุฏ ุงููุงุน ูุฎุชูู ุงุฒ ุขุฒูููโูุง ุดุงูู ุชุณุชุ ุชุดุฑุญ ู ุชุฑฺฉุจ ุจุณุงุฒุฏ.
                </p>
                <a href="{{ route('teacher.exams.create') }}" class="btn-create-exam">
                    <i class="fas fa-plus-circle"></i>
                    ุงุฌุงุฏ ุงููู ุขุฒููู
                </a>
            </div>
        @else
            <div class="exams-table-container">
                <div class="table-header">
                    <h3 class="table-title">
                        <i class="fas fa-list-check"></i>
                        ูุณุช ุขุฒูููโูุง
                    </h3>
                    <div class="exams-count">
                        <i class="fas fa-hashtag"></i>
                        {{ $exams->count() }} ุขุฒููู
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="exams-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ุนููุงู ุขุฒููู</th>
                                <th>ฺฉูุงุณ</th>
                                <th>ูุฏุช ุฒูุงู</th>
                                <th>ูุถุนุช</th>
                                <th>ุนููุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($exams as $exam)
                                <tr>
                                    <td data-label="ุดูุงุฑู">
                                        <span style="color: var(--primary); font-weight: 900; font-size: 1.1rem;">
                                            {{ $loop->iteration }}
                                        </span>
                                    </td>
                                    <td data-label="ุนููุงู ุขุฒููู" class="exam-title-cell">
                                        {{ $exam->title }}
                                    </td>
                                    <td data-label="ฺฉูุงุณ">
                                        <div class="exam-classroom">
                                            <i class="fas fa-people-group"></i>
                                            {{ $exam->classroom->title ?? ($exam->classroom->name ?? 'โ') }}
                                        </div>
                                    </td>
                                    <td data-label="ูุฏุช ุฒูุงู">
                                        <div class="exam-duration">
                                            <i class="fas fa-clock"></i>
                                            {{ $exam->duration ?? ($exam->duration_minutes ?? 'โ') }} ุฏููู
                                        </div>
                                    </td>
                                    <td data-label="ูุถุนุช">
                                        @if ($exam->is_active)
                                            <span class="exam-status status-active">
                                                <i class="fas fa-check-circle"></i>
                                                ูุนุงู
                                            </span>
                                        @else
                                            <span class="exam-status status-inactive">
                                                <i class="fas fa-pause-circle"></i>
                                                ุบุฑูุนุงู
                                            </span>
                                        @endif
                                    </td>
                                    <td data-label="ุนููุงุช">
                                        <div class="exam-actions">
                                            <a href="{{ route('teacher.exams.show', $exam) }}"
                                                class="btn-action btn-details">
                                                <i class="fas fa-eye"></i>
                                                ุฌุฒุฆุงุช
                                            </a>
                                            <a href="{{ route('teacher.exams.edit', $exam) }}" class="btn-action btn-edit">
                                                <i class="fas fa-edit"></i>
                                                ูุฑุงุด
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        @endif
    </div>
@endsection

@push('scripts')
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ูุจุฑู ุจุฑุง ููุจุงู
            if (navigator.vibrate) {
                const clickableItems = document.querySelectorAll(
                    '.btn-create-exam, .btn-filter, .btn-action, .exams-table tbody tr');
                clickableItems.forEach(item => {
                    item.addEventListener('click', function() {
                        navigator.vibrate(20);
                    });
                });
            }

            // ุงูฺฉุช hover ุจุฑุง ุณุทุฑูุง ุฌุฏูู
            const tableRows = document.querySelectorAll('.exams-table tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                });

                // ฺฉูฺฉ ุฑู ุณุทุฑ ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุช
                const detailsBtn = row.querySelector('.btn-details');
                if (detailsBtn) {
                    row.addEventListener('click', function(e) {
                        if (!e.target.closest('.btn-action')) {
                            window.location.href = detailsBtn.href;
                        }
                    });
                }
            });

            // ุงููุดู ูุฑูุฏ ุงููุงูโูุง
            const animateElements = () => {
                const elements = document.querySelectorAll('.exams-table tbody tr');
                elements.forEach((el, i) => {
                    el.style.animationDelay = `${i * 0.05}s`;
                    el.style.animation = 'fadeIn 0.5s ease-out forwards';
                    el.style.opacity = '0';
                });
            };

            // ุงุฌุฑุง ุงููุดู ุจุนุฏ ุงุฒ ููุฏ ุตูุญู
            setTimeout(animateElements, 300);

            // ุงุนุชุจุงุฑุณูุฌ ููุชุฑ
            const filterForm = document.querySelector('.filter-form');
            if (filterForm) {
                filterForm.addEventListener('submit', function(e) {
                    const select = this.querySelector('select[name="classroom_id"]');
                    if (select.value) {
                        // ููุงุด ุจุงุฑฺฏุฑ
                        const submitBtn = this.querySelector('button[type="submit"]');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML =
                            '<i class="fas fa-spinner fa-spin"></i> ุฏุฑ ุญุงู ุงุนูุงู ููุชุฑ...';
                        submitBtn.disabled = true;

                        setTimeout(() => {
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        }, 1000);
                    }
                });
            }

            // ููุงุด ุชุนุฏุงุฏ ฺฉูุงุณโูุง ููุชุฑ ุดุฏู
            const updateFilterCount = () => {
                const selectedClass = document.querySelector('select[name="classroom_id"]').value;
                const examCount = document.querySelectorAll('.exams-table tbody tr').length;
                const countElement = document.querySelector('.exams-count');

                if (countElement && selectedClass) {
                    const className = document.querySelector(`option[value="${selectedClass}"]`).textContent;
                    countElement.innerHTML = `<i class="fas fa-filter"></i> ${examCount} ุขุฒููู (${className})`;
                }
            };

            // ุฑูุฏุงุฏ ุชุบุฑ ููุชุฑ
            const classSelect = document.querySelector('select[name="classroom_id"]');
            if (classSelect) {
                classSelect.addEventListener('change', updateFilterCount);
            }
        });

        // ุงุถุงูู ฺฉุฑุฏู ุงุณุชุงูโูุง ุงููุดู
        const style = document.createElement('style');
        style.textContent = `
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
`;
        document.head.appendChild(style);
    </script>
@endpush


==================== FILE: resources/views/dashboard/teacher/exams/show.blade.php ====================
@extends('layouts.app')
@section('title', 'ุฌุฒุฆุงุช ุขุฒููู')

@push('styles')
    <style>
        .card-soft {
            border: 0;
            border-radius: 1.25rem;
            box-shadow: 0 8px 24px rgba(18, 38, 63, .06);
            background: #fff;
        }

        .chip {
            background: #eef2ff;
            padding: .25rem .6rem;
            border-radius: 999px;
            font-weight: 700;
        }

        .tiny {
            font-size: .85rem;
        }

        .muted {
            color: #6b7280;
        }

        .hero {
            position: relative;
            overflow: hidden;
            border-radius: 1.5rem;
            background: linear-gradient(135deg, #0d6efd10, #20c99710);
            border: 1px dashed #e5e7eb;
        }

        .hero-orb {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            right: -70px;
            top: -70px;
            background: radial-gradient(circle, #0d6efd22, transparent 60%);
        }

        .hero-orb2 {
            position: absolute;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            left: -50px;
            bottom: -50px;
            background: radial-gradient(circle, #20c99722, transparent 60%);
        }

        .q-row:hover {
            background: #f9fafb;
        }
    </style>
@endpush

@section('content')
    <div class="container py-4">

        {{-- Hero --}}
        <div class="hero card-soft p-3 p-md-4 mb-4">
            <div class="hero-orb"></div>
            <div class="hero-orb2"></div>

            <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
                <div>
                    <h4 class="fw-bold mb-1">
                        <i class="bi bi-clipboard-check me-1 text-primary"></i>
                        {{ $exam->title }}
                    </h4>

                    <div class="text-muted small">
                        ฺฉูุงุณ:
                        @if ($exam->classroom)
                            <span class="chip">{{ $exam->classroom->title ?? $exam->classroom->name }}</span>
                        @else
                            <span class="text-warning">ูุงูุดุฎุต</span>
                        @endif

                        <span class="mx-1">โข</span>

                        ูุฏุช: {{ $exam->duration_minutes ?? ($exam->duration ?? 'โ') }} ุฏููู

                        <span class="mx-1">โข</span>

                        ูุถุนุช:
                        @if ($exam->is_published)
                            <span class="badge bg-success">ููุชุดุฑ ุดุฏู</span>
                        @else
                            <span class="badge bg-secondary">ูพุดโููุณ</span>
                        @endif
                    </div>

                    @if (!empty($exam->description))
                        <div class="tiny muted mt-2">
                            {{ $exam->description }}
                        </div>
                    @endif
                </div>

                <div class="d-flex gap-2 flex-wrap">
                    <a href="{{ route('teacher.exams.edit', $exam) }}"
                        class="btn btn-outline-warning d-inline-flex align-items-center gap-2 shadow-sm">
                        <i class="bi bi-pencil-square"></i>
                        ูุฑุงุด ุขุฒููู
                    </a>

                    <a href="{{ route('teacher.exams.questions.index', $exam) }}"
                        class="btn btn-primary d-inline-flex align-items-center gap-2 shadow-sm">
                        <i class="bi bi-question-circle"></i>
                        ูุฏุฑุช ุณูุงูโูุง
                    </a>

                    <a href="{{ route('teacher.exams.index') }}"
                        class="btn btn-outline-secondary d-inline-flex align-items-center gap-2 shadow-sm">
                        <i class="bi bi-arrow-right"></i>
                        ุจุงุฒฺฏุดุช
                    </a>
                </div>
            </div>
        </div>

        @if (session('success'))
            <div class="alert alert-success">{{ session('success') }}</div>
        @endif

        @php
            $questions = $exam->questions ?? collect();
            $totalScore = $questions->sum('score');
        @endphp

        {{-- Summary --}}
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="card card-soft">
                    <div class="card-body">
                        <div class="text-muted small">ุชุนุฏุงุฏ ุณูุงูโูุง</div>
                        <div class="fs-4 fw-bold">{{ $questions->count() }}</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-soft">
                    <div class="card-body">
                        <div class="text-muted small">ูุฌููุน ุงูุชุงุฒ</div>
                        <div class="fs-4 fw-bold">{{ $totalScore }}</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-soft">
                    <div class="card-body">
                        <div class="text-muted small">ุดูุงุณู ุขุฒููู</div>
                        <div class="fs-5 fw-bold">#{{ $exam->id }}</div>
                    </div>
                </div>
            </div>
        </div>

        {{-- Questions Preview --}}
        <div class="card card-soft">
            <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                <span>
                    <i class="bi bi-list-check me-1 text-primary"></i>
                    ุณูุงูโูุง ุขุฒููู
                </span>

                <a href="{{ route('teacher.exams.questions.create', $exam) }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-plus"></i> ุงูุฒูุฏู ุณูุงู
                </a>
            </div>

            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>ูุชู ุณูุงู</th>
                            <th>ููุน</th>
                            <th>ุงูุชุงุฒ</th>
                            <th>ูพุงุณุฎ ุตุญุญ</th>
                        </tr>
                    </thead>
                    <tbody>
                        @forelse($questions as $q)
                            @php
                                $type = $q->question_type;
                                $correct = null;

                                if ($type === 'mcq') {
                                    $correct = is_array($q->correct_answer)
                                        ? strtoupper($q->correct_answer['correct_option'] ?? '')
                                        : 'โ';
                                } elseif ($type === 'true_false') {
                                    $val = is_array($q->correct_answer)
                                        ? ($q->correct_answer['value'] ?? null)
                                        : null;
                                    $correct = ($val === true || $val === 1 || $val === '1') ? 'True' : 'False';
                                } elseif ($type === 'fill_blank') {
                                    $correct = is_array($q->correct_answer)
                                        ? implode(' , ', $q->correct_answer)
                                        : ($q->correct_answer ?? 'โ');
                                } else {
                                    $correct = 'โ (ุชุดุฑุญ)';
                                }
                            @endphp

                            <tr class="q-row">
                                <td class="fw-semibold">{{ $loop->iteration }}</td>
                                <td style="max-width:520px">
                                    {{ \Illuminate\Support\Str::limit($q->content, 140) }}
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark border rounded-pill">
                                        {{ str_replace('_', ' ', $q->question_type) }}
                                    </span>
                                </td>
                                <td class="fw-bold">{{ $q->score }}</td>
                                <td class="tiny muted">{{ $correct }}</td>
                            </tr>
                        @empty
                            <tr>
                                <td colspan="5" class="text-center text-muted py-5">
                                    ูููุฒ ูฺ ุณูุงู ุจุฑุง ุงู ุขุฒููู ุซุจุช ูุดุฏู ุงุณุช.
                                    <div class="mt-3">
                                        <a href="{{ route('teacher.exams.questions.create', $exam) }}"
                                            class="btn btn-primary">
                                            <i class="bi bi-plus-circle"></i>
                                            ุงููู ุณูุงู ุฑุง ุจุณุงุฒ
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        @endforelse
                    </tbody>
                </table>
            </div>
        </div>

    </div>
@endsection


==================== FILE: resources/views/dashboard/teacher/exams/questions/index.blade.php ====================
@extends('layouts.app')
@section('title', 'ุณูุงูโูุง ุขุฒููู')

@push('styles')
<style>
    .q-card {
        border-radius: 1.25rem;
        background: #fff;
        box-shadow: 0 8px 24px rgba(18,38,63,.06);
        border: 0;
    }
    .q-header-pill {
        border-radius: 999px;
        padding: .35rem .8rem;
        font-weight: 700;
        font-size: .85rem;
        background: #f1f5f9;
        color: #334155;
        display: inline-flex;
        align-items: center;
        gap: .4rem;
    }
    .q-header-pill .dot {
        width: 9px; height: 9px; border-radius: 50%;
        background: #0d6efd;
        box-shadow: 0 0 0 4px rgba(13,110,253,.15);
    }
    .badge-type {
        border-radius: 999px;
        font-size: .75rem;
        font-weight: 800;
    }
    .badge-type-mcq    { background:#eff6ff; color:#1d4ed8; }
    .badge-type-tf     { background:#ecfdf3; color:#16a34a; }
    .badge-type-fill   { background:#fefce8; color:#ca8a04; }
    .badge-type-essay  { background:#f5f3ff; color:#6d28d9; }
    .btn-q {
        border-radius: .9rem;
        padding: .45rem .9rem;
        font-size: .85rem;
        display:inline-flex;
        align-items:center;
        gap:.35rem;
    }
</style>
@endpush

@section('content')
<div class="container-fluid">

    {{-- Header --}}
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
        <div>
            <div class="q-header-pill mb-2">
                <span class="dot"></span>
                ูุฏุฑุช ุณูุงูโูุง
            </div>
            <h4 class="fw-bold mb-1">
                ุณูุงูโูุง ุขุฒููู: {{ $exam->title ?? 'ุจุฏูู ุนููุงู' }}
            </h4>
            <div class="text-muted small">
                ุณุงุฎุชุงุฑ ุณูุงูโูุง ุจุฑ ุงุณุงุณ JSON (options &amp; correct_answer) ุงุณุช.
            </div>
        </div>

        <div class="d-flex gap-2">
            <a href="{{ route('teacher.exams.edit', $exam) }}"
               class="btn btn-outline-secondary btn-q shadow-sm">
                <i class="bi bi-arrow-right"></i>
                ูุฑุงุด ุขุฒููู
            </a>
            <a href="{{ route('teacher.exams.questions.create', $exam) }}"
               class="btn btn-primary btn-q shadow-sm">
                <i class="bi bi-plus-circle"></i>
                ุณูุงู ุฌุฏุฏ
            </a>
        </div>
    </div>

    {{-- Alert --}}
    @if(session('success'))
        <div class="alert alert-success">
            <i class="bi bi-check-circle-fill me-1"></i>
            {{ session('success') }}
        </div>
    @endif

    <div class="q-card p-3 p-md-4">
        @if($questions->isEmpty())
            <div class="text-center py-4">
                <div class="fs-1 text-muted mb-2">
                    <i class="bi bi-question-circle"></i>
                </div>
                <h5 class="fw-bold mb-2">ูููุฒ ุณูุงู ุซุจุช ูุดุฏู ุงุณุช</h5>
                <p class="text-muted small mb-3">
                    ุงููู ุณูุงู ุฑุง ุงุถุงูู ฺฉู ุชุง ุขุฒููู ุขูุงุฏูโ ุงุณุชูุงุฏู ุดูุฏ.
                </p>
                <a href="{{ route('teacher.exams.questions.create', $exam) }}"
                   class="btn btn-primary btn-q">
                    <i class="bi bi-plus-circle"></i>
                    ุงูุฒูุฏู ุงููู ุณูุงู
                </a>
            </div>
        @else
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>ูุชู ุณูุงู</th>
                            <th>ููุน</th>
                            <th>ูพุงุณุฎ / ฺฏุฒููโูุง</th>
                            <th>ูุถุนุช</th>
                            <th class="text-end">ุนููุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($questions as $q)
                            @php
                                $opts = $q->options ?? [];
                                $ca   = $q->correct_answer ?? [];
                            @endphp
                            <tr>
                                <td>{{ $loop->iteration }}</td>

                                {{-- ูุชู ุณูุงู --}}
                                <td style="max-width: 320px;">
                                    <div class="fw-semibold">
                                        {{ \Illuminate\Support\Str::limit($q->content, 90) }}
                                    </div>
                                </td>

                                {{-- ููุน ุณูุงู --}}
                                <td>
                                    @switch($q->question_type)
                                        @case('mcq')
                                            <span class="badge badge-type badge-type-mcq">ุชุณุช</span>
                                            @break
                                        @case('true_false')
                                            <span class="badge badge-type badge-type-tf">ุฏุฑุณุช / ูุงุฏุฑุณุช</span>
                                            @break
                                        @case('fill_blank')
                                            <span class="badge badge-type badge-type-fill">ุฌุง ุฎุงู</span>
                                            @break
                                        @case('essay')
                                            <span class="badge badge-type badge-type-essay">ุชุดุฑุญ</span>
                                            @break
                                        @default
                                            <span class="badge bg-secondary">ูุงูุดุฎุต</span>
                                    @endswitch
                                </td>

                                {{-- ูพุงุณุฎ / ฺฏุฒููโูุง --}}
                                <td>
                                    @if($q->question_type === 'mcq')
                                        @php $correctKey = $ca['correct_option'] ?? null; @endphp
                                        @foreach($opts as $key => $val)
                                            <div class="small">
                                                <strong>{{ strtoupper($key) }}.</strong>
                                                {{ $val }}
                                                @if($correctKey === $key)
                                                    <span class="badge bg-success-subtle text-success ms-1">
                                                        ุตุญุญ
                                                    </span>
                                                @endif
                                            </div>
                                        @endforeach

                                    @elseif($q->question_type === 'true_false')
                                        @php $val = $ca['value'] ?? null; @endphp
                                        <span class="badge bg-info-subtle text-info">
                                            ุฌูุงุจ ุตุญุญ: {{ $val ? 'ุฏุฑุณุช' : 'ูุงุฏุฑุณุช' }}
                                        </span>

                                    @elseif($q->question_type === 'fill_blank')
                                        @php $vals = $ca['values'] ?? []; @endphp
                                        <div class="small">
                                            ุฌูุงุจโูุง:
                                            <span class="fw-semibold">
                                                {{ implode(' ุ ', $vals) }}
                                            </span>
                                        </div>

                                    @else
                                        <span class="text-muted small">ุณูุงู ุชุดุฑุญ (ุจุฏูู ฺฏุฒูู)</span>
                                    @endif
                                </td>

                                {{-- ูุถุนุช --}}
                                <td>
                                    @if($q->is_active)
                                        <span class="badge bg-success-subtle text-success">
                                            <i class="bi bi-check-circle me-1"></i> ูุนุงู
                                        </span>
                                    @else
                                        <span class="badge bg-secondary-subtle text-secondary">
                                            <i class="bi bi-slash-circle me-1"></i> ุบุฑูุนุงู
                                        </span>
                                    @endif
                                </td>

                                {{-- ุนููุงุช --}}
                                <td class="text-end">
                                    <div class="d-inline-flex gap-1">
                                        <a href="{{ route('teacher.exams.questions.edit', [$exam, $q]) }}"
                                           class="btn btn-outline-primary btn-q btn-sm">
                                            <i class="bi bi-pencil-square"></i>
                                            ูุฑุงุด
                                        </a>
                                        <form action="{{ route('teacher.exams.questions.destroy', [$exam, $q]) }}"
                                              method="POST"
                                              onsubmit="return confirm('ุณูุงู ุญุฐู ุดูุฏุ');">
                                            @csrf
                                            @method('DELETE')
                                            <button class="btn btn-outline-danger btn-q btn-sm">
                                                <i class="bi bi-trash"></i>
                                                ุญุฐู
                                            </button>
                                        </form>
                                    </div>
                                </td>

                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        @endif
    </div>

</div>
@endsection


==================== FILE: app/Models/Question.php ====================
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Support\Str;

class Question extends Model
{
    use HasFactory;

    protected $table = 'questions';

    // โ ฺูู id ุฏุฑ ุฏุชุงุจุณ auto increment ุงุณุชุ ุงู ุฏู ุฎุท ุจุงุฏ ุญุฐู ุดููุฏ
    // public $incrementing = false;
    // protected $keyType = 'string';

    protected $fillable = [
        'uuid',
        'exam_id',

        'user_id',
        'creator_id',

        'section_id',
        'grade_id',
        'branch_id',
        'field_id',
        'subfield_id',
        'subject_id',
        'topic_id',

        'difficulty',
        'score',

        'question_type',
        'content',

        'options',
        'correct_answer',

        'explanation',

        'ai_generated_by_session_id',
        'ai_confidence',

        'is_active',
    ];

    protected $casts = [
        'options'        => 'array',
        'correct_answer' => 'array',
        'ai_confidence'  => 'float',
        'is_active'      => 'boolean',
    ];

    protected static function booted()
    {
        static::creating(function ($q) {

            // ฺูู id ุงฺฉููู auto increment ุงุณุช โ ูุจุงุฏ UUID ุจุฏูู

            // uuid (ุณุชูู NOT NULL)
            if (empty($q->uuid)) {
                $q->uuid = (string) Str::uuid();
            }

            // user_id
            if (empty($q->user_id) && auth()->check()) {
                $q->user_id = auth()->id();
            }

            // creator_id
            if (empty($q->creator_id) && auth()->check()) {
                $q->creator_id = auth()->id();
            }

            // active
            if ($q->is_active === null) {
                $q->is_active = true;
            }
        });
    }

    public function exam(): BelongsTo
    {
        return $this->belongsTo(Exam::class, 'exam_id');
    }
}


==================== FILE: app/Models/Exam.php ====================
<?php
// app/Models/Exam.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Support\Str;

class Exam extends Model
{
    use HasFactory;

    protected $table = 'exams';

    // id ุงูฺฉุฑููุช ุงุณุช (INT) โ ุชูุธู ูพุดโูุฑุถ ูุงุฑุงูู ฺฉุงู ุงุณุช

    protected $fillable = [
        'user_id',
        'teacher_id',
        'classroom_id',

        'exam_type',

        // ุจุฑุง ูุฑู ุณุงุฏู ูุฑุงุด
        'scope',       // classroom / free
        'subject',     // ุจุฑฺุณุจ ููุงุด ุฏุฑุณ (ูุซูุงู ุนููุงู ูุงุฑุณ)
        'level',       // taghviyati / konkur / olympiad

        'title',
        'description',
        'duration_minutes',

        'section_id',
        'grade_id',
        'branch_id',
        'field_id',
        'subfield_id',
        'subject_type_id',

        'total_questions',
        'coefficients',

        'start_at',
        'end_at',

        'shuffle_questions',
        'shuffle_options',
        'ai_assisted',
        'ai_session_id',

        'is_active',
        'is_published',

        'uuid',
    ];

    protected $casts = [
        'duration_minutes'  => 'integer',
        'total_questions'   => 'integer',

        'coefficients'      => 'array',

        'shuffle_questions' => 'boolean',
        'shuffle_options'   => 'boolean',
        'ai_assisted'       => 'boolean',

        'is_active'         => 'boolean',
        'is_published'      => 'boolean',

        'start_at'          => 'datetime',
        'end_at'            => 'datetime',
        'created_at'        => 'datetime',
        'updated_at'        => 'datetime',
    ];

    // ================== ุฑูุงุจุท ==================

    public function teacher(): BelongsTo
    {
        return $this->belongsTo(User::class, 'teacher_id');
    }

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class, 'user_id');
    }

    public function classroom(): BelongsTo
    {
        return $this->belongsTo(Classroom::class, 'classroom_id');
    }

    public function questions(): BelongsToMany
    {
        return $this->belongsToMany(
            Question::class,
            'exam_questions',
            'exam_id',
            'question_id'
        )->withPivot('sort_order');
    }

    public function attempts(): HasMany
    {
        return $this->hasMany(ExamAttempt::class, 'exam_id');
    }

    public function subjects(): BelongsToMany
    {
        return $this->belongsToMany(
            Subject::class,
            'exam_subject',
            'exam_id',
            'subject_id'
        )->withPivot('question_count');
    }

    public function section(): BelongsTo
    {
        return $this->belongsTo(Section::class, 'section_id');
    }

    public function grade(): BelongsTo
    {
        return $this->belongsTo(Grade::class, 'grade_id');
    }

    public function branch(): BelongsTo
    {
        return $this->belongsTo(Branch::class, 'branch_id');
    }

    public function field(): BelongsTo
    {
        return $this->belongsTo(Field::class, 'field_id');
    }

    public function subfield(): BelongsTo
    {
        return $this->belongsTo(Subfield::class, 'subfield_id');
    }

    public function subjectType(): BelongsTo
    {
        return $this->belongsTo(SubjectType::class, 'subject_type_id');
    }

    public function aiSession(): BelongsTo
    {
        return $this->belongsTo(AiSession::class, 'ai_session_id');
    }

    public function getRouteKeyName()
    {
        return 'id';
    }

    // ================== UUID ==================

    protected static function booted()
    {
        static::creating(function ($exam) {
            if (empty($exam->uuid)) {
                $exam->uuid = (string) Str::uuid();
            }
        });
    }



}


==================== FILE: database/migrations/2025_12_06_102959_create_exams_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('exams', function (Blueprint $table) {
            $table->engine = 'InnoDB';

            $table->id();
            $table->uuid('uuid')->unique();

            $table->foreignId('user_id')
                ->constrained('users')
                ->cascadeOnDelete();

            $table->foreignId('teacher_id')
                ->constrained('users')
                ->cascadeOnDelete();

            $table->foreignId('classroom_id')->nullable()
                ->constrained('classrooms')
                ->nullOnDelete();

            $table->enum('exam_type', ['public','class_single','class_comprehensive'])
                ->default('public');

            $table->string('title', 250);
            $table->text('description')->nullable();

            $table->unsignedSmallInteger('duration_minutes');

            $table->foreignId('section_id')->constrained('sections')->restrictOnDelete();
            $table->foreignId('grade_id')->constrained('grades')->restrictOnDelete();
            $table->foreignId('branch_id')->constrained('branches')->restrictOnDelete();
            $table->foreignId('field_id')->constrained('fields')->restrictOnDelete();
            $table->foreignId('subfield_id')->nullable()->constrained('subfields')->nullOnDelete();
            $table->foreignId('subject_type_id')->nullable()->constrained('subject_types')->nullOnDelete();

            $table->unsignedSmallInteger('total_questions')->nullable();
            $table->longText('coefficients')->nullable();

            $table->dateTime('start_at')->nullable();
            $table->dateTime('end_at')->nullable();

            $table->boolean('shuffle_questions')->default(false);
            $table->boolean('shuffle_options')->default(false);
            $table->boolean('ai_assisted')->default(false);

            // FK ุจุนุฏุงู ุฏุฑ add_ ููุง
            $table->unsignedBigInteger('ai_session_id')->nullable();

            $table->boolean('is_active')->default(true);
            $table->boolean('is_published')->default(false);

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('exams');
    }
};


==================== FILE: database/migrations/2025_12_06_103000_create_exam_attempts_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('exam_attempts', function (Blueprint $table) {
            $table->engine = 'InnoDB';

            $table->id();
            $table->uuid('uuid')->unique();

            $table->foreignId('user_id')
                ->constrained('users')
                ->cascadeOnDelete();

            $table->foreignId('exam_id')
                ->constrained('exams')
                ->cascadeOnDelete();

            $table->foreignId('student_id')->nullable()
                ->constrained('users')
                ->nullOnDelete();

            $table->dateTime('started_at');
            $table->dateTime('finished_at')->nullable();

            $table->enum('status', ['in_progress','submitted','graded'])
                ->default('in_progress');

            $table->decimal('total_score', 6, 2)->nullable();

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('exam_attempts');
    }
};


==================== FILE: database/migrations/2025_12_06_103002_create_exam_subject_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('exam_subject', function (Blueprint $table) {
            $table->engine = 'InnoDB';

            $table->foreignId('exam_id')
                ->constrained('exams')
                ->cascadeOnDelete();

            $table->foreignId('subject_id')
                ->constrained('subjects')
                ->cascadeOnDelete();

            $table->unsignedSmallInteger('question_count')->nullable();

            $table->primary(['exam_id', 'subject_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('exam_subject');
    }
};


==================== FILE: database/migrations/2025_12_06_103120_create_exam_questions_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('exam_questions', function (Blueprint $table) {
            $table->engine = 'InnoDB';

            $table->foreignId('exam_id')
                ->constrained('exams')
                ->cascadeOnDelete();

            $table->foreignId('question_id')
                ->constrained('questions')
                ->cascadeOnDelete();

            $table->unsignedInteger('sort_order')->default(0);

            $table->primary(['exam_id', 'question_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('exam_questions');
    }
};


==================== FILE: database/migrations/2025_12_11_070018_add_scope_subject_level_to_exams_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('exams', function (Blueprint $table) {
            // ููุน ุขุฒููู ุฏุฑ UI: ุขุฒุงุฏ / ฺฉูุงุณ
            $table->string('scope', 20)
                ->default('classroom')
                ->after('exam_type');

            // ุจุฑฺุณุจ ููุงุด ุฏุฑุณ ุฏุฑ ูุฑู ุงุฏุช (ูโุชูุงูุฏ ุฎุงู ุจุงุดุฏ)
            $table->string('subject')->nullable()->after('scope');

            // ุณุทุญ ุขุฒููู: ุชููุช / ฺฉูฺฉูุฑ / ุงูููพุงุฏ
            $table->string('level', 30)
                ->default('taghviyati')
                ->after('subject');
        });
    }

    public function down(): void
    {
        Schema::table('exams', function (Blueprint $table) {
            $table->dropColumn(['scope', 'subject', 'level']);
        });
    }
};


==================== FILE: database/migrations/2025_12_11_082656_add_exam_id_and_score_to_questions_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('questions', function (Blueprint $table) {
            // ุขุฒููู ฺฉู ุณูุงู ุจู ุขู ุชุนูู ุฏุงุฑุฏ
            $table->unsignedBigInteger('exam_id')->nullable()->after('creator_id');

            // ููุฑู ุณูุงู (ุงูุชุงุฒ)
            $table->unsignedInteger('score')->default(1)->after('difficulty');

            $table->foreign('exam_id')
                ->references('id')->on('exams')
                ->onDelete('cascade');
        });
    }

    public function down(): void
    {
        Schema::table('questions', function (Blueprint $table) {
            $table->dropForeign(['exam_id']);
            $table->dropColumn(['exam_id', 'score']);
        });
    }
};


==================== FILE: database/migrations/2025_12_11_185939_add_exam_mode_to_exams_table.php ====================
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up()
    {
        Schema::table('exams', function (Blueprint $table) {
            $table->string('exam_mode')
                  ->default('single_subject')
                  ->after('exam_type');

            // ุฏุฑุณ ุงุตู ุงูุชุญุงู ุชฺฉโุฏุฑุณ
            $table->unsignedBigInteger('primary_subject_id')
                  ->nullable()
                  ->after('subject_type_id');

            // ุงฺฏุฑ ูุงุฒู ุดุฏ ุงุฒ ุฑุงุจุทู ุงุณุชูุงุฏู ูโฺฉูู
            $table->foreign('primary_subject_id')
                  ->references('id')->on('subjects')
                  ->nullOnDelete();
        });
    }

    public function down()
    {
        Schema::table('exams', function (Blueprint $table) {
            $table->dropForeign(['primary_subject_id']);
            $table->dropColumn(['exam_mode', 'primary_subject_id']);
        });
    }
};


